function getPluginByID(e){for(var t in __plugins)for(var n=0,i=__plugins[t].length;i>n;n++)if(__plugins[t][n]._id==e)return __plugins[t][n];return null}function onPluginsLoaded(e){for(var t=0,n=e.length;n>t;t++)if(!__plugins[e[t].name]){__plugins[e[t].name]=[];for(var i=__plugins[e[t].name],o=0;n>o;o++)e[o].name==e[t].name&&i.push(e[o]);i=i.sort(function(e,t){if(e===t)return 0;for(var n=e.version.split("."),i=t.version.split("."),o=Math.min(n.length,i.length),r=0;o>r;r++){if(parseInt(n[r])>parseInt(i[r]))return 1;if(parseInt(n[r])<parseInt(i[r]))return-1}return n.length>i.length?1:n.length<i.length?-1:0})}var r=new Animate.Application("#application");Animate.Splash.init(r),Animate.Splash.get.show()}function byteFilter(e,t){if(void 0===t&&(t=1),isNaN(parseFloat(e))||!isFinite(e))return"-";var n=["bytes","kB","MB","GB","TB","PB"],i=Math.floor(Math.log(e)/Math.log(1024));return(e/Math.pow(1024,Math.floor(i))).toFixed(t)+" "+n[i]}var Animate;!function(e){var t=function(){function e(){}return e.cloneNode=function(t){var n=t.cloneNode(!1);n.$compliledEval=t.$compliledEval,n.$ctxValues=t.$ctxValues,n.$dynamic=!0,n.$expression=t.$expression,n.$expressionType=t.$expressionType,n.$ieTextNodes=t.$ieTextNodes,t.hasOwnProperty("$originalNode")&&(n.$clonedElements=[],n.$originalNode=t.$originalNode);for(var i=0,o=t.childNodes.length;o>i;i++)n.appendChild(e.cloneNode(t.childNodes[i]));return n},e.compileEval=function(e,t,n){var i={},o=n||t.$ctxValues;if(o)for(var r in o)i[o[r].name]=o[r].value;var s="";for(var r in i)s+="var "+r+" = contexts['"+r+"'];";return new Function("ctrl","event","elm","contexts","'use strict'; "+s+" var __ret = "+e+"; return __ret;")},e.parse=function(t,n,i,o,r){var s={},a=r||o.$ctxValues;if(a)for(var l in a)s[a[l].name]=a[l].value;return o.$compliledEval||(o.$compliledEval={}),o.$compliledEval[t]||(o.$compliledEval[t]=e.compileEval(t,o,r)),o.$compliledEval[t](n,i,o,s)},e.digestCSS=function(t,n,i){var o=e.parse(i,n,null,t,null),r=t;for(var s in o)o[s]?(r.classList.add(s),r.offsetWidth):r.classList.contains(s)&&r.classList.remove(s)},e.clone=function(t,n){void 0===n&&(n=!0);var i;if(null==t||"object"!=typeof t)return t;if(t instanceof Date)return i=new Date,i.setTime(t.getTime()),i;if(t instanceof Array){i=[];for(var o=0,r=t.length;r>o;o++)i[o]=e.clone(t[o]);return i}if(t instanceof Object){i={};for(var s in t)n?t.hasOwnProperty(s)&&(i[s]=e.clone(t[s],!0)):t.hasOwnProperty(s)&&(i[s]=t[s]);return i}throw new Error("Unable to copy obj! Its type isn't supported.")},e.isEquivalent=function(t,n){if(!(null!=t&&"object"==typeof t||null!=n&&"object"==typeof n))return t==n;if(null==t&&null==n||void 0==t&&void 0==n)return!0;if(null==t||void 0==t)return!1;if(null==n||void 0==n)return!1;var i=Object.getOwnPropertyNames(t),o=Object.getOwnPropertyNames(n);if(i.length!=o.length)return!1;for(var r=0;r<i.length;r++){var s=i[r],a=o[r];if(s!=a)return!1;var l=t[s],h=n[a];if(null==l||"object"!=typeof l){if(l!==n[a])return!1}else if(l instanceof Array){if(h instanceof Array==0)return!1;for(var c=0,u=l.length;u>c;c++)if(!e.isEquivalent(l,h))return!1}else if(l instanceof Date){if(h instanceof Date==0)return!1;if(l.getTime()!=h.getTime())return!1}else if(!e.isEquivalent(l,h))return!1}return!0},e.digestStyle=function(t,n,i){var o=e.parse(i,n,null,t,null);for(var r in o)t.style[r]=o[r];t.offsetWidth},e.removeEvents=function(e){var t=e;if(t.$events){for(var n=0,i=t.$events.length;i>n;n++)t.removeEventListener(t.$events[n].name,t.$events[n].func);t.$events.splice(0,t.$events.length)}},e.traverse=function(e,t){function n(e){if(i=t.call(e,e),i!==!1)for(var o=e.childNodes.length,r=0;r<e.childNodes.length;r++)o=e.childNodes.length,n(e.childNodes[r]),e.childNodes.length<o&&(r-=e.childNodes.length-o)}var i=!0;n(e)},e.cleanupNode=function(t){t.$ctxValues=null,t.$compliledEval=null,t.$ieTextNodes=null,t.$clonedElements=null,t.$originalNode=null,t.$clonedData=null,e.removeEvents(t),t.$events=null,e.traverse(t,function(n){t!=n&&e.cleanupNode(n)}),jQuery(t).remove()},e.expand=function(t,n,i){void 0===i&&(i=!1);var o={};for(var r in t.$commentReferences)o[r]=t.$commentReferences[r];return e.traverse(t,function(t){if(t.$ctrl){var i=t;for(var r in i.$commentReferences)o[r]=i.$commentReferences[r]}if(8==t.nodeType){var s,a,l=t.nodeValue.match(/\d+/gi);if(8==t.nodeType&&l){var h=l[0];a=o[h],s=jQuery(a)}if(a&&a.$originalNode.$expression){var c=a.$originalNode.$expression,u=a.$originalNode.$expressionType;if(e.directives[u]){var p,d=e.directives[u].expand(c,n,a,t);if(!d)return;for(var m=0,f=t.$clonedElements.length;f>m;m++)e.cleanupNode(t.$clonedElements[m]);t.$clonedElements.splice(0,t.$clonedElements.length);for(var f=0,v=d.length;v>f;f++){p=d[f],p.$ctxValues||(p.$ctxValues=[]),t.parentNode&&t.parentNode.$ctxValues&&(p.$ctxValues=p.$ctxValues.concat(t.parentNode.$ctxValues)),p.$ctxValues.length>0&&e.traverse(p,function(e){e!=p&&(e.$ctxValues?e.$ctxValues.concat(p.$ctxValues.slice(0,p.$ctxValues.length)):e.$ctxValues=p.$ctxValues.slice(0,p.$ctxValues.length))});var g=jQuery(p);g.insertAfter(jQuery(t)),t.$clonedElements.push(p)}}}}}),t},e.registerFunc=function(e,t,n,i){e.$events||(e.$events=[]);for(var o=0,r=e.$events.length;r>o;o++)if(e.$events[o].tag==n)return;e.addEventListener(t,i),e.$events.push({name:t,func:i,tag:n})},e.digest=function(t,n,i){void 0===i&&(i=!1);var o,r,s=t.get(0),a=s;return a.$commentReferences&&(r=e.expand(a,n,i),r!=s&&(s=r,t=jQuery(s))),e.traverse(s,function(r){if(!i&&r.$ctrl&&s!=r)return!1;if(8!=r.nodeType){jQuery(r);if(3==r.nodeType){o=r;var a="",l=o.$expression;a=l?l:o.nodeValue;var h=a.replace(/\{\{(.*?)\}\}/g,function(t,i){return o.$expression=a,e.parse(i,n,null,o,null)});return void(h!=a&&(o.nodeValue=h,o.$expression&&""==o.nodeValue.trim()&&(o.parentNode.$ieTextNodes||(o.parentNode.$ieTextNodes=[]),-1==o.parentNode.$ieTextNodes.indexOf(o)&&o.parentNode.$ieTextNodes.push(o))))}var c=r,u=e.attrs;u.splice(0,u.length);for(var p=0;p<r.attributes.length;p++)u.push(r.attributes[p]);jQuery.each(u,function(o,s){if(s){var a=s.name,l=s.value;switch(a){case"en-src":var h=e.parse(l,n,null,r,null);h!=r.$prevSrc&&(r.src=h,r.$prevSrc=h);break;case"en-show":var u=e.parse(l,n,null,r,null)?"":"none";u!=r.style.display&&(r.style.display=u,r.offsetWidth);break;case"en-html":var p=e.parse(l,n,null,r,null);r.innerHTML=p;break;case"en-scrolltop":var d=e.parse(l,n,null,r,null);void 0!==d&&(r.scrollTop=d);break;case"en-scrollLeft":var d=e.parse(l,n,null,r,null);void 0!==d&&(r.scrollLeft=d);break;case"en-href":var m=e.parse(l,n,null,r,null);r.href=m;break;case"en-init":e.parse(l,n,null,r,null);break;case"en-value":var d=e.parse(l,n,null,r,null);r.value=d;break;case"en-selected":var d=e.parse(l,n,null,r,null);d?r.setAttribute("selected","selected"):r.removeAttribute("selected");break;case"en-class":e.digestCSS(r,n,l);break;case"en-style":e.digestStyle(r,n,l);break;case"en-model":var f=function(o){e.parse(l+" = elm.value",n,o,r,null),e.transform(""+l,r,n),r.$validate&&e.validateNode(r),e.digest(t,n,i)},d=e.parse(""+l,n,null,r,null);d=void 0!==d?d.toString():"",void 0===d&&(d=r.value||""),r.value=d,e.registerFunc(c,"change","en-model",f);break;case"en-click":var f=function(o){e.parse(l,n,o,r,null),e.digest(t,n,i)};e.registerFunc(c,"click","en-click",f);break;case"en-mouse-over":var f=function(o){e.parse(l,n,o,r,null),e.digest(t,n,i)};e.registerFunc(c,"mouseover","en-mouse-over",f);break;case"en-dclick":var f=function(o){e.parse(l,n,o,r,null),e.digest(t,n,i)};e.registerFunc(c,"dblclick","en-dclick",f);break;case"en-change":var f=function(o){e.parse(l,n,o,r,null),r.$validate&&e.validateNode(r),e.digest(t,n,i)};e.registerFunc(c,"change","en-change",f);break;case"en-submit":var f=function(o){var s=r;o.preventDefault(),s.$error=!1,s.$errorExpression="",s.$errorInput="",jQuery("[en-validate]",r).each(function(t,n){var i=e.checkValidations(this.getAttribute("en-validate"),n);i&&(s.$error=!0,s.$pristine=!1)}),s.$autoClear&&jQuery("[en-auto-clear]",r).each(function(e,t){this.value=""}),e.parse(l,n,o,r,null),e.digest(t,n,i)};e.registerFunc(c,"submit","en-submit",f);break;case"en-validate":r.$validate=!0,r.$value=l,r.form&&(r.form.$pristine=!0);break;case"en-auto-clear":r.$autoClear=!0}}})}}),s},e.validateNode=function(t){var n=t.form;n&&(n.$error=!1,n.$errorInput=""),e.checkValidations(t.$value,t)},e.checkValidations=function(t,n){for(var i=[],o=n.form,r=0,s=t.split("|"),a=s.length;a>r;r++)e.validators[s[r]]&&i.push(e.validators[s[r]]);n.$error=!1;for(var r=0,a=i.length;a>r;r++){var l=n.value.match(i[r].regex);if(i[r].negate&&(l=l?null:!0),!l){n.$error=!0,o&&(o.$error=!0,o.$errorExpression=i[r].name,o.$errorInput=n.name);break}}return n.$error},e.transform=function(t,n,i){for(var o=0,r=n.attributes.length;r>o;o++)if("en-transform"==n.attributes[o].name)return e.parse(t+" = "+n.attributes[o].value,i,null,n,null)},e.build=function(t,n,i){void 0===i&&(i=!1);var o=t.get(0);o.$ctrl=n,o.$commentReferences={};var r=[];e.traverse(o,function(t){if(!i&&t.$ctrl&&t.$ctrl!=n)return!1;if(1==t.nodeType&&!t.$dynamic&&!t.$clonedElements){var o=e.attrs;o.splice(0,o.length);for(var s=0;s<t.attributes.length;s++)o.push(t.attributes[s]);jQuery.each(o,function(e,n){if(n){var i=n.name,o=n.value;switch(i){case"en-repeat":t.$expression=o,t.$expressionType="en-repeat",r.push(t);break;case"en-if":t.$expression=o,t.$expressionType="en-if",r.push(t)}}})}});for(var s=0,a=r.length;a>s;s++){e.$commentRefIDCounter++;var l=jQuery("<!-- "+r[s].$expressionType+"["+e.$commentRefIDCounter+"] -->"),h=l.get(0);h.$clonedElements=[],h.$originalNode=r[s],h.$expression=h.$originalNode.$expression,h.$expressionType=h.$originalNode.$expressionType,jQuery(r[s]).replaceWith(l),o.$commentReferences[e.$commentRefIDCounter.toString()]=h}return jQuery(e.digest(t,n,i))},e.directives={},e.attrs=[],e.$commentRefIDCounter=0,e.validators={"alpha-numeric":{regex:/^[a-z0-9]+$/i,name:"alpha-numeric",negate:!1},"non-empty":{regex:/\S/,name:"non-empty",negate:!1},"alpha-numeric-plus":{regex:/^[a-zA-Z0-9_\-!]+$/,name:"alpha-numeric-plus",negate:!1},"email-plus":{regex:/^[a-zA-Z0-9_\-!@\.]+$/,name:"email-plus",negate:!1},email:{regex:/^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i,name:"email",negate:!1},"no-html":{regex:/(<([^>]+)>)/gi,name:"no-html",negate:!0}},e}();e.Compiler=t}(Animate||(Animate={}));var Animate;!function(e){var t=function(){function t(){this._returnVal=[]}return t.prototype.expand=function(t,n,i,o){var r=t.split("as");if(r.length<1)throw new Error("Please use the syntax [iterable] 'as' [iterable name], [iterable index name]?");var s=r[0],a=r[1].split(","),l=a[0],h=a[1],c=!1,u=e.Compiler.parse(s,n,null,i,o.$ctxValues);this._returnVal.splice(0,this._returnVal.length);var p=0;if(u)if(o.$clonedData){var d=o.$clonedData.items;for(var m in u)p++,void 0!==d[m]&&d[m]!=u[m]&&(c=!0);o.$clonedData.length!=p&&(c=!0)}else c=!0;else c=!0;if(!c)return null;if(u)for(var f in u){var v=e.Compiler.cloneNode(i.$originalNode);this._returnVal.push(v),v.$ctxValues=[{name:l,value:u[f]}],h&&""!=h.trim()&&v.$ctxValues.push({name:h,value:f})}return o.$clonedData={length:p,items:u},this._returnVal},t}();e.Repeater=t,e.Compiler.directives["en-repeat"]=new t}(Animate||(Animate={}));var Animate;!function(e){var t=function(){function t(){this._returnVal=[]}return t.prototype.expand=function(t,n,i,o){var r=!1,s=e.Compiler.parse(t,n,null,i,o.$ctxValues);if(this._returnVal.splice(0,this._returnVal.length),o.$clonedData){var a=o.$clonedData;0==e.Compiler.isEquivalent(a,s)&&(r=!0)}else r=!0;if(!r)return null;if(s){var l=e.Compiler.cloneNode(i.$originalNode);this._returnVal.push(l)}return o.$clonedData=s,this._returnVal},t}();e.If=t,e.Compiler.directives["en-if"]=new t}(Animate||(Animate={}));var Animate;!function(e){var t;!function(e){e.PORTAL_ADDED="portal-added",e.PORTAL_REMOVED="portal-removed",e.PORTAL_EDITED="edited",e.CONTAINER_DELETED="container-deleted",e.CONTAINER_SELECTED="container-selected",e.CONTAINER_CREATED="container-created"}(t=e.EventTypes||(e.EventTypes={})),function(e){e[e.Global=0]="Global",e[e.User=1]="User",e[e.Project=2]="Project"}(e.FileSearchType||(e.FileSearchType={}));e.FileSearchType;!function(e){e[e.PARAMETER=0]="PARAMETER",e[e.PRODUCT=1]="PRODUCT",e[e.INPUT=2]="INPUT",e[e.OUTPUT=3]="OUTPUT"}(e.PortalType||(e.PortalType={}));e.PortalType;!function(e){e[e.Free=1]="Free",e[e.Bronze=2]="Bronze",e[e.Silver=3]="Silver",e[e.Gold=4]="Gold",e[e.Platinum=5]="Platinum",e[e.Custom=6]="Custom"}(e.UserPlan||(e.UserPlan={}));e.UserPlan;!function(e){e[e.GROUP=1]="GROUP",e[e.ASSET=2]="ASSET",e[e.CONTAINER=3]="CONTAINER",e[e.FILE=4]="FILE",e[e.SCRIPT=5]="SCRIPT"}(e.ResourceType||(e.ResourceType={}));e.ResourceType;!function(e){e[e.NONE=0]="NONE",e[e.READ=1]="READ",e[e.WRITE=2]="WRITE",e[e.ADMIN=3]="ADMIN"}(e.PrivilegeType||(e.PrivilegeType={}));e.PrivilegeType;!function(e){e[e.Other=1]="Other",e[e.Artistic=2]="Artistic",e[e.Gaming=3]="Gaming",e[e.Informative=4]="Informative",e[e.Musical=5]="Musical",e[e.Technical=6]="Technical",e[e.Promotional=7]="Promotional"}(e.Category||(e.Category={}));e.Category;!function(e){e[e.ASSET=0]="ASSET",e[e.ASSET_LIST=1]="ASSET_LIST",e[e.NUMBER=2]="NUMBER",e[e.COLOR=3]="COLOR",e[e.GROUP=4]="GROUP",e[e.FILE=5]="FILE",e[e.STRING=6]="STRING",e[e.OBJECT=7]="OBJECT",e[e.BOOL=8]="BOOL",e[e.ENUM=9]="ENUM",e[e.HIDDEN=10]="HIDDEN",e[e.HIDDEN_FILE=11]="HIDDEN_FILE",e[e.OPTIONS=12]="OPTIONS"}(e.PropertyType||(e.PropertyType={}));e.PropertyType;!function(e){e[e.Link=0]="Link",e[e.Behaviour=1]="Behaviour",e[e.BehaviourAsset=2]="BehaviourAsset",e[e.BehaviourShortcut=3]="BehaviourShortcut",e[e.BehaviourPortal=4]="BehaviourPortal",e[e.BehaviourScript=5]="BehaviourScript",e[e.BehaviourComment=6]="BehaviourComment",e[e.BehaviourInstance=7]="BehaviourInstance"}(e.CanvasItemType||(e.CanvasItemType={}));e.CanvasItemType}(Animate||(Animate={}));var Animate;!function(e){var t=function(){function e(e){this.value=e}return e.prototype.toString=function(){return this.value},e}();e.ENUM=t;var n=function(){function e(e,t,n){this.type=e,this.func=t,this.context=n}return e}();e.EventListener=n;var i=function(){function e(e,t){this.type=e,this.tag=t}return e}();e.Event=i;var o=function(){function e(){this._listeners=[],this.disposed=!1}return Object.defineProperty(e.prototype,"listeners",{get:function(){return this._listeners},enumerable:!0,configurable:!0}),e.prototype.on=function(e,t,i){if(!t)throw new Error("You cannot have an undefined function.");this._listeners.push(new n(e,t,i))},e.prototype.off=function(e,t,n){var i=this.listeners;if(i){if(!t)throw new Error("You cannot have an undefined function.");for(var o=0,r=i.length;r>o;o++){var s=i[o];if(s.type==e&&s.func==t&&s.context==n)return void i.splice(o,1)}}},e.prototype.emit=function(e,n){var o=null;if(e instanceof t?o=new i(e,n):e instanceof i&&(o=e),0==this._listeners.length)return null;var r=this._listeners.slice(0);if(!r)return null;for(var s=null,a=0,l=r.length;l>a;a++){var h=r[a];if(h.type==o.type){if(!h.func)throw new Error("A listener was added for "+o.type+", but the function is not defined.");s=h.func.call(h.context||this,h.type,o,this)}}return s},e.prototype.dispose=function(){this._listeners=null,this.disposed=!0},e}();e.EventDispatcher=o}(Animate||(Animate={}));var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},Animate;!function(e){var t=function(t){function n(n){t.call(this),this.entry=n;var i=n;i.shallowId=e.Utils.generateLocalId(i.shallowId),this._saved=!0,this._options={},this._properties=new e.EditableSet(this)}return __extends(n,t),n.prototype.initialize=function(){},n.prototype.onSaving=function(){},Object.defineProperty(n.prototype,"properties",{get:function(){return this._properties},set:function(e){this._properties=e,e.parent=this},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"saved",{get:function(){return this._saved},set:function(t){this._saved=t,this.emit(new e.Event("modified"))},enumerable:!0,configurable:!0}),n.prototype.dispose=function(){t.prototype.dispose.call(this),this._properties.dispose(),this._properties=null,this._options=null},n.prototype.createOption=function(e,t){this._options[e]=t},n.prototype.removeOption=function(e){delete this._options[e]},n.prototype.updateOption=function(e,t){this._options[e]=t},n.prototype.getOption=function(e){return this._options[e]},n}(e.EventDispatcher);e.ProjectResource=t}(Animate||(Animate={}));var Animate;!function(e){var t=function(e){function t(t){e.call(this,t)}return __extends(t,e),t.EDITOR_PROJECT_EXPORTING=new t("editor_project_exporting"),t.EDITOR_READY=new t("editor_ready"),t.EDITOR_RUN=new t("editor_run"),t.CONTAINER_EXPORTING=new t("plugin_container_exporting"),t.CONTAINER_SAVING=new t("plugin_container_saving"),t.CONTAINER_OPENING=new t("plugin_container_opening"),t.ASSET_RENAMED=new t("plugin_asset_renamed"),t.ASSET_SELECTED=new t("plugin_asset_selected"),t.ASSET_EDITED=new t("plugin_asset_edited"),t.ASSET_ADDED_TO_CONTAINER=new t("plugin_asset_added_to_container"),t.ASSET_REMOVED_FROM_CONTAINER=new t("plugin_asset_removed_from_container"),t.ASSET_SAVING=new t("plugin_asset_saving"),t.ASSET_LOADED=new t("plugin_asset_loaded"),t.ASSET_DESTROYED=new t("plugin_asset_destroyed"),t.ASSET_COPIED=new t("plugin_asset_copied"),t}(e.ENUM);e.EditorEvents=t;var n=function(e){function t(t,n,i,o,r){e.call(this,t,n),this.cancel=!1,this.name=n,this.oldName=i,this.object=o,this.resourceType=r}return __extends(t,e),t}(e.Event);e.RenameFormEvent=n;var i=function(e){function t(t,n){e.call(this,t,n),this.text=n,this.cancel=!1}return __extends(t,e),t}(e.Event);e.OkCancelFormEvent=i;var o=function(e){function t(t,n){e.call(this,t,null),this.container=n}return __extends(t,e),t}(e.Event);e.ContainerEvent=o;var r=function(e){function t(t,n){e.call(this,t,n),this.behaviourName=n}return __extends(t,e),t}(e.Event);e.BehaviourPickerEvent=r;var s=function(e){function t(t,n){e.call(this,n,t),this.item=t}return __extends(t,e),t}(e.Event);e.ContextMenuEvent=s;var a=function(e){function t(t,n){e.call(this,t,n)}return __extends(t,e),t}(e.Event);e.UserEvent=a;var l=function(e){function t(t,n){e.call(this,t,n),this.live_link=n}return __extends(t,e),t}(e.Event);e.ImportExportEvent=l;var h=function(e){function n(n){e.call(this,t.EDITOR_PROJECT_EXPORTING,null),this.token=n}return __extends(n,e),n}(e.Event);e.EditorExportingEvent=h;var c=function(e){function t(t,n,i,o){e.call(this,t,null),this.container=n,this.token=i,this.sceneReferences=o}return __extends(t,e),t}(e.Event);e.ContainerDataEvent=c;var u=function(e){function t(t,n){e.call(this,t,null),this.asset=n}return __extends(t,e),t}(e.Event);e.AssetEvent=u;var p=function(e){function n(n,i){e.call(this,t.ASSET_RENAMED,n),this.oldName=i}return __extends(n,e),n}(u);e.AssetRenamedEvent=p;var d=function(e){function t(t,n,i){e.call(this,t,n),this.container=i}return __extends(t,e),t}(u);e.AssetContainerEvent=d;var m=function(e){function t(t,n,i,o){e.call(this,t,null),this.container=i,this.portal=o,this.oldName=n}return __extends(t,e),t}(e.Event);e.PortalEvent=m;var f=function(e){function t(t,n){e.call(this,t,n),this.window=n}return __extends(t,e),t}(e.Event);e.WindowEvent=f;var v=function(e){function t(t,n){this.value=n,e.call(this,t,null)}return __extends(t,e),t}(e.Event);e.ToolbarNumberEvent=v;var g=function(e){function t(t,n){this.item=t,e.call(this,n,null)}return __extends(t,e),t.prototype.dispose=function(){this.item=null},t}(e.Event);e.ToolbarDropDownEvent=g;var y=function(e){function t(t,n){e.call(this,"edited"),this.property=t,this.set=n}return __extends(t,e),t}(e.Event);e.EditEvent=y;var _=function(e){function t(t,n){e.call(this,t,n),this.cancel=!1,this._pair=n}return __extends(t,e),Object.defineProperty(t.prototype,"pair",{get:function(){return this._pair},enumerable:!0,configurable:!0}),t}(e.Event);e.TabEvent=_;var b=function(e){function t(t,n){this.canvas=n,e.call(this,t,n)}return __extends(t,e),t}(e.Event);e.CanvasEvent=b;var w=function(e){function t(t,n){e.call(this,t),this.item=n}return __extends(t,e),t}(e.Event);e.ListViewEvent=w;var P=function(e){function t(t,n){e.call(this,t,n),this.item=n}return __extends(t,e),t}(e.Event);e.ListEvent=P;var C=function(e){function t(t,n){this.resource=n,e.call(this,t,null)}return __extends(t,e),t}(e.Event);e.ProjectEvent=C;var x=function(e){function t(t,n){e.call(this,t,n),this.file=n}return __extends(t,e),t}(e.Event);e.FileViewerEvent=x}(Animate||(Animate={}));var Animate;!function(e){var t=function(){function t(e,t,n,i){void 0===i&&(i=!1),this._abstractClass=i,this._name=e,this.parentClass=t,this._imgURL=n,this._variables=[],this.classes=[]}return t.prototype.buildVariables=function(){for(var t=new e.EditableSet(null),n=this;null!=n;){for(var i=0;i<n._variables.length;i++){var o=n._variables[i];t.getVar(o.name)||t.addVar(o)}n=n.parentClass}return t},t.prototype.findClass=function(e){if(this._name==e)return this;for(var t=this.classes,n=0,i=t.length;i>n;n++){var o=t[n].findClass(e);if(o)return o}return null},t.prototype.addVar=function(e){return this._variables.push(e),this},t.prototype.dispose=function(){for(var e=0,t=this._variables.length;t>e;e++)this._variables[e].dispose();for(var e=0,t=this.classes.length;t>e;e++)this.classes[e].dispose();this._abstractClass=null,this._name=null,this.parentClass=null,this._variables=null,this._imgURL=null,this.classes=null},t.prototype.getVariablesByName=function(e){for(var t=0,n=this._variables.length;n>t;t++)if(this._variables[t].name==e)return this._variables[t];return null},Object.defineProperty(t.prototype,"imgURL",{get:function(){return this._imgURL},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"variables",{get:function(){return this._variables},enumerable:!0,configurable:!0}),t.prototype.addClass=function(e,n,i){var o=new t(e,this,n,i);return this.classes.push(o),o},Object.defineProperty(t.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"abstractClass",{get:function(){return this._abstractClass},enumerable:!0,configurable:!0}),t}();e.AssetClass=t}(Animate||(Animate={}));var Animate;!function(e){var t=function(){function t(){}return t.generateLocalId=function(e){return void 0!==e&&e>t.shallowIds?(t.shallowIds=e+1,e):(t.shallowIds++,t.shallowIds)},t.post=function(e,n){return new Promise(function(i,o){var r=new XMLHttpRequest;r.onreadystatechange=function(){if(4==r.readyState){if(200==r.status){var e=JSON.parse(r.responseText);return i(e)}return o({message:r.statusText,status:r.status})}},r.open("POST",e,!0);var s;n&&(s=JSON.stringify(n),r.setRequestHeader("Content-type","application/json; charset=utf-8")),r.withCredentials=t._withCredentials,r.send(s)})},t.get=function(e){return new Promise(function(n,i){var o=new XMLHttpRequest;o.onreadystatechange=function(){if(4==o.readyState){if(200==o.status){var e=JSON.parse(o.responseText);return n(e)}return i({message:o.statusText,status:o.status})}},o.open("GET",e,!0),o.withCredentials=t._withCredentials,o.send()})},t.put=function(e,n){return new Promise(function(i,o){var r=new XMLHttpRequest;r.onreadystatechange=function(){if(4==r.readyState){if(200==r.status){var e=JSON.parse(r.responseText);return i(e)}return o({message:r.statusText,status:r.status})}},r.open("PUT",e,!0);var s;n&&(s=JSON.stringify(n),r.setRequestHeader("Content-type","application/json; charset=utf-8")),r.withCredentials=t._withCredentials,r.send(s)})},t["delete"]=function(e,n){return new Promise(function(i,o){var r=new XMLHttpRequest;r.onreadystatechange=function(){if(4==r.readyState){if(200==r.status){var e=JSON.parse(r.responseText);return i(e)}return o({message:r.statusText,status:r.status})}},r.open("DELETE",e,!0);var s;n&&(s=JSON.stringify(n),r.setRequestHeader("Content-type","application/json; charset=utf-8")),r.withCredentials=t._withCredentials,r.send(s)})},t.createItem=function(t,n){switch(n.type){case e.CanvasItemType.Link:return new e.Link(t);case e.CanvasItemType.BehaviourAsset:return new e.BehaviourAsset(t);case e.CanvasItemType.BehaviourComment:return new e.BehaviourComment(t,"");case e.CanvasItemType.BehaviourInstance:return new e.BehaviourInstance(t,null);case e.CanvasItemType.BehaviourPortal:return new e.BehaviourPortal(t,null,e.PortalType.INPUT);case e.CanvasItemType.BehaviourScript:return new e.BehaviourScript(t,n.scriptId,n.text,!1);case e.CanvasItemType.BehaviourShortcut:return new e.BehaviourShortcut(t,null,"");case e.CanvasItemType.Behaviour:return new e.Behaviour(t,"")}},t.createProperty=function(t,n){var i;switch(n){case e.PropertyType.ASSET:i=new e.PropAsset(t,null);break;case e.PropertyType.ASSET_LIST:i=new e.PropAssetList(t,null,[]);break;case e.PropertyType.BOOL:i=new e.PropBool(t,!1);break;case e.PropertyType.ENUM:i=new e.PropEnum(t,"",[]);break;case e.PropertyType.FILE:i=new e.PropFileResource(t,null,null);break;case e.PropertyType.COLOR:i=new e.PropColor(t,16777215,1);break;case e.PropertyType.GROUP:i=new e.PropGroup(t,null);break;case e.PropertyType.HIDDEN:break;case e.PropertyType.HIDDEN_FILE:break;case e.PropertyType.NUMBER:i=new e.PropNum(t,0);break;case e.PropertyType.OBJECT:i=new e.PropObject(t,null);break;case e.PropertyType.OPTIONS:break;case e.PropertyType.STRING:i=new e.PropText(t,"")}return i},t.getMousePos=function(e,t){for(var n=document.getElementById(t),i=0,o=0;n&&"BODY"!=n.tagName;)i+=n.offsetTop,o+=n.offsetLeft,n=n.offsetParent;var r=jQuery("#"+t).parent().parent(),s=r.scrollLeft(),a=r.scrollTop(),l=e.clientX-o+s,h=e.clientY-i+a;return{y:h,x:l}},t.checkForSpecialChars=function(e,t){if(void 0===t&&(t=!1),t===!1&&""===jQuery.trim(e))return"Text cannot be an empty string";var n=e,i=n.length,n=n.replace(/[^a-zA-Z 0-9'!£$&+-=_]+/g,"");return n.length!=i?"Please enter safe characters. We do not allow for HTML type characters.":null},t.validateEmail=function(e){var t=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return t.test(e)},t.getObjectClass=function(e){if(e&&e.constructor&&e.constructor.toString){var t=e.constructor.toString().match(/function\s*(\w+)/);if(t&&2==t.length)return t[1]}},t._withCredentials=!0,t.shallowIds=0,t}();e.Utils=t}(Animate||(Animate={}));var Animate;!function(e){var t=function(t){function n(){if(t.call(this),null!=n._singleton)throw new Error("PluginManager is singleton, you must call the getSingleton() property to get its instance. ");n._singleton=this,this._plugins=new Array,this.behaviourTemplates=new Array,this._assetTemplates=new Array,this._converters=new Array,this.behaviourTemplates.push(new e.BehaviourDefinition("Asset",[new e.PortalTemplate(new e.PropAsset("Asset In",null),e.PortalType.PARAMETER),new e.PortalTemplate(new e.PropAsset("Asset Out",null),e.PortalType.PRODUCT)],null,!1,!1,!1,!1)),this.behaviourTemplates.push(new e.BehaviourDefinition("Script",[new e.PortalTemplate(new e.PropBool("Execute",!1),e.PortalType.INPUT),new e.PortalTemplate(new e.PropBool("Exit",!1),e.PortalType.OUTPUT)],null,!0,!0,!0,!0)),this.behaviourTemplates.push(new e.BehaviourDefinition("Instance",[],null,!0,!0,!0,!0)),this._loadedPlugins=[],e.BehaviourPicker.getSingleton().list.addItem("Asset"),e.BehaviourPicker.getSingleton().list.addItem("Script"),this._previewVisualizers=[new e.ImageVisualizer]}return __extends(n,t),n.prototype.loadPlugin=function(e){return e.$loaded?Promise.resolve():new Promise(function(t,n){var i=document.createElement("script");i.onerror=function(t){return e.$loaded=!1,n(new Error("Could not download plugin"))},i.onload=function(n){return e.$loaded=!0,e.$instance=__newPlugin,t(e)},i.async=!0,i.src=e.url,document.head.appendChild(i)})},n.prototype.preparePlugin=function(t,n){void 0===n&&(n=!0);var i=t.$instance;this._plugins.push(i);var o=i.getBehaviourDefinitions();if(o)for(var r=o.length,s=0;r>s;s++)this.behaviourTemplates.push(o[s]),e.BehaviourPicker.getSingleton().list.addItem(o[s].behaviourName),e.TreeViewScene.getSingleton().addPluginBehaviour(o[s]);var a=i.getTypeConverters();if(a)for(var s=a.length;s--;)this._converters.push(a[s]);var l=i.getAssetsTemplate();if(l)for(var s=l.length;s--;)this._assetTemplates.push(l[s])},n.prototype.unloadPlugin=function(t){for(var n=new Array,i=this.behaviourTemplates.length;i--;)this.behaviourTemplates[i].plugin==t&&n.push(this.behaviourTemplates[i]);for(var i=n.length;i--;)e.BehaviourPicker.getSingleton().list.removeItem(n[i].behaviourName),e.TreeViewScene.getSingleton().removePluginBehaviour(n[i].behaviourName),this.behaviourTemplates.splice(this.behaviourTemplates.indexOf(n[i]),1);for(var o=[],i=this._converters.length;i--;)this._converters[i].plugin==t&&o.push(this._converters[i]);for(var i=o.length;i--;)this._converters.splice(jQuery.inArray(o[i],this._converters),1);this._assetTemplates.splice(0,this._assetTemplates.length),t.unload()},n.prototype.getConverters=function(e,t){for(var n=null,i=this._converters.length;i--;)if(this._converters[i].canConvert(e,t)){null==n&&(n=[]);for(var o=this._converters[i].conversionOptions.length;o--;)n.push(this._converters[i].conversionOptions[o])}return n},n.prototype.getTemplate=function(e){for(var t=this.behaviourTemplates.length;t--;)if(this.behaviourTemplates[t].behaviourName==e)return this.behaviourTemplates[t];return null},n.prototype.selectAsset=function(t,n,i){void 0===n&&(n=!0),void 0===i&&(i=!1),e.TreeViewScene.getSingleton().selectNode(e.TreeViewScene.getSingleton().findNode("resource",t),n,i)},n.prototype.getAssetClass=function(e){for(var t=this._assetTemplates,n=0,i=t.length;i>n;n++){var o=t[n].findClass(e);if(o)return o}return null},n.prototype.projectReset=function(e){for(var t=0;t<this._plugins.length;t++)this.unloadPlugin(this._plugins[t]);this._plugins.splice(0,this._plugins.length),this._loadedPlugins.splice(0,this._loadedPlugins.length)},n.prototype.projectReady=function(t){this.emit(new e.Event(e.EditorEvents.EDITOR_READY,null))},n.prototype.displayPreview=function(e,t){for(var n,i=this._previewVisualizers,o=0,r=i.length;r>o;o++)if(n=i[o].generate(e,t))return n;return null},Object.defineProperty(n.prototype,"assetTemplates",{get:function(){return this._assetTemplates},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"loadedPlugins",{get:function(){return this._loadedPlugins},enumerable:!0,configurable:!0}),n.getSingleton=function(){return n._singleton||new n,n._singleton},n}(e.EventDispatcher);e.PluginManager=t}(Animate||(Animate={}));var Animate;!function(e){var t=function(e){function t(t){e.call(this,t)}return __extends(t,e),t.COMPLETE=new t("import_export_complete"),t}(e.ENUM);e.ImportExportEvents=t;var n=function(n){function i(){if(n.call(this),null!=i._singleton)throw new Error("The ImportExport class is a singleton. You need to call the ImportExport.getSingleton() function.");i._singleton=this,this.mRequest=null,this.runWhenDone=!1}return __extends(i,n),i.prototype.run=function(){this.exportScene(),this.runWhenDone=!0},i.prototype.exportScene=function(){},i.prototype.referenceCheckAsset=function(t,n){if(null!=t)for(var i=t.properties.variables,o=(e.User.get.project,0),r=i.length;r>o;o++)if(i[o].type==e.PropertyType.ASSET){var t=i[o].getVal();t&&(n.assets.push(t.entry.shallowId),this.referenceCheckAsset(t,n))}else if(i[o].type==e.PropertyType.ASSET_LIST)for(var s=i[o].getVal(),a=0,l=s.length;l>a;a++){var t=s[a];n.assets.push(t.entry.shallowId),this.referenceCheckAsset(t,n)}else if(i[o].type==e.PropertyType.GROUP){var h=i[o].getVal();if(h){var c=e.TreeViewScene.getSingleton().findNode("resource",h);this.referenceCheckGroup(c,n)}}},i.prototype.referenceCheckGroup=function(t,n){if(null!=t){var i=e.User.get.project;n.groups.indexOf(t.resource.entry._id)&&n.groups.push(t.resource.entry._id);for(var o=0;o<t.children.length;o++)if(t.children[o].shallowId){var r=t.children[o].shallowId;-1==n.assets.indexOf(r)&&(n.assets.push(r),this.referenceCheckAsset(i.getResourceByShallowID(r,e.ResourceType.ASSET),n));
}}},i.prototype.onServer=function(n,i,o){var r=o;if(n==e.LoaderEvents.COMPLETE)if(i.return_type==e.AnimateLoaderResponses.SUCCESS){if("/export/compile"==r.url){e.Logger.getSingleton().clearItems();new Date;e.Logger.logMessage("Build complete at "+new Date(Date.now()).toDateString(),null,e.LogType.MESSAGE),e.Logger.logMessage("External link: "+i.tag.liveLink,null,e.LogType.MESSAGE),this.runWhenDone&&window.open(i.tag.liveLink,"Webinate Live!","width=900,height=860"),this.emit(new e.ImportExportEvent(t.COMPLETE,i.tag.liveLink))}}else e.MessageBox.show(i.message,Array("Ok"),null,null)},i.getSingleton=function(){return i._singleton||new i,i._singleton},i}(e.EventDispatcher);e.ImportExport=n}(Animate||(Animate={}));var Animate;!function(e){var t=function(){function e(e){}return e.prototype.edit=function(e,t){return null},e.prototype.cleanup=function(){},e}();e.PropertyGridEditor=t}(Animate||(Animate={}));var Animate;!function(e){var t=function(e){function t(t,n){e.call(this,n),this["class"]=t,this.properties=t.buildVariables()}return __extends(t,e),t.prototype.toString=function(){return this.entry.name+"("+this.entry.shallowId+")"},t.prototype.update=function(e,t,n){void 0===n&&(n={}),this.entry.name=e,this.saved=!0,this.properties=n,this.entry.className=t},t.prototype.dispose=function(){e.prototype.dispose.call(this),this["class"]=null},t}(e.ProjectResource);e.Asset=t}(Animate||(Animate={}));var Animate;!function(e){var t=function(t){function n(n){t.call(this,n),this.canvas=null,this._properties.addVar(new e.PropBool("Start On Load",!0,"Container Properties")),this._properties.addVar(new e.PropBool("Unload On Exit",!0,"Container Properties"))}return __extends(n,t),n.prototype.onSaving=function(){if(this.canvas){var e=this.canvas.tokenize(!1);this.entry.json=e}},n.prototype.initialize=function(){var e=this.entry.json;e.items=e.items||[],e.properties&&this._properties.deTokenize(e.properties)},n.prototype.dispose=function(){this.emit(new e.ContainerEvent(e.EventTypes.CONTAINER_DELETED,this)),t.prototype.dispose.call(this),this.canvas=null},n}(e.ProjectResource);e.Container=t}(Animate||(Animate={}));var Animate;!function(e){var t=function(e){function t(t){e.call(this,t)}return __extends(t,e),t.prototype.addReference=function(e){this.entry.items.push(e),this.saved=!1},t.prototype.removeReference=function(e){-1!=this.entry.items.indexOf(e)&&this.entry.items.splice(this.entry.items.indexOf(e),1),this.saved=!1},t.prototype.dispose=function(){e.prototype.dispose.call(this)},t}(e.ProjectResource);e.GroupArray=t}(Animate||(Animate={}));var Animate;!function(e){var t=function(e){function t(t){e.call(this,t)}return __extends(t,e),t}(e.ProjectResource);e.FileResource=t}(Animate||(Animate={}));var Animate;!function(e){var t=function(e){function t(t){e.call(this,t)}return __extends(t,e),t}(e.ProjectResource);e.ScriptResource=t}(Animate||(Animate={}));var Animate;!function(e){var t=function(){function t(e){this.plugin=e,this.classes=[]}return t.prototype.addClass=function(t,n,i){var o=new e.AssetClass(t,null,n,i);return this.classes.push(o),o},t.prototype.removeClass=function(e){for(var t=0,n=this.classes.length;n>t;t++)if(this.classes[t].name==e)return this.classes[t].dispose(),void this.classes.splice(t,1)},t.prototype.findClass=function(e){for(var t=this.classes,n=0,i=t.length;i>n;n++){var o=t[n].findClass(e);if(o)return o}return null},t}();e.AssetTemplate=t}(Animate||(Animate={}));var Animate;!function(e){var t=function(){function e(e,t,n,i,o,r,s){void 0===i&&(i=!1),void 0===o&&(o=!1),void 0===r&&(r=!1),void 0===s&&(s=!1);for(var a=0;a<t.length;a++)for(var l=0;l<t.length;l++)if(l!=a&&t[a].property.name==t[l].property.name)throw new Error("You cannot have more than 1 property with the name "+t[a].property.name);this._behaviourName=e,this._canBuildOutput=o,this._canBuildInput=i,this._canBuildParameter=r,this._canBuildProduct=s,this._portalTemplates=t,this._plugin=n}return e.prototype.dispose=function(){this._behaviourName=null,this._canBuildOutput=null,this._canBuildInput=null,this._canBuildParameter=null,this._canBuildProduct=null,this._portalTemplates=null,this._plugin=null},e.prototype.canBuildOutput=function(e){return this._canBuildOutput},e.prototype.canBuildInput=function(e){return this._canBuildInput},e.prototype.canBuildProduct=function(e){return this._canBuildProduct},e.prototype.canBuildParameter=function(e){return this._canBuildParameter},e.prototype.portalsTemplates=function(){return this._portalTemplates},Object.defineProperty(e.prototype,"behaviourName",{get:function(){return this._behaviourName},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"plugin",{get:function(){return this._plugin},enumerable:!0,configurable:!0}),e}();e.BehaviourDefinition=t}(Animate||(Animate={}));var Animate;!function(e){var t=function(){function e(){}return e}();e.DataToken=t}(Animate||(Animate={}));var Animate;!function(e){var t=function(){function e(){}return e.USERS="http://webinate-test.net:8000",e.HOST="http://animate.webinate-test.net",e.API="http://animate.webinate-test.net/app-engine",e.PLAN_FREE="animate-free",e.PLAN_BRONZE="animate-bronze",e.PLAN_SILVER="animate-silver",e.PLAN_GOLD="animate-gold",e.PLAN_PLATINUM="animate-platinum",e}();e.DB=t}(Animate||(Animate={}));var Animate;!function(e){var t=function(e){function t(t){e.call(this,t)}return __extends(t,e),t.fromString=function(e){switch(e){case"complete":return t.COMPLETE;case"failed":return t.FAILED}return null},t.COMPLETE=new t("complete"),t.FAILED=new t("failed"),t}(e.ENUM);e.LoaderEvents=t;var n=function(t){function n(i){t.call(this),n.loaderBackdrop||(n.loaderBackdrop=n.createLoaderModal()),this.domain=void 0!==i?i:e.DB.HOST,this.url=null,this.data=null,this.numTries=null,this._getQuery="",this.getVariables=null,this.dataType="json",this.contentType="application/x-www-form-urlencoded; charset=UTF-8",this.processData=!0}return __extends(n,t),n.prototype.load=function(e,t,n){if(void 0===n&&(n=3),this.url=e,this.data=t,this.numTries=n,this.getVariables){this._getQuery="?";for(var i in this.getVariables)this._getQuery+=(1!=this._getQuery.length?"&":"")+i+"="+this.getVariables[i]}},n.createLoaderModal=function(){if(!n.loaderBackdrop){var e="<div class='modal-backdrop dark-modal'><div class='logo-container'><div class='logo-1 animated-logo rotate-360-slow'><img src='media/logo-1.png'/></div><div class='logo-2 animated-logo rotate-360'><img src='media/logo-2.png'/></div><div class='logo-3 animated-logo rotate-360-slow'><img src='media/logo-3.png'/></div><div class='logo-4 animated-logo'><img src='media/logo-4.png'/></div><div class='logo-5 animated-logo'><span class='loader-text'>LOADING</span></div></div></div>";n.loaderBackdrop=jQuery(e)}return n.loaderBackdrop},n.showLoader=function(){n.loaderBackdrop||n.createLoaderModal(),n.loaderBackdrop.show(),jQuery("body").append(n.loaderBackdrop),n.showCount++,jQuery(".loader-text",n.loaderBackdrop).text("LOADING: "+n.showCount+"%...")},n.hideLoader=function(){n.showCount--,jQuery(".loader-text",n.loaderBackdrop).text("LOADING: "+n.showCount+"%..."),0==n.showCount&&n.loaderBackdrop.remove()},n.prototype.dispose=function(){t.prototype.dispose.call(this),this.data=null},n.showCount=0,n}(e.EventDispatcher);e.LoaderBase=n}(Animate||(Animate={}));var Animate;!function(e){var t=function(e){function t(t){e.call(this,t)}return __extends(t,e),t.fromString=function(e){switch(e){case t.ERROR.toString():return t.ERROR;case t.SUCCESS.toString():default:return t.SUCCESS}return null},t.SUCCESS=new t("success"),t.ERROR=new t("error"),t}(e.ENUM);e.AnimateLoaderResponses=t;var n=function(e){function t(t,n,i,o){e.call(this,t,o),this.message=n,this.return_type=i,this.data=o}return __extends(t,e),t}(e.Event);e.AnimateLoaderEvent=n;var i=function(i){function o(e){i.call(this,e),this._curCall=null}return __extends(o,i),o.prototype.load=function(t,n,o,r){if(void 0===o&&(o=3),void 0===r&&(r="POST"),i.prototype.load.call(this,t,n,o),e.LoaderBase.showLoader(),t.match(/http/g))var s=t;else var s=this.domain+this.url+this._getQuery;this._curCall=jQuery.ajax({url:s,type:r,dataType:this.dataType,crossDomain:!0,cache:!0,processData:this.processData,contentType:this.contentType,accepts:"text/plain",data:n,success:this.onData.bind(this),error:this.onError.bind(this),xhrFields:{withCredentials:!0}})},o.prototype.onError=function(i,o,r){if(this.numTries>0){this.numTries>0&&this.numTries--;var s=this.domain+this.url+this._getQuery;this._curCall=jQuery.ajax({url:s,type:"POST",dataType:this.dataType,crossDomain:!0,cache:!0,processData:this.processData,contentType:this.contentType,accepts:"text/plain",data:this.data,success:this.onData.bind(this),error:this.onError.bind(this),xhrFields:{withCredentials:!0}})}else e.LoaderBase.hideLoader(),this.emit(new n(e.LoaderEvents.FAILED,r.message,t.ERROR,null)),this.dispose()},o.prototype.onData=function(i,o,r){e.LoaderBase.hideLoader();var s=null;s="text"==this.dataType?new n(e.LoaderEvents.COMPLETE,"Script Loaded",t.SUCCESS,null):"json"==this.dataType?new n(e.LoaderEvents.COMPLETE,i.message,t.fromString(i.return_type),i):new n(e.LoaderEvents.COMPLETE,"Loaded",t.SUCCESS,i),this.emit(s),this.dispose()},o.prototype.dispose=function(){i.prototype.dispose.call(this),this._curCall=null},o}(e.LoaderBase);e.AnimateLoader=i}(Animate||(Animate={}));var Animate;!function(e){var t=function(e){function t(t){e.call(this,t)}return __extends(t,e),t.SUCCESS=new t("binary_success"),t.ERROR=new t("binary_error"),t}(e.ENUM);e.BinaryLoaderResponses=t;var n=function(e){function t(t,n,i){void 0===i&&(i=""),e.call(this,t,n),this.buffer=n,this.message=i}return __extends(t,e),t}(e.Event);e.BinaryLoaderEvent=n;var i=function(i){function o(e){i.call(this,e),this._xhr=null,this._onBuffers=this.onBuffersLoaded.bind(this),this._onError=this.onError.bind(this)}return __extends(o,i),o.prototype.load=function(t,n){void 0===n&&(n=3),i.prototype.load.call(this,t,null,n),e.LoaderBase.showLoader(),this._xhr=new XMLHttpRequest,this._xhr.addEventListener("load",this._onBuffers,!1),this._xhr.addEventListener("error",this._onError,!1),this._xhr.withCredentials=!0,this._xhr.overrideMimeType&&this._xhr.overrideMimeType("text/plain; charset=x-user-defined");var o=this.domain+this.url+this._getQuery;this._xhr.open("GET",o,!0),this._xhr.responseType="arraybuffer",this._xhr.send(null)},o.prototype.onError=function(i){if(this.numTries>0){this.numTries>0&&this.numTries--;var o=this.domain+this.url+this._getQuery;this._xhr.open("GET",o,!0),this._xhr.send(null)}else e.LoaderBase.hideLoader(),this.emit(new n(t.ERROR,null,"Could not download data from '"+o+"'")),this.dispose()},o.prototype.dispose=function(){this._xhr.removeEventListener("load",this._onBuffers,!1),this._xhr.removeEventListener("error",this._onError,!1),this._xhr=null,i.prototype.dispose.call(this)},o.prototype.onBuffersLoaded=function(){var i=this._xhr,o=i.response;if(void 0===o&&(o=new Uint8Array(i.responseBody).buffer),0==o.byteLength){o=new ArrayBuffer(i.responseText.length);for(var r=new Uint8Array(o),s=0,a=i.responseText.length;a>s;s++)r[s]=255&i.responseText.charCodeAt(s)}e.LoaderBase.hideLoader();var l=new n(t.SUCCESS,o);this.emit(l),this.dispose()},o}(e.LoaderBase);e.BinaryLoader=i}(Animate||(Animate={}));var Animate;!function(e){var t=function(){function e(e,t){this.type=t,this.property=e}return e}();e.PortalTemplate=t}(Animate||(Animate={}));var Animate;!function(e){var t=function(){function e(e){this.value=e}return e.prototype.toString=function(){return this.value},e.SAVED=new e("saved"),e.SAVED_ALL=new e("saved_all"),e.FAILED=new e("failed"),e.BUILD_SELECTED=new e("build_selected"),e.BUILD_SAVED=new e("build_saved"),e}();e.ProjectEvents=t;var n=function(){function t(e){this.entry=e}return t.prototype.update=function(t){var n=this.entry,i=this;return new Promise(function(o,r){e.Utils.put(e.DB.API+"/builds/"+i.entry.user+"/"+i.entry.projectId+"/"+i.entry._id,t).then(function(e){if(e.error)return r(new Error(e.message));for(var i in t)n.hasOwnProperty(i)&&(n[i]=t[i]);return o(!0)})["catch"](function(e){return r(new Error("An error occurred while connecting to the server. "+e.status+": "+e.message))})})},t}();e.Build=n;var i=function(t){function i(){t.call(this),this.saved=!0,this._containers=[],this._assets=[],this._files=[],this._scripts=[],this._groups=[],this._restPaths={},this._restPaths[e.ResourceType.FILE]={url:e.DB.API+"/files",array:this._files},this._restPaths[e.ResourceType.ASSET]={url:e.DB.API+"/assets",array:this._assets},this._restPaths[e.ResourceType.CONTAINER]={url:e.DB.API+"/containers",array:this._containers},this._restPaths[e.ResourceType.GROUP]={url:e.DB.API+"/groups",array:this._groups},this._restPaths[e.ResourceType.SCRIPT]={url:e.DB.API+"/scripts",array:this._scripts}}return __extends(i,t),i.prototype.getResourceByID=function(e,t){var n=this._restPaths;if(t){for(var i=0,o=n[t].array,r=o.length;r>i;i++)if(o[i].entry._id==e)return{resource:o[i],type:t}}else for(var s in n)for(var i=0,o=n[s].array,r=o.length;r>i;i++)if(o[i].entry._id==e)return{resource:o[i],type:s};return null},i.prototype.getResourceByShallowID=function(e,t){var n=this._restPaths;if(t){for(var i=0,o=n[t].array,r=o.length;r>i;i++)if(o[i].entry.shallowId==e)return o[i]}else for(var s in n)for(var i=0,o=n[s].array,r=o.length;r>i;i++)if(o[i].entry.shallowId==e)return o[i];return null},i.prototype.updateDetails=function(t){var n=this.entry,i=this;return new Promise(function(o,r){e.Utils.put(e.DB.API+"/projects/"+i.entry.user+"/"+i.entry._id,t).then(function(e){if(e.error)return r(new Error(e.message));for(var i in t)n.hasOwnProperty(i)&&(n[i]=t[i]);return o(e)})["catch"](function(e){return r(new Error("An error occurred while connecting to the server. "+e.status+": "+e.message))})})},i.prototype.loadBuild=function(){var t=this,i=e.User.get.entry.username;return new Promise(function(o,r){var s;s=t.entry.build&&""!=t.entry.build?e.Utils.get(e.DB.API+"/builds/"+i+"/"+t.entry._id+"/"+t.entry.build):e.Utils.post(e.DB.API+"/builds/"+i+"/"+t.entry._id+"?set-current=true",null),s.then(function(e){return e.error?r(new Error(e.message)):(t.curBuild=new n(e.data[0]),o(t.curBuild))})["catch"](function(e){return r(new Error("An error occurred while connecting to the server. "+e.status+": "+e.message))})})},i.prototype.createResourceInstance=function(t,n){var i;if(n==e.ResourceType.ASSET){var o=e.PluginManager.getSingleton().getAssetClass(t.className);i=new e.Asset(o,t),this._assets.push(i)}else n==e.ResourceType.SCRIPT?(i=new e.ScriptResource(t),this._scripts.push(i)):n==e.ResourceType.CONTAINER?(i=new e.Container(t),this._containers.push(i)):n==e.ResourceType.GROUP?(i=new e.GroupArray(t),this._groups.push(i)):n==e.ResourceType.FILE&&(i=new e.FileResource(t),this._files.push(i));return i.initialize(),this.emit(new e.ProjectEvent("resource-created",i)),i},i.prototype.loadResources=function(t){var n=this,i=[],o=this._restPaths;if(t){for(var r=0,s=o[t].array,a=s.length;a>r;r++)s[r].emit(new e.Event("deleted"));i.push(e.Utils.get(o[t].url+"/"+this.entry.user+"/"+this.entry._id)),o[t].array.splice(0,o[t].array.length)}else{for(var l in o)for(var r=0,s=o[l].array,a=s.length;a>r;r++)s[r].emit(new e.Event("deleted"));this._assets.splice(0,this._assets.length),this._files.splice(0,this._files.length),this._scripts.splice(0,this._scripts.length),this._containers.splice(0,this._containers.length),this._groups.splice(0,this._groups.length),i.push(e.Utils.get(o[e.ResourceType.FILE].url+"/"+this.entry.user+"/"+this.entry._id)),i.push(e.Utils.get(o[e.ResourceType.ASSET].url+"/"+this.entry.user+"/"+this.entry._id)),i.push(e.Utils.get(o[e.ResourceType.CONTAINER].url+"/"+this.entry.user+"/"+this.entry._id)),i.push(e.Utils.get(o[e.ResourceType.GROUP].url+"/"+this.entry.user+"/"+this.entry._id)),i.push(e.Utils.get(o[e.ResourceType.SCRIPT].url+"/"+this.entry.user+"/"+this.entry._id))}return new Promise(function(o,r){Promise.all(i).then(function(i){for(var s=0,a=i.length;a>s;s++)if(i[s].error)return r(new Error(i[s].message));var l=[];if(t){if(t==e.ResourceType.FILE)for(var s=0,a=i[0].data.length;a>s;s++)l.push(n.createResourceInstance(i[0].data[s],e.ResourceType.FILE));else if(t==e.ResourceType.ASSET)for(var s=0,a=i[0].data.length;a>s;s++)l.push(n.createResourceInstance(i[0].data[s],e.ResourceType.ASSET));else if(t==e.ResourceType.CONTAINER)for(var s=0,a=i[0].data.length;a>s;s++)l.push(n.createResourceInstance(i[0].data[s],e.ResourceType.CONTAINER));else if(t==e.ResourceType.GROUP)for(var s=0,a=i[0].data.length;a>s;s++)l.push(n.createResourceInstance(i[0].data[s],e.ResourceType.GROUP));else if(t==e.ResourceType.SCRIPT)for(var s=0,a=i[0].data.length;a>s;s++)l.push(n.createResourceInstance(i[0].data[s],e.ResourceType.SCRIPT))}else{for(var s=0,a=i[0].data.length;a>s;s++)l.push(n.createResourceInstance(i[0].data[s],e.ResourceType.FILE));for(var s=0,a=i[1].data.length;a>s;s++)l.push(n.createResourceInstance(i[1].data[s],e.ResourceType.ASSET));for(var s=0,a=i[2].data.length;a>s;s++)l.push(n.createResourceInstance(i[2].data[s],e.ResourceType.CONTAINER));for(var s=0,a=i[3].data.length;a>s;s++)l.push(n.createResourceInstance(i[3].data[s],e.ResourceType.GROUP));for(var s=0,a=i[4].data.length;a>s;s++)l.push(n.createResourceInstance(i[4].data[s],e.ResourceType.SCRIPT))}return o(l)})["catch"](function(e){return r(new Error("An error occurred while connecting to the server. "+e.status+": "+e.message))})})},i.prototype.refreshResource=function(t,n){var i=this,o=this._restPaths,r=this.getResourceByID(t,n);return r?new Promise(function(n,s){e.Utils.get(o[r.type].url+"/"+i.entry.user+"/"+i.entry._id+"/"+t).then(function(t){if(t.error)return s(new Error(t.message));if(0==t.data.length)return n(r.resource);for(var i in t.data[0])r.resource.entry.hasOwnProperty(i)&&(r.resource.entry[i]=t.data[0][i]);return r.resource.emit(new e.Event("refreshed")),r.resource.saved=!0,n(r.resource)})["catch"](function(e){return s(new Error("An error occurred while connecting to the server. "+e.status+": "+e.message))})}):Promise.reject(new Error("Could not find a resource with that ID"))},i.prototype.editResource=function(t,n,i){for(var o,r=e.User.get.entry,s=this.entry._id,a=this._restPaths,l=a[i].url+"/"+r.username+"/"+s+"/"+t,h=a[i].array,c=0,u=h.length;u>c;c++)if(h[c].entry._id==t){o=h[c];break}return o?new Promise(function(t,i){e.Utils.put(l,n).then(function(r){if(r.error)return i(new Error(r.message));for(var s in n)o.entry.hasOwnProperty(s)&&(o.entry[s]=n[s]);return o.emit(new e.Event("refreshed")),t(r)})["catch"](function(e){i(new Error("An error occurred while connecting to the server. "+e.status+": "+e.message))})}):Promise.reject(new Error("No resource with that ID exists"))},i.prototype.saveResource=function(t,n){var i=this._restPaths,o=e.User.get.entry,r=this.entry._id,s=this.getResourceByID(t,n),a=i[s.type].url+"/"+o.username+"/"+r+"/"+t,l=s.resource;return l.onSaving(),new Promise(function(t,i){e.Utils.put(a,l.entry).then(function(o){return o.error?i(new Error("Could not save "+e.ResourceType[n].toLowerCase()+" resource ["+l.entry._id+"]: '"+o.message+"'")):(l.saved=!0,t(!0))})["catch"](function(e){i(new Error("An error occurred while connecting to the server. "+e.status+": "+e.message))})})},i.prototype.saveResources=function(e){for(var t=this._restPaths,n=[],i=0,o=t[e].array,r=o.length;r>i;i++)n.push(this.saveResource(o[i].entry._id,e));return new Promise(function(e,t){Promise.all(n).then(function(t){e(!0)})["catch"](function(e){t(e)})})},i.prototype.deleteResource=function(t,n){for(var i,o=e.User.get.entry,r=this.entry._id,s=this._restPaths,a=s[n].url+"/"+o.username+"/"+r+"/"+t,l=s[n].array,h=0,c=l.length;c>h;h++)if(l[h].entry._id==t){i=l[h];break}return i?new Promise(function(t,n){e.Utils["delete"](a).then(function(o){return o.error?n(new Error(o.message)):(l.splice(l.indexOf(i),1),i.emit(new e.Event("deleted")),t(!0))})["catch"](function(e){n(new Error("An error occurred while connecting to the server. "+e.status+": "+e.message))})}):Promise.reject(new Error("No resource with that ID exists"))},i.prototype.copyResource=function(t,n){var i=this.getResourceByID(t,n),o=i.resource,r=JSON.parse(JSON.stringify(o));return r.shallowId=e.Utils.generateLocalId(),this.createResource(n,r)},i.prototype.deleteResources=function(e){var t=[],n=this._restPaths;for(var i in n)for(var o=0,r=n[i].array,s=r.length;s>o;o++)for(var a=0,l=e.length;l>a;a++)if(r[o].entry._id==e){t.push(this.deleteResource(r[o].entry._id,i));break}return new Promise(function(e,n){Promise.all(t).then(function(t){e(!0)})["catch"](function(e){n(e)})})},i.prototype.saveAll=function(){var e=[];for(var t in this._restPaths)e.push(this.saveResources(t));return new Promise(function(t,n){Promise.all(e).then(function(e){t(!0)})["catch"](function(e){n(e)})})},i.prototype.createResource=function(t,n){var i=this,o=e.User.get.entry,r=this.entry._id,s=this._restPaths,a=s[t].url+"/"+o.username+"/"+r;return new Promise(function(o,r){e.Utils.post(a,n).then(function(n){if(n.error)return r(new Error(n.message));var s;return t==e.ResourceType.ASSET?s=i.createResourceInstance(n.data,e.ResourceType.ASSET):t==e.ResourceType.CONTAINER?s=i.createResourceInstance(n.data,e.ResourceType.CONTAINER):t==e.ResourceType.GROUP?s=i.createResourceInstance(n.data,e.ResourceType.GROUP):t==e.ResourceType.SCRIPT&&(s=i.createResourceInstance(n.data,e.ResourceType.SCRIPT)),o(s)})["catch"](function(e){return r(new Error("An error occurred while connecting to the server. "+e.status+": "+e.message))})})},i.prototype.selectBuild=function(t,n,i){var o=new e.AnimateLoader;o.on(e.LoaderEvents.COMPLETE,this.onServer,this),o.on(e.LoaderEvents.FAILED,this.onServer,this),o.load("/project/select-build",{projectId:this.entry._id,major:t,mid:n,minor:i})},i.prototype.saveBuild=function(t,n,i,o){var r=new e.AnimateLoader;r.on(e.LoaderEvents.COMPLETE,this.onServer,this),r.on(e.LoaderEvents.FAILED,this.onServer,this),r.load("/project/save-build",{projectId:this.entry._id,buildId:this.entry.build,notes:t,visibility:n,html:i,css:o})},i.prototype.onServer=function(t,n,i){var o=n.tag,r=(e.PluginManager.getSingleton(),i);if(t==e.LoaderEvents.COMPLETE)if(n.return_type==e.AnimateLoaderResponses.SUCCESS){if("/project/select-build"==r.url)this.curBuild=o.build;else if("/project/save-build"==r.url);else if("/project/get-groups"==r.url)for(var s=0,a=o.length;a>s;s++){o[s]}else if("/project/update-assets"==r.url)for(var l=0;l<o.length;l++)for(var s=0;s<this._assets.length;s++)this._assets[s].entry._id==o[l]._id&&this._assets[s].update(o[l].name,o[l].className,o[l].json)}else e.MessageBox.show(n.message,Array("Ok"),null,null)},Object.defineProperty(i.prototype,"containers",{get:function(){return this._containers},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"files",{get:function(){return this._files},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"scripts",{get:function(){return this._scripts},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"assets",{get:function(){return this._assets},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"groups",{get:function(){return this._groups},enumerable:!0,configurable:!0}),i.prototype.reset=function(){this.entry=null;for(var t,n=e.PluginManager.getSingleton(),i=this._containers.length;i--;)this._containers[i].dispose();for(i=this._assets.length,t=new e.AssetEvent(e.EditorEvents.ASSET_DESTROYED,null);i--;)t.asset=this._assets[i],n.emit(t),this._assets[i].dispose();this.saved=!0,this._containers.splice(0,this._containers.length),this._assets.splice(0,this._assets.length),this._groups.splice(0,this._groups.length),this._files.splice(0,this._files.length),this._scripts.splice(0,this._scripts.length)},Object.defineProperty(i.prototype,"plugins",{get:function(){return this.entry.$plugins},enumerable:!0,configurable:!0}),i}(e.EventDispatcher);e.Project=i}(Animate||(Animate={}));var Animate;!function(e){var t=function(){function e(e,t,n,i){this.typeA=e,this.typeB=t,this.conversionOptions=n,this.plugin=i}return e.prototype.canConvert=function(e,t){return this.typeA==e&&this.typeB==t?!0:!1},e.prototype.dispose=function(){this.typeA=null,this.typeB=null,this.conversionOptions=null,this.plugin=null},e}();e.TypeConverter=t}(Animate||(Animate={}));var Animate;!function(e){var t=function(t){function n(){t.call(this),n._singleton=this,e.EventDispatcher.call(this),this.entry={username:""},this.resetMeta(),this.project=new e.Project,this._isLoggedIn=!1}return __extends(n,t),n.prototype.resetMeta=function(){this.meta={bio:"",plan:e.UserPlan.Free,imgURL:"media/blank-user.png",maxNumProjects:0}},n.prototype.authenticated=function(){this._isLoggedIn=!1;var t=this;return new Promise(function(n,i){e.Utils.get(e.DB.USERS+"/users/authenticated").then(function(o){return o.error?i(new Error(o.message)):o.authenticated?(t.entry=o.user,t._isLoggedIn=!0,jQuery.getJSON(e.DB.API+"/user-details/"+o.user.username)):(t._isLoggedIn=!1,t.resetMeta(),n(!1))}).then(function(e){return e.error?i(new Error(e.message)):(t.meta=e.data,n(!0))})["catch"](function(e){return i(new Error("An error occurred while connecting to the server. "+e.status+": "+e.message))})})},n.prototype.login=function(t,n,i){var o,r={username:t,password:n,rememberMe:i},s=this;return new Promise(function(t,n){e.Utils.post(e.DB.USERS+"/users/login",r).then(function(i){return o=i,i.error?n(new Error(i.message)):i.authenticated?(s._isLoggedIn=!0,s.entry=i.user,jQuery.getJSON(e.DB.API+"/user-details/"+i.user.username)):(s._isLoggedIn=!1,s.resetMeta(),t(i))}).then(function(e){return e.error?n(new Error(e.message)):(s.meta=e.data,t(o))})["catch"](function(e){return s._isLoggedIn=!1,n(new Error("An error occurred while connecting to the server. "+e.status+": "+e.message))})})},n.prototype.register=function(t,n,i,o,r){var s=this,a={username:t,password:n,email:i,captcha:o,challenge:r};return new Promise(function(t,n){e.Utils.post(e.DB.USERS+"/users/register",a).then(function(e){return e.error?n(new Error(e.message)):(e.authenticated?(s._isLoggedIn=!1,s.entry=e.user):s._isLoggedIn=!1,t(e))})["catch"](function(e){return n(new Error("An error occurred while connecting to the server. "+e.status+": "+e.message))})})},n.prototype.resendActivation=function(t){return new Promise(function(n,i){e.Utils.get(e.DB.USERS+"/users/resend-activation/"+t).then(function(e){return e.error?i(new Error(e.message)):n(e)})["catch"](function(e){return i(new Error("An error occurred while connecting to the server. "+e.status+": "+e.message))})})},n.prototype.resetPassword=function(t){return new Promise(function(n,i){e.Utils.get(e.DB.USERS+"/users/request-password-reset/"+t).then(function(e){return e.error?i(new Error(e.message)):n(e)})["catch"](function(e){return i(new Error("An error occurred while connecting to the server. "+e.status+": "+e.message))})})},n.prototype.logout=function(){var t=this;return new Promise(function(n,i){e.Utils.get(e.DB.USERS+"/users/logout").then(function(o){return o.error?i(new Error(o.message)):(t.entry={username:""},t.meta={bio:"",plan:e.UserPlan.Free,imgURL:"media/blank-user.png",maxNumProjects:0},t._isLoggedIn=!1,n(o))})["catch"](function(e){return i(new Error("An error occurred while connecting to the server. "+e.status+": "+e.message))})})},n.prototype.getProjectList=function(t,n){var i=this;return new Promise(function(o,r){e.Utils.get(e.DB.API+"/projects/"+i.entry.username+"?verbose=true&index="+t+"&limit="+n).then(function(e){if(e.error)return r(new Error(e.message));for(var t=0,n=e.data.length;n>t;t++){for(var i=e.data[t],s=[],a=0,l=i.plugins.length;l>a;a++)s.push(getPluginByID(i.plugins[a]));i.$plugins=s}return o(e)})["catch"](function(e){return r(new Error("An error occurred while connecting to the server. "+e.status+": "+e.message))})})},n.prototype.newProject=function(t,n,i){void 0===i&&(i="");var o={name:t,description:i,plugins:n};return new Promise(function(t,n){e.Utils.post(e.DB.API+"/projects/create",o).then(function(e){if(e.error)return n(new Error(e.message));for(var i=e.data,o=[],r=0,s=i.plugins.length;s>r;r++)o.push(getPluginByID(i.plugins[r]));return i.$plugins=o,t(e)})["catch"](function(e){n(new Error("An error occurred while connecting to the server. "+e.status+": "+e.message))})})},n.prototype.removeProject=function(t){var n=this;return new Promise(function(i,o){e.Utils["delete"](e.DB.API+"/projects/"+n.entry.username+"/"+t).then(function(e){return e.error?o(new Error(e.message)):i(e)})["catch"](function(e){return o(new Error("An error occurred while connecting to the server. "+e.status+": "+e.message))})})},n.prototype.updateDetails=function(t){var n=this.meta,i=this;return new Promise(function(o,r){e.Utils.put(e.DB.API+"/user-details/"+i.entry.username,t).then(function(e){if(e.error)return r(new Error(e.message));for(var i in t)n.hasOwnProperty(i)&&(n[i]=t[i]);return o(e)})["catch"](function(e){return r(new Error("An error occurred while connecting to the server. "+e.status+": "+e.message))})})},n.prototype.copyProject=function(t){var n=new e.AnimateLoader;n.on(e.LoaderEvents.COMPLETE,this.onServer,this),n.on(e.LoaderEvents.FAILED,this.onServer,this),n.load("/project/copy",{id:t})},n.prototype.openProject=function(t){if(this._isLoggedIn){var n=new e.AnimateLoader;n.on(e.LoaderEvents.COMPLETE,this.onServer,this),n.on(e.LoaderEvents.FAILED,this.onServer,this),n.load("/project/open",{id:t})}},n.prototype.deleteProject=function(t){if(!this._isLoggedIn)return null;this.project.entry=null;var n=new e.AnimateLoader;n.on(e.LoaderEvents.COMPLETE,this.onServer,this),n.on(e.LoaderEvents.FAILED,this.onServer,this),n.load("/project/delete",{id:t})},n.prototype.onServer=function(t,n,i){var o=n.tag,r=i;if(t==e.LoaderEvents.COMPLETE){if(n.return_type==e.AnimateLoaderResponses.ERROR)return;"/user/log-in"==r.url?this._isLoggedIn=!0:"/user/log-out"==r.url?(this.entry.username="",this._isLoggedIn=!1):"/project/create"==r.url||"/project/rename"==r.url||r.url.match(/authenticated/)&&o.loggedIn&&(this.entry.username=o.username,this.entry.meta.bio=o.bio,this.entry.meta.plan=o.plan,this.entry.meta.maxNumProjects=o.maxProjects,this.entry.meta.imgURL=""==o.image||null==o.image?"media/blank-user.png":o.image,this.entry.meta.createdOn=o.createdOn,this._isLoggedIn=!0)}},Object.defineProperty(n.prototype,"isLoggedIn",{get:function(){return this._isLoggedIn},enumerable:!0,configurable:!0}),Object.defineProperty(n,"get",{get:function(){return n._singleton||new n,n._singleton},enumerable:!0,configurable:!0}),n._singleton=null,n}(e.EventDispatcher);e.User=t}(Animate||(Animate={}));var Animate;!function(e){var t=function(){function e(e){this.updateFunc=e,this.index=0,this.limit=10,this.last=1,this.searchTerm=""}return e.prototype.invalidate=function(){this.updateFunc(this.index,this.limit)},e.prototype.getPageNum=function(){return this.index/this.limit+1},e.prototype.getTotalPages=function(){return Math.ceil(this.last/this.limit)},e.prototype.goFirst=function(){this.index=0,this.updateFunc(this.index,this.limit)},e.prototype.goLast=function(){this.index=this.last-(this.last-this.limit)%this.limit,this.index<0&&(this.index=0),this.updateFunc(this.index,this.limit)},e.prototype.goNext=function(){this.index+=this.limit,this.updateFunc(this.index,this.limit)},e.prototype.goPrev=function(){this.index-=this.limit,this.index<0&&(this.index=0),this.updateFunc(this.index,this.limit)},e}();e.PageLoader=t}(Animate||(Animate={}));var Animate;!function(e){var t=function(){function e(){this._maxPreviewSize=200}return e.prototype.generate=function(e,t){if("image/jpeg"==e.extension||"image/png"==e.extension||"image/gif"==e.extension||"image/bmp"==e.extension||"image/jpg"==e.extension){var n=this._maxPreviewSize,i=document.createDocumentFragment(),o=i.appendChild(document.createElement("div"));if(o.innerHTML='<div class="img-preview"><div class="preview-child background-tiles"><div class="inner"><img class="vert-align" src="'+e.url+'" /><div class="div-center"></div></div></div></div>',!e.previewUrl||""==e.previewUrl.toString().trim()){var r=o.querySelector("img");
r.crossOrigin="Anonymous",r.onload=function(i){var o=document.createElement("canvas"),s=r.naturalWidth,a=r.naturalHeight;s>a?s>n&&(a*=n/s,s=n):a>n&&(s*=n/a,a=n),o.width=s,o.height=a,o.getContext("2d").drawImage(r,0,0,s,a),t(e,o)}}return i.firstChild}return null},e}();e.ImageVisualizer=t}(Animate||(Animate={}));var Animate;!function(e){var t=function(){function t(e,t){this.percent=0,this._dCount=0,this._onProg=e,this._onComplete=t,this._downloads=[]}return Object.defineProperty(t.prototype,"numDownloads",{get:function(){return this._downloads.length},enumerable:!0,configurable:!0}),t.prototype.uploadFile=function(e,t,n){var i=new FormData;t&&i.append("meta",JSON.stringify(t)),i.append(e.name,e),this.upload(i,null,e.name,n)},t.prototype.upload2DElement=function(e,t,n,i){var o;if(e instanceof HTMLImageElement){o=document.createElement("canvas"),o.width=e.width,o.height=e.height;var r=o.getContext("2d");r.drawImage(e,0,0)}else o=e;for(var s=o.toDataURL(),a=atob(s.split(",")[1]),l=s.split(",")[0].split(":")[1].split(";")[0],h=new ArrayBuffer(a.length),c=new Uint8Array(h),u=0;u<a.length;u++)c[u]=a.charCodeAt(u);var p;p=s.indexOf("png")?new Blob([h],{type:l}):new Blob([h],{type:l});var d=new FormData;n&&d.append("meta",JSON.stringify(n)),d.append(t,p),this.upload(d,null,t,i)},t.prototype.uploadArrayBuffer=function(e,t,n,i){var o=new FormData;return n&&o.append("meta",JSON.stringify(n)),o.append(t,new Blob([e],{type:"application/octet-stream"})),this.upload(o,null,t,i)},t.prototype.uploadTextAsFile=function(e,t,n,i){var o=new FormData;return n&&o.append("meta",JSON.stringify(n)),o.append(t,new Blob([e],{type:"text/plain"})),this.upload(o,null,t,i)},t.prototype.upload=function(t,n,i,o){if(!n){var r=e.User.get.entry;n=e.DB.USERS+"/media/upload/"+r.username+"-bucket"+(o?"/"+o:"")}var s=this,a=new XMLHttpRequest,l=s._dCount++,h=s._onProg,c=s._onComplete,u=null;s._downloads.push({id:l,loaded:0,total:0});var p=function(){if(h){for(var e=0,t=0,n=0,i=s._downloads.length;i>n;n++)e+=s._downloads[n].total,t+=s._downloads[n].loaded;s.percent=Math.floor(t/e*1e3)/10,h(s.percent)}};a.onerror=function(e){for(var t=0,n=s._downloads.length;n>t;t++)if(s._downloads[t].id==l){s._downloads.splice(t,1);break}u="An error occurred while uploading the file '"+i+"' : ",p()},h&&a.upload&&(a.upload.onprogress=function(e){for(var t=0,n=s._downloads.length;n>t;t++)if(s._downloads[t].id==l){s._downloads[t].total=e.total,s._downloads[t].loaded=e.loaded;break}p()}),a.onreadystatechange=function(){if(4==a.readyState){for(var e=0,t=s._downloads.length;t>e;e++)if(s._downloads[e].id==l){s._downloads.splice(e,1);break}if(p(),200!==a.status)u="XHR returned response code : "+a.status;else{var n=JSON.parse(a.responseText);n.error?(u=n.message,c(new Error(u),null)):0==s._downloads.length&&c&&(u?c(new Error(u),null):c(null,n.tokens))}}},a.withCredentials=!0,a.open("post",n,!0),a.setRequestHeader("X-Requested-With","XMLHttpRequest"),a.setRequestHeader("Cache-Control","no-cache"),a.send(t)},t}();e.FileUploader=t}(Animate||(Animate={}));var Animate;!function(e){var t=function(){function t(e){this._variables=[],this.parent=e}return t.prototype.addVar=function(e){for(var t=this._variables,n=0;n<t.length;n++)if(t[n].name==e.name)throw new Error("A property with the name '"+e.name+"' already exists");e.set=this,this._variables.push(e)},t.prototype.getVar=function(e){for(var t=this._variables,n=0,i=t.length;i>n;n++)if(t[n].name==e)return t[n];return null},t.prototype.removeVar=function(e){for(var t=this._variables,n=0,i=t.length;i>n;n++)t[n].name==e&&(t[n].set=null,t[n].dispose(),t.splice(n,1))},t.prototype.notifyEdit=function(t){this.parent.emit(new e.EditEvent(t,this))},t.prototype.updateValue=function(e,t){for(var n=this._variables,i=0,o=n.length;o>i;i++)if(n[i].name==e)return n[i].setVal(t),n[i].getVal();return null},t.prototype.tokenize=function(e){void 0===e&&(e=!1);for(var t={},n=this._variables,i=0;i<n.length;i++)t[n[i].name]=n[i].tokenize(e);return t},t.prototype.deTokenize=function(t){var n=this._variables;n.splice(0,n.length);for(var i in t){var o=e.Utils.createProperty(t[i].name,t[i].type);o.set=this,o.deTokenize(t[i]),n.push(o)}},Object.defineProperty(t.prototype,"variables",{get:function(){return this._variables},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){this._variables=null,this.parent=null},t}();e.EditableSet=t}(Animate||(Animate={}));var Animate;!function(e){var t=function(){function t(t,n,i,o,r){void 0===r&&(r=e.PropertyType.OBJECT),this.name=t,this._value=n,this.category=i||"General Properties",this.options=o,this.set=null,this.type=r}return t.prototype.clone=function(e){return new t(this.name,this._value,this.category,this.options,this.type)},t.prototype.getVal=function(){return this._value},t.prototype.tokenize=function(e){return void 0===e&&(e=!1),e?this._value:{value:this._value,name:this.name,type:this.type,category:this.category,options:this.options}},t.prototype.deTokenize=function(e){this._value=e.value,this.category=e.category,this.options=e.options,this.name=e.name,this.type=e.type},t.prototype.setVal=function(e){this._value=e,this.set.notifyEdit(this)},t.prototype.dispose=function(){this.name=null,this._value=null,this.category=null,this.options=null},t.prototype.toString=function(){var t=e.PropertyType[this.type].replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()});return this.name+" : "+t+" - "+(void 0!==this._value&&null!==this._value?this._value.toString():"")},t}();e.Prop=t;var n=function(t){function n(n,i,o,r){t.call(this,n,i,o,r,e.PropertyType.BOOL)}return __extends(n,t),n.prototype.clone=function(e){return new n(this.name,this._value,this.category,this.options)},n}(t);e.PropBool=n;var i=function(t){function n(n,i,o,r){t.call(this,n,i,o,r,e.PropertyType.STRING)}return __extends(n,t),n.prototype.clone=function(e){return new n(this.name,this._value,this.category,this.options)},n}(t);e.PropText=i}(Animate||(Animate={}));var Animate;!function(e){var t=function(t){function n(n,i,o,r,s){t.call(this,n,i,r,s,e.PropertyType.ENUM),this.choices=o}return __extends(n,t),n.prototype.tokenize=function(e){if(void 0===e&&(e=!1),e)return t.prototype.tokenize.call(this,e);var n=t.prototype.tokenize.call(this,e);return n.choices=this.choices,n},n.prototype.clone=function(e){return new n(this.name,this._value,this.choices,this.category,this.options)},n.prototype.deTokenize=function(e){t.prototype.deTokenize.call(this,e),this.choices=e.choices},n}(e.Prop);e.PropEnum=t}(Animate||(Animate={}));var Animate;!function(e){var t=function(t){function n(n,i,o,r,s){t.call(this,n,i,r,s,e.PropertyType.FILE),this.extensions=o}return __extends(n,t),n.prototype.clone=function(e){return new n(this.name,this._value,this.extensions,this.category,this.options)},n.prototype.tokenize=function(e){if(void 0===e&&(e=!1),e)return t.prototype.tokenize.call(this,e);var n=t.prototype.tokenize.call(this,e);return n.extensions=this.extensions,n},n.prototype.deTokenize=function(e){t.prototype.deTokenize.call(this,e),this.extensions=e.extensions},n}(e.Prop);e.PropFileResource=t}(Animate||(Animate={}));var Animate;!function(e){var t=function(t){function n(n,i,o,r,s,a,l,h){void 0===o&&(o=-Number.MAX_VALUE),void 0===r&&(r=Number.MAX_VALUE),void 0===s&&(s=0),void 0===a&&(a=1),t.call(this,n,i,l,h,e.PropertyType.NUMBER),this.min=o,this.max=r,this.decimals=s,this.interval=a}return __extends(n,t),n.prototype.getVal=function(){return this._value<this.min?this.min:this._value>this.max?this.max:parseInt(this._value.toFixed(this.decimals))},n.prototype.tokenize=function(e){if(void 0===e&&(e=!1),e)return t.prototype.tokenize.call(this,e);var n=t.prototype.tokenize.call(this,e);return n.min=this.min,n.max=this.max,n.decimals=this.decimals,n.interval=this.interval,n},n.prototype.deTokenize=function(e){t.prototype.deTokenize.call(this,e),this.min=null===e.min||void 0===e.min?-Number.MAX_VALUE:e.min,this.max=null===e.max||void 0===e.max?Number.MAX_VALUE:e.max,this.decimals=e.decimals,this.interval=e.interval},n.prototype.clone=function(e){return new n(this.name,this._value,this.min,this.max,this.decimals,this.interval,this.category,this.options)},n}(e.Prop);e.PropNum=t}(Animate||(Animate={}));var Animate;!function(e){var t=function(t){function n(n,i,o,r){t.call(this,n,i,o,r,e.PropertyType.OBJECT)}return __extends(n,t),n.prototype.clone=function(e){return new n(this.name,this._value,this.category,this.options)},n}(e.Prop);e.PropObject=t}(Animate||(Animate={}));var Animate;!function(e){var t=function(t){function n(n,i,o,r,s){void 0===o&&(o=[]),t.call(this,n,i,r,s,e.PropertyType.ASSET),this.classNames=o}return __extends(n,t),n.prototype.tokenize=function(e){if(void 0===e&&(e=!1),e)return t.prototype.tokenize.call(this,e);var n=t.prototype.tokenize.call(this,e);return n.classNames=this.classNames,n.value=this._value?this._value.entry.shallowId:-1,n},n.prototype.deTokenize=function(n){n.value=e.User.get.project.getResourceByShallowID(n.value),t.prototype.deTokenize.call(this,n),this.classNames=n.classNames},n.prototype.clone=function(e){return new n(this.name,this._value,this.classNames,this.category,this.options)},n}(e.Prop);e.PropAsset=t}(Animate||(Animate={}));var Animate;!function(e){var t=function(t){function n(n,i,o,r){t.call(this,n,i,o,r,e.PropertyType.GROUP)}return __extends(n,t),n.prototype.tokenize=function(e){if(void 0===e&&(e=!1),e)return t.prototype.tokenize.call(this,e);var n=t.prototype.tokenize.call(this,e);return n.value=this._value?this._value.entry.shallowId:-1,n},n.prototype.deTokenize=function(n){n.value=e.User.get.project.getResourceByShallowID(n.value),t.prototype.deTokenize.call(this,n)},n.prototype.clone=function(e){return new n(this.name,this._value,this.category,this.options)},n}(e.Prop);e.PropGroup=t}(Animate||(Animate={}));var Animate;!function(e){var t=function(t){function n(n,i,o,r,s){t.call(this,n,i,r,s,e.PropertyType.ASSET_LIST),this.classNames=o}return __extends(n,t),n.prototype.tokenize=function(e){if(void 0===e&&(e=!1),e)return t.prototype.tokenize.call(this,e);var n=t.prototype.tokenize.call(this,e);return n.classNames=this.classNames,n},n.prototype.deTokenize=function(e){t.prototype.deTokenize.call(this,e),this.classNames=e.classNames},n.prototype.clone=function(e){return new n(this.name,this._value,this.classNames,this.category,this.options)},n}(e.Prop);e.PropAssetList=t}(Animate||(Animate={}));var Animate;!function(e){var t=function(){function e(e,t){void 0===e&&(e=16777215),void 0===t&&(t=1),this.color=e,this.alpha=t}return e.prototype.toString=function(){return"#"+this.color.toString(16)+":"+this.alpha},e}();e.Color=t;var n=function(n){function i(i,o,r,s,a){void 0===r&&(r=1),n.call(this,i,new t(o,r),s,a,e.PropertyType.COLOR)}return __extends(i,n),i.prototype.tokenize=function(e){if(void 0===e&&(e=!1),e)return{color:this._value.color,alpha:this._value.alpha};var t=n.prototype.tokenize.call(this,e);return t.color=this._value.color,t.alpha=this._value.alpha,t},i.prototype.clone=function(e){return new i(this.name,this._value.color,this._value.alpha,this.category,this.options)},i.prototype.deTokenize=function(e){n.prototype.deTokenize.call(this,e),this._value=new t(e.color,e.alpha)},i}(e.Prop);e.PropColor=n}(Animate||(Animate={}));var Animate;!function(e){var t=function(){function e(e,t){void 0===e&&(e=1),void 0===t&&(t=1),this.widthPercent=e,this.heightPercent=t}return e.prototype.update=function(e){var t=e.element,n=t.parent();if(null!=n&&0!=n.length){var i=n.css("overflow");n.css("overflow","hidden");var o=n.width(),r=n.height();t.css({width:this.widthPercent*o+"px",height:this.heightPercent*r+"px"}),n.css("overflow",i)}},e}();e.Percentile=t}(Animate||(Animate={}));var Animate;!function(e){var t=function(){function e(e,t,n,i,o,r){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=0),void 0===o&&(o=!1),void 0===r&&(r=!1),this.offsetX=e,this.offsetY=t,this.offsetWidth=n,this.offsetHeight=i,this.resrtictHorizontal=o,this.resrtictVertical=r}return e.prototype.update=function(e){var t=e.element,n=t.parent();if(null!=n&&0!=n.length){var i=n.css("overflow");n.css("overflow","hidden");var o=n.width(),r=n.height();t.css({width:this.resrtictHorizontal===!1?(o+this.offsetWidth).toString():"",height:this.resrtictVertical===!1?(r+this.offsetHeight).toString():"",left:this.offsetX,top:this.offsetY}),n.css("overflow",i)}},e}();e.Fill=t}(Animate||(Animate={}));var Animate;!function(e){var t=function(){function t(){if(this.onMove=function(e){var t=jQuery(e.target).data("component");if(t){var n=this.label,i=t.tooltip,o=n.element;if(i&&""!=i){n.text=i;var r=n.element.height(),s=n.element.width();o.show();var a=e.clientY-r-20<0?0:e.clientY-r-20-20,l=e.clientX+s+20<jQuery("body").width()?e.clientX+20:jQuery("body").width()-s;o.css({left:l+"px",top:a+"px"})}else o.hide()}},null!=t._singleton)throw new Error("The TooltipManager class is a singleton. You need to call the TooltipManager.getSingleton() function.");t._singleton=this,this.label=new e.Label("tooltip",e.Application.getInstance(),"<div class='label tooltip shadow-small'></div>"),this.label.element.hide(),jQuery("body").on("mousemove",this.onMove.bind(this))}return t.create=function(){return void 0===t._singleton&&(t._singleton=new t),t._singleton},t}();e.TooltipManager=t}(Animate||(Animate={}));var Animate;!function(e){var t=function(e){function t(t){e.call(this,t)}return __extends(t,e),t.UPDATED=new t("component_updated"),t}(e.ENUM);e.ComponentEvents=t;var n=function(n){function i(e,t){void 0===t&&(t=null),n.call(this),this._tooltip=null,this._enabled=!0,e?"string"==typeof e?this._element=jQuery(e):this._element=e:this._element=jQuery("<div class='Component'><div>"),i.idCounter++,this._children=[],this._layouts=[],this.savedID=null,this._tooltip=null,this._enabled=!0,this.tag=null,this._parent=t,this._element.attr("id")||(this._id="i"+i.idCounter,this._element.attr("id",this._id)),this._element.data("component",this),t&&t.addChild(this)}return __extends(i,n),i.prototype.dispose=function(){if(!this.disposed){this._tooltip=null;for(var t=this._children;0!=t.length;)t[0].dispose();this._layouts=null,this.tag=null,this._children=null,this.savedID=null,null!=this._parent&&this._parent.removeChild(this),this.element.data("id",null),this.element.data("component",null),this.element.remove(),this.element=null,e.EventDispatcher.prototype.dispose.call(this)}},i.prototype.update=function(i){void 0===i&&(i=!0);for(var o=this._layouts,r=o.length;r--;)o[r].update(this);if(i){var s=this._children;for(r=s.length;r--;)s[r].update()}n.prototype.emit.call(this,new e.Event(t.UPDATED))},i.prototype.addLayout=function(e){return this._layouts.push(e),e},i.prototype.removeLayout=function(e){return-1==jQuery.inArray(e,this._layouts)?null:(this._layouts.splice(jQuery.inArray(e,this._layouts),1),e)},Object.defineProperty(i.prototype,"layouts",{get:function(){return this._layouts},enumerable:!0,configurable:!0}),i.prototype.addChild=function(e){var t,n=null;if(e instanceof i)n=e,t=e.parent;else if("string"==typeof e)n=new i(e);else{if(0==e.length)throw new Error("You can only add HTML strings or Component classes");var o=e;o.parent()&&o.parent().data("component")&&(t=o.parent().data("component")),n=new i(e)}return-1!=jQuery.inArray(e,this._children)?e:(t&&t.removeChild(n),n._parent=this,this._children.push(n),this._element.append(n._element),n)},i.prototype.contains=function(e){return-1==this._children.indexOf(e)?!1:!0},i.prototype.removeChild=function(e){return-1==jQuery.inArray(e,this._children)?e:(e._parent=null,e.element.detach(),this._children.splice(jQuery.inArray(e,this._children),1),e)},i.prototype.clear=function(){for(var e=this._children,t=e.length;t--;)e[t].dispose()},i.prototype.onDelete=function(){},Object.defineProperty(i.prototype,"children",{get:function(){return this._children},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"element",{get:function(){return this._element},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"tooltip",{get:function(){return this._tooltip},set:function(e){this._tooltip=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"enabled",{get:function(){return this._enabled},set:function(e){this._enabled!=e&&(e?this.element.removeClass("disabled"):this.element.addClass("disabled"),this._enabled=e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"selected",{get:function(){return this._element.hasClass("selected")?!0:!1},set:function(e){e?this._element.addClass("selected"):this._element.removeClass("selected")},enumerable:!0,configurable:!0}),i.idCounter=0,i}(e.EventDispatcher);e.Component=n}(Animate||(Animate={}));var Animate;!function(e){var t=function(e){function t(t){e.call(this,t)}return __extends(t,e),t.ITEM_CLICKED=new t("menu_list_item_clicked"),t}(e.ENUM);e.MenuListEvents=t;var n=function(e){function n(t){e.call(this,"<div class='menu-list'></div>",t),this._items=[],this.element.on("click",jQuery.proxy(this.onClick,this)),this.selectedItem=null}return __extends(n,e),n.prototype.addItem=function(e,t,n){var i=jQuery("<div class='menu-list-item light-hover'>"+(e?"<img src='"+e+"' />":"")+"<span class='menu-list-text'>"+t+"</span></div>");return this._items.push(i),n?this.element.prepend(i):this.element.append(i),i},n.prototype.removeItem=function(e){e==this.selectedItem&&this.emit(t.ITEM_CLICKED,""),this._items.splice(jQuery.inArray(e,this.items),1),e.remove()},n.prototype.clearItems=function(){for(var e=this.items.length,t=0;e>t;t++)this._items[t].off(),this._items[t].detach();this._items.splice(0,e)},n.prototype.onClick=function(e){this.selectedItem&&this.selectedItem.removeClass("selected"),this.selectedItem=null;var n=jQuery(e.target);return n.is(jQuery(".menu-list-item"))?(this.selectedItem=n,this.selectedItem.addClass("selected"),this.emit(t.ITEM_CLICKED,n.text()),void e.preventDefault()):void this.emit(t.ITEM_CLICKED,"")},Object.defineProperty(n.prototype,"items",{get:function(){return this._items},enumerable:!0,configurable:!0}),n}(e.Component);e.MenuList=n}(Animate||(Animate={}));var Animate;!function(e){var t=function(e){function t(t){e.call(this,t)}return __extends(t,e),t.MESSAGE=new t("message"),t.WARNING=new t("warning"),t.ERROR=new t("error"),t}(e.ENUM);e.LogType=t;var n=function(n){function i(t){if(null!=i._singleton)throw new Error("The Logger class is a singleton. You need to call the Logger.getSingleton() function.");i._singleton=this,n.call(this,t),this.element.addClass("logger"),this.context=new e.ContextMenu,this.context.addItem(new e.ContextMenuItem("Clear","media/cross.png")),this.mDocker=null,this.warningFlagger=jQuery("<img class='logger-warning fade-animation' src='media/warning-button.png' />"),this.mContextProxy=this.onContext.bind(this),jQuery(document).on("contextmenu",this.mContextProxy),this.context.on(e.ContextMenuEvents.ITEM_CLICKED,this.onContextSelect,this),this.warningFlagger.on("click",jQuery.proxy(this.onIconClick,this))}return __extends(i,n),i.prototype.onIconClick=function(){this.mDocker.setActiveComponent(this,!0),this.warningFlagger.detach()},i.prototype.getPreviewImage=function(){return"media/logger.png"},i.prototype.onShow=function(){this.warningFlagger.detach(),this.element.data("preview").removeClass("fade-animation")},i.prototype.onHide=function(){},i.prototype.getDocker=function(){return this.mDocker},i.prototype.setDocker=function(e){this.mDocker=e},i.prototype.onContextSelect=function(e,t,n){"Clear"==t.item.text&&this.clearItems()},i.prototype.onContext=function(t){var n=jQuery(t.target);if(n.is(jQuery(".menu-list-item"))||n.is(jQuery(".menu-list"))){if(n.is(jQuery(".menu-list-item"))&&n.parent().data("component")!=this)return;if(n.is(jQuery(".menu-list"))&&n.data("component")!=this)return;t.preventDefault(),this.context.show(e.Application.getInstance(),t.pageX,t.pageY,!1,!0)}},i.logMessage=function(e,n,o){void 0===o&&(o=t.MESSAGE);var r=i.getSingleton(),s=null;if(s=o==t.MESSAGE?"media/tick.png":o==t.ERROR?"media/cross.png":"media/warning-20.png",o!=t.MESSAGE&&r.element.data("preview")!=r.mDocker.activePreview){var a=r.mDocker.element.offset();jQuery("body").append(r.warningFlagger),r.warningFlagger.css({left:a.left,top:a.top-r.warningFlagger.height()}),r.element.data("preview").addClass("fade-animation")}e="<span class='date'>"+new Date(Date.now()).toLocaleDateString()+" "+new Date(Date.now()).toLocaleTimeString()+"</span>"+e;var l=r.addItem(s,e,!0);return l.data("tag",n),l},i.prototype.clearItems=function(){this.warningFlagger.detach(),this.element.data("preview").removeClass("fade-animation");for(var e=this.items.length,t=0;e>t;t++)this.items[t].data("tag",null);n.prototype.clearItems.call(this)},i.getSingleton=function(e){return i._singleton||new i(e),i._singleton},i}(e.MenuList);e.Logger=n}(Animate||(Animate={}));var Animate;!function(e){var t=function(t){function n(e){t.call(this,"<div class='screen-manager light-gradient shadow-small curve-small'></div>",e),this.activeComponent=null,this._activePreview=null,this.rollout=jQuery("<div class='roll-out animate-all light-gradient shadow-small curve-small'></div>"),this.mComponents=[],this.mPreviews=[],this.element.on("mouseenter",jQuery.proxy(this.onEnter,this)),this.element.on("mouseleave",jQuery.proxy(this.onOut,this)),this.startProxy=this.onStart.bind(this),this.stopProxy=this.onStop.bind(this),this.clickPreview=this.onClick.bind(this),this.dropProxy=this.onObjectDropped.bind(this),this.element.droppable({drop:this.dropProxy,hoverClass:"hover-over"})}return __extends(n,t),n.prototype.onClick=function(e){var t=jQuery(e.target).data("component");t&&(this.removeComponent(t),this.addComponent(t,!0))},n.prototype.onStart=function(e){var t=jQuery(".screen-manager");t.removeClass("light-gradient"),t.addClass("drag-targets"),t.css({opacity:1})},n.prototype.onStop=function(e){var t=jQuery(".screen-manager");t.addClass("light-gradient"),t.removeClass("drag-targets"),t.css({opacity:""})},n.prototype.onEnter=function(e){this.mComponents.length>1&&this.element.append(this.rollout),this.rollout.css({left:-(this.rollout.width()+5)+"px"}),this.rollout.stop(),this.rollout.show(),this.rollout.css("opacity",1)},n.prototype.onOut=function(e){this.rollout.stop(),this.rollout.fadeOut()},n.prototype.onObjectDropped=function(t,n){var i=jQuery(n.draggable).data("component"),o=jQuery(n.draggable).data("Docker");if(i&&o){this.parent;o.removeComponent(i),this.addComponent(i,!0),e.Application.getInstance().update()}},n.prototype.update=function(){e.Component.prototype.update.call(this,!1);var t=this.parent.element;if(0!=t.length){var n=t.width();t.height();this.element.css({left:n-this.element.width()-15+"px",top:"6px"})}},n.prototype.setActiveComponent=function(e,t){if(void 0===t&&(t=!1),this.activeComponent){var n=this.activeComponent.parent;n&&n.removeChild(this.activeComponent)}this._activePreview&&(this._activePreview.detach(),this.rollout.append(this._activePreview)),this.activeComponent=e,this._activePreview=e.element.data("preview"),t&&(this.parent.addChild(e),e.onShow()),this.element.append(this._activePreview)},n.prototype.removeComponent=function(e,t){void 0===t&&(t=!1),e.setDocker(null);var n=e.element.data("preview");this.mComponents.splice(jQuery.inArray(e,this.mComponents),1),this.mPreviews.splice(jQuery.inArray(n,this.mPreviews),1),t?n.remove():n.detach(),e.onHide(),this._activePreview==e.element.data("preview")&&(this._activePreview=null),e==this.activeComponent&&this.mComponents.length>0?this.setActiveComponent(this.mComponents[0]):e==this.activeComponent&&(this.activeComponent=null)},n.prototype.addComponent=function(e,t){if(-1==jQuery.inArray(e,this.mComponents)){this.mComponents.push(e),e.setDocker(this);var n=null;e.element.data("preview")?n=e.element.data("preview"):(n=jQuery("<div class='screen-manager-preview'><img src='"+e.getPreviewImage()+"'></div>"),n.draggable({start:this.startProxy,stop:this.stopProxy,opacity:.7,cursor:"move",helper:"clone",revert:"invalid",appendTo:"body",containment:"body",zIndex:9999})),e.element.data("preview",n),n.data("component",e),n.data("Docker",this),n.off("click"),n.on("click",this.clickPreview),this.mPreviews.push(n),this.setActiveComponent(e,t)}},Object.defineProperty(n.prototype,"activePreview",{get:function(){return this._activePreview},enumerable:!0,configurable:!0}),n}(e.Component);e.Docker=t}(Animate||(Animate={}));var Animate;!function(e){var t=function(e){function t(t){e.call(this,t)}return __extends(t,e),t.VERTICAL=new t("vertical"),t.HORIZONTAL=new t("horizontal"),t}(e.ENUM);e.SplitOrientation=t;var n=function(n){function i(i,o,r,s){void 0===o&&(o=t.VERTICAL),void 0===r&&(r=.5),void 0===s&&(s=6),n.call(this,"<div class='split-panel' style='width:100px; height:100px;'></div>",i),this.offsetLeft=0,this.offsetTop=0,this.mPercent=r,this.mDividerSize=s,this.mPanel1=this.addChild("<div class='panel1'></div>"),this.mDivider=this.addChild("<div class='split-panel-divider background-dark' style='width:"+this.mDividerSize+"px;'></div>"),this.mDividerDragging=new e.Component("<div class='split-panel-divider-dragging' style='width:"+this.mDividerSize+"px;'></div>"),this.mPanel2=this.addChild("<div class='panel2'></div>"),this.addChild("<div class='fix'></div>"),this.orientation=o,this.mPanelOverlay1=jQuery("<div class='panel-input'></div>"),this.mPanelOverlay2=jQuery("<div class='panel-input'></div>"),this.mMouseDownProxy=this.onDividerMouseDown.bind(this),this.mMouseUpProxy=this.onStageMouseUp.bind(this),this.mMouseMoveProxy=this.onStageMouseMove.bind(this),this.mDivider.element.on("mousedown",this.mMouseDownProxy)}return __extends(i,n),i.prototype.onDividerMouseDown=function(e){this.orientation=this.orientation,this.addChild(this.mDividerDragging),this.mDividerDragging.element.css({width:this.mDivider.element.css("width"),height:this.mDivider.element.css("height"),left:this.mDivider.element.css("left"),top:this.mDivider.element.css("top")}),this.mPanel1.element.prepend(this.mPanelOverlay1),this.mPanel2.element.prepend(this.mPanelOverlay2),jQuery("body").on("mouseup",this.mMouseUpProxy),jQuery("body").on("mousemove",this.mMouseMoveProxy),e.preventDefault()},i.prototype.onStageMouseUp=function(e){this.mPanelOverlay1.remove(),this.mPanelOverlay2.remove(),jQuery("body").off("mouseup",this.mMouseUpProxy),jQuery("body").off("mousemove",this.mMouseMoveProxy),this.removeChild(this.mDividerDragging);var n=parseFloat(this.mDividerDragging.element.css("left").split("px")[0]),i=parseFloat(this.mDividerDragging.element.css("top").split("px")[0]),o=this.element.width(),r=this.element.height(),s=0;s=this.mOrientation==t.VERTICAL?n/o:i/r,this.ratio=s;var a=this.mPanel1.element.css("overflow"),l=this.mPanel2.element.css("overflow");this.mPanel1.element.css("overflow","hidden"),this.mPanel2.element.css("overflow","hidden");for(var h=this.mPanel1.children,c=0;c<h.length;c++)h[c].update();for(var h=this.mPanel2.children,c=0;c<h.length;c++)h[c].update();this.mPanel1.element.css("overflow",a),this.mPanel2.element.css("overflow",l)},i.prototype.update=function(){n.prototype.update.call(this,!1);var e=this.mPanel1.element.css("overflow"),t=this.mPanel2.element.css("overflow");this.mPanel1.element.css("overflow","hidden"),this.mPanel2.element.css("overflow","hidden"),this.orientation=this.orientation;var i=this.mPanel1.children;if(i.length>0)for(var o=0;o<i.length;o++)i[o].update();if(i=this.mPanel2.children,i.length>0)for(var o=0;o<i.length;o++)i[o].update();this.mPanel1.element.css("overflow",e),this.mPanel2.element.css("overflow",t)},i.prototype.onStageMouseMove=function(e){var n=this.mDividerDragging.parent.element.offset();if(this.mOrientation==t.VERTICAL){var i=this.element.width(),o=e.clientX-n.left;o<this.mDividerSize&&(o=this.mDividerSize),o>i-this.mDividerSize&&(o=i-this.mDividerSize),this.mDividerDragging.element.css({left:o+"px"})}else{var r=this.element.height(),o=e.clientY-n.top;o<this.mDividerSize&&(o=this.mDividerSize),o>r-this.mDividerSize&&(o=r-this.mDividerSize),this.mDividerDragging.element.css({top:o+"px"})}return e.preventDefault(),!1},Object.defineProperty(i.prototype,"ratio",{get:function(){return this.mPercent},set:function(e){e>1?e=1:0>e&&(e=0),this.mPercent=e,this.orientation=this.orientation},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"orientation",{get:function(){return this.mOrientation},set:function(e){if(e==t.VERTICAL||e==t.HORIZONTAL){this.mOrientation=e;var n=this.element.width(),i=this.element.height();e==t.VERTICAL?(this.mPanel1.element.css({width:this.mPercent*n-.5*this.mDividerSize,top:"0px",left:"0px",height:i+"px"}),this.mDivider.element.css({width:this.mDividerSize+"px",left:this.mPanel1.element.width()+"px",top:"0px",height:i+"px"}),this.mPanel2.element.css({width:(1-this.mPercent)*n-.5*this.mDividerSize,left:this.mPercent*n+this.mDividerSize/2+"px",top:"0px",height:i+"px"})):(this.mPanel1.element.css({height:this.mPercent*i-.5*this.mDividerSize,left:"0px",top:"0px",width:n+"px"}),this.mDivider.element.css({height:this.mDividerSize+"px",top:this.mPanel1.element.height()+"px",left:"0px",width:n+"px"}),this.mPanel2.element.css({height:(1-this.mPercent)*i-.5*this.mDividerSize,top:this.mPercent*i+this.mDividerSize/2+"px",left:"px",width:n+"px"}))}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"top",{get:function(){return this.mPanel1},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"bottom",{get:function(){return this.mPanel2},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"left",{get:function(){return this.mPanel1},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"right",{get:function(){return this.mPanel2},enumerable:!0,configurable:!0}),i.prototype.dispose=function(){this.mOrientation=null,this.mDivider.element.off("mousedown",this.mMouseDownProxy),jQuery("body").off("mouseup",this.mMouseUpProxy),jQuery("body").off("mousemove",this.mMouseMoveProxy),this.mMouseDownProxy=null,n.prototype.dispose.call(this)},i}(e.Component);e.SplitPanel=n}(Animate||(Animate={}));var Animate;!function(e){var t=function(e){function t(t){e.call(this,t)}return __extends(t,e),t.HIDDEN=new t("window_hidden"),t.SHOWN=new t("window_shown"),t}(e.ENUM);e.WindowEvents=t;var n=function(n){function i(e,t,i,o,r){void 0===i&&(i=!0),void 0===o&&(o=!1),void 0===r&&(r=""),n.call(this,"<div class='window shadow-med background' style='width:"+e+"px; height:"+t+"px;'></div>",null),this._autoCenter=i,this._controlBox=o,this._controlBox?(this._header=this.addChild("<div class='window-control-box background-haze'></div>"),this._headerText=this._header.addChild("<div class='window-header'>"+r+"</div>"),this._headerCloseBut=this._header.addChild("<div class='close-but black-tint'>X</div>"),this.addChild("<div class='fix'></div>"),this._content=this.addChild("<div class='window-content'></div>")):this._content=this.addChild("<div class='window-content no-control'></div>"),this._modalBackdrop=jQuery("<div class='modal-backdrop dark-modal'></div>"),this._externalClickProxy=this.onStageClick.bind(this),this._isVisible=!1,this._autoCenter&&(this._resizeProxy=this.onWindowResized.bind(this),jQuery(window).on("resize",this._resizeProxy)),this._controlBox&&(this._closeProxy=this.onCloseClicked.bind(this),this._headerCloseBut.element.on("click",this._closeProxy)),this._modalBackdrop.on("click",this.onModalClicked.bind(this))}return __extends(i,n),i.prototype.onCloseClicked=function(e){this.hide()},i.prototype.onStageMove=function(e){this.element.css({left:e.pageX-e.offsetX+"px",top:e.pageY-e.offsetY+"px"})},i.prototype.hide=function(){0!=this._isVisible&&(this._isVisible=!1,jQuery("body").off("click",this._externalClickProxy),this._modalBackdrop.detach(),0!=this.element.parent().length&&this.element.parent().data("component").removeChild(this),
this._controlBox&&this.element.draggable("destroy"),this.emit(new e.WindowEvent(t.HIDDEN,this)))},i.prototype.center=function(){this.element.css({left:jQuery("body").width()/2-this.element.width()/2,top:jQuery("body").height()/2-this.element.height()/2})},i.prototype.show=function(n,i,o,r,s){if(void 0===n&&(n=null),void 0===i&&(i=NaN),void 0===o&&(o=NaN),void 0===r&&(r=!1),void 0===s&&(s=!1),this._isVisible=!0,n=void 0===n||null==n?e.Application.getInstance():n,r){n.element.append(this._modalBackdrop);var a=jQuery("body");this._modalBackdrop.css({width:a.width()+"px",height:a.height()+"px"})}n.addChild(this),isNaN(i)||void 0===i?this.element.css({left:jQuery("body").width()/2-this.element.width()/2,top:jQuery("body").height()/2-this.element.height()/2}):this.element.css({left:i+"px",top:o+"px"}),s&&(jQuery("body").off("click",this._externalClickProxy),jQuery("body").on("click",this._externalClickProxy)),this.emit(new e.WindowEvent(t.SHOWN,this)),this._controlBox&&this.element.draggable({handle:".window-control-box",containment:"parent"})},i.prototype.onModalClicked=function(e){var t=this.element.parent();this.element.detach(),this.element.addClass("anim-shadow-focus"),t.append(this.element)},i.prototype.onWindowResized=function(e){if(!e||!$(e.target).hasClass("ui-resizable")){var t=jQuery("body");this._isVisible&&(this._modalBackdrop.css({width:t.width()+"px",height:t.height()+"px"}),this.element.css({left:jQuery("body").width()/2-this.element.width()/2,top:jQuery("body").height()/2-this.element.height()/2}))}},i.prototype.onStageClick=function(e){for(var t=jQuery(e.target).parent();"undefined"!=typeof t&&0!=t.length;){var n=t.data("component");if(n==this||jQuery(e.target).is(this._modalBackdrop))return;t=t.parent()}this.hide()},Object.defineProperty(i.prototype,"content",{get:function(){return this._content},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"visible",{get:function(){return this._isVisible},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"headerText",{get:function(){return this._headerText.element.text()},set:function(e){this._headerText.element.text(e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"modalBackdrop",{get:function(){return this._modalBackdrop},enumerable:!0,configurable:!0}),i.prototype.dispose=function(){this._closeProxy&&(this._headerCloseBut.element.off("click",this._closeProxy),this._closeProxy=null),this._externalClickProxy=null,jQuery(window).off("resize",this._resizeProxy),this._modalBackdrop.off(),this._modalBackdrop.detach(),this._resizeProxy=null,this._modalBackdrop=null,this._headerText=null,this._headerCloseBut=null,this._header=null,n.prototype.dispose.call(this)},i}(e.Component);e.Window=n}(Animate||(Animate={}));var Animate;!function(e){var t=function(e){function t(t,n,i){e.call(this,"<div class='context-item reg-gradient'>"+(n&&""!=n?"<img src='"+n+"'/>":"")+"<div class='text'></div></div>",i),this.text=t,this.imageURL=n}return __extends(t,e),Object.defineProperty(t.prototype,"text",{get:function(){return this._text},set:function(e){this._text=e,jQuery(".text",this.element).text(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageURL",{get:function(){return this._imgURL},set:function(e){this._imgURL=e,jQuery("img",this.element).attr("src",e)},enumerable:!0,configurable:!0}),t}(e.Component);e.ContextMenuItem=t;var n=function(e){function t(t){e.call(this,t)}return __extends(t,e),t.ITEM_CLICKED=new t("context_munu_item_clicked"),t}(e.ENUM);e.ContextMenuEvents=n;var i=function(t){function i(){t.call(this,100,100),this.element.addClass("context-menu"),this.element.css("height",""),this.items=[],this.selectedItem=null,this.content.element.css({width:"",height:""}),this.element.css({width:"initial",height:"initial"})}return __extends(i,t),i.prototype.dispose=function(){this.items=null,this.selectedItem=null,e.Window.prototype.dispose.call(this)},i.prototype.show=function(t,n,o,r,s){void 0===t&&(t=null),void 0===n&&(n=NaN),void 0===o&&(o=NaN),void 0===r&&(r=!1),void 0===s&&(s=!1);var a=jQuery(window).height(),l=jQuery(window).width();i.currentContext&&i.currentContext.hide(),i.currentContext=this,e.Window.prototype.show.call(this,t,n,o,r,s),n+this.element.width()>l&&this.element.css("left",l-this.element.width()),o+this.element.height()>l&&this.element.css("top",a-this.element.height());for(var h=!1,c=this.items.length;c--;)if(this.items[c].element.is(":visible")){h=!0;break}h||this.hide()},i.prototype.addItem=function(e){return this.items.push(e),this.content.addChild(e),e},i.prototype.removeItem=function(e){for(var t=this.items.length,n=0;t>n;n++){var i=this.items[n];if(i==e)return i=this.items[n],this.items.splice(n,1),this.content.removeChild(e),i}return null},i.prototype.onStageClick=function(i){var o=jQuery(i.target);if(o.is(jQuery(".context-item"))){var r=o.data("component");return this.onItemClicked(r,o),this.emit(new e.ContextMenuEvent(r,n.ITEM_CLICKED)),this.hide(),void i.preventDefault()}t.prototype.onStageClick.call(this,i)},i.prototype.onItemClicked=function(e,t){},Object.defineProperty(i.prototype,"numItems",{get:function(){return this.items.length},enumerable:!0,configurable:!0}),i.prototype.getItem=function(e){for(var t=this.items.length,n=0;t>n;n++){var i=this.items[n].text;if(i==e)return this.items[n]}return null},i.prototype.clear=function(){for(;this.content.children.length>0;)this.content.children[0].dispose();this.items.splice(0,this.items.length)},i}(e.Window);e.ContextMenu=i}(Animate||(Animate={}));var Animate;!function(e){var t=function(t){function n(e){t.call(this,"<div class='tree'></div>",e),this._selectedNode=null,this._selectedNodes=[],this.element.on("click",jQuery.proxy(this.onClick,this)),this.element.disableSelection(!0),this.fixDiv=jQuery("<div class='fix'></div>"),this.element.append(this.fixDiv)}return __extends(n,t),n.prototype.onClick=function(t){if(jQuery(t.target).hasClass("first-selectable"))return void jQuery(".tree-node-button",t.target).trigger("click");if(jQuery(t.target).hasClass("tree-node-button")){var n=jQuery(t.target).parent().parent().data("component");return void(n.expanded?n.collapse():n.expand())}var i=jQuery(t.target).parent().data("component");if(null!=i&&i instanceof e.TreeNode)if(t.ctrlKey)this.selectNode(i,!1,t.ctrlKey);else if(t.shiftKey)if(1==this._selectedNodes.length){if(i.element.parent().data("component")==this._selectedNodes[0].element.parent().data("component")){for(var o=i.element.parent(),r=!1,s=o.data("component"),a=0;s.children.length;a++){if(!r&&s.children[a]==i)return void this.selectNode(null);if((r||s.children[a]==this._selectedNodes[0])&&(r=!0,this.selectNode(s.children[a],!1,!0),s.children[a]==i))return}r||this.selectNode(null)}}else this.selectNode(null);else this.selectNode(i,!1);else this.selectNode(null)},n.prototype.selectNode=function(t,n,i){if(void 0===n&&(n=!1),void 0===i&&(i=!1),this.enabled){if(this._selectedNode&&0==i){for(var o=this._selectedNodes.length;o--;)this._selectedNodes[o].selected=!1;this._selectedNodes.splice(0,this._selectedNodes.length)}if(this._selectedNode=t,t&&-1==this._selectedNodes.indexOf(t)){if(n)for(var r=t.parent;r&&r instanceof e.TreeNode;)r.expanded||r.expand(),r=r.parent;this._selectedNodes.push(t),t.selected=!0,t.onSelect(),n&&this.parent.element.scrollTo("#"+t.id,500)}}},n.prototype.addNode=function(t){t.treeview=this,t.element.addClass("tree-node-top"),jQuery(".selectable",t.element).addClass("first-selectable"),jQuery(".selectable",t.element).addClass("background-view-light");var n=e.Component.prototype.addChild.call(this,t);return this.fixDiv.remove(),this.element.append(this.fixDiv),n},n.prototype.nodes=function(){return this.children},n.prototype.clear=function(){for(var e=this.children;e.length>0;)-1!=this._selectedNodes.indexOf(e[0])&&this._selectedNodes.splice(this._selectedNodes.indexOf(e[0]),1),e[0].dispose()},n.prototype.removeNode=function(t){t.treeview=null;var n=e.Component.prototype.removeChild.call(this,t);return this.fixDiv.remove(),this.element.append(this.fixDiv),-1!=this._selectedNodes.indexOf(t)&&this._selectedNodes.splice(this._selectedNodes.indexOf(t),1),n},n.prototype.findNode=function(t,n){for(var i=this.children,o=i.length,r=0;o>r;r++)if(i[r]instanceof e.TreeNode!=0){var s=i[r].findNode(t,n);if(null!=s)return s}},Object.defineProperty(n.prototype,"selectedNode",{get:function(){return this._selectedNode},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"selectedNodes",{get:function(){return this._selectedNodes},enumerable:!0,configurable:!0}),n}(e.Component);e.TreeView=t}(Animate||(Animate={}));var Animate;!function(e){var t=function(e){function t(t){e.call(this,t)}return __extends(t,e),t.SELECTED=new t("tab_selected"),t.REMOVED=new t("tab_removed"),t}(e.ENUM);e.TabEvents=t;var n=function(n){function i(t){n.call(this,"<div class='tab background-view'></div>",t),this._tabSelectorsDiv=new e.Component("<div class='tabs-div'></div>",this),this._pagesDiv=new e.Component("<div class='pages-div'></div>",this),this._dropButton=new e.Component("<div class='tabs-drop-button black-tint'>&#x21E3;</div>",null),this._pagesDiv.addLayout(new e.Fill(0,0,0,-25)),this._tabPairs=[],this._selectedPair=null,i.contextMenu||(i.contextMenu=new e.ContextMenu),this.addLayout(new e.Fill),i.contextMenu.on(e.ContextMenuEvents.ITEM_CLICKED,this.onContext.bind(this)),this.element.on("click",jQuery.proxy(this.onClick,this))}return __extends(i,n),i.prototype.onTabSelected=function(n){var i=new e.TabEvent(t.SELECTED,n);this.emit(i),i.cancel===!1&&n.onSelected()},i.prototype.onContext=function(e,t){for(var n=this._tabPairs.length,i=0;n>i;i++)if(this._tabPairs[i].name==t.item.text){var o=this._tabPairs[i].tabSelector.element.parent();return this._tabPairs[i].tabSelector.element.detach(),o.prepend(this._tabPairs[i].tabSelector.element),void this.selectTab(this._tabPairs[i])}},i.prototype.selectTab=function(e){for(var t=this._tabPairs.length,n=0;t>n;n++)if(e==this._tabPairs[n]||this._tabPairs[n].name==e.name)return null!=this._selectedPair&&(this._selectedPair.tabSelector.element.removeClass("tab-selected"),this._selectedPair.page.element.detach()),this._selectedPair=this._tabPairs[n],this._selectedPair.tabSelector.element.addClass("tab-selected"),this._pagesDiv.element.append(this._selectedPair.page.element),this.onTabSelected(this._selectedPair),this._selectedPair;return null},i.prototype.onTabPairClosing=function(e){return!0},i.prototype.onClick=function(t){var n=jQuery(t.target);if(n.is(jQuery(".tab-close"))){var o=jQuery(".content",n.parent()).text(),r=this.getTab(o);return void(this.onTabPairClosing(r)&&this.removeTab(r,!0))}if(n.is(jQuery(".tabs-drop-button"))){i.contextMenu.clear();for(var s=this._tabPairs.length,a=0;s>a;a++)i.contextMenu.addItem(new e.ContextMenuItem(this._tabPairs[a].name,null));return t.preventDefault(),i.contextMenu.show(e.Application.getInstance(),t.pageX,t.pageY,!1,!0),!1}if(n.is(jQuery(".tab-selector")))for(var s=this._tabPairs.length,a=0;s>a;a++){var o="";if(n.data("canClose")?(o=n.text(),o=o.substring(0,o.length-1)):o=n.text(),this._tabPairs[a].name==o)return null!=this._selectedPair&&(this._selectedPair.tabSelector.element.removeClass("tab-selected"),this._selectedPair.page.element.detach()),this._selectedPair=this._tabPairs[a],this._selectedPair.tabSelector.element.addClass("tab-selected"),this._pagesDiv.element.append(this._selectedPair.page.element),void this.onTabSelected(this._selectedPair)}},i.prototype.update=function(){this.element.css("overflow","hidden"),e.Component.prototype.update.call(this);for(var t=this._tabPairs,n=t.length,i=0;n>i;i++)t[i].onResize()},i.prototype.addTab=function(t,n){n=void 0===n?!0:n,null!=this._selectedPair&&(this._selectedPair.tabSelector.element.removeClass("tab-selected"),this._selectedPair.page.element.detach());var i=new e.Component("<div class='tab-page background'></div>",this._pagesDiv),o=new e.Component("<div class='tab-selector animate-fast background-dark tab-selected'><div class='text'><span class='content'>"+(t instanceof e.TabPair?t.name:t)+"</span></div></div>",this._tabSelectorsDiv);n&&(new e.Component("<div class='tab-close black-tint'>X</div>",o),o.element.data("canClose",!0));var r=null;return t instanceof e.TabPair?(r=t,r.tabSelector=o,r.page=i):r=new e.TabPair(o,i,t),r.tab=this,this._selectedPair=r,this._tabPairs.push(r),this.onTabSelected(this._selectedPair),this._tabPairs.length>1&&!this.contains(this._dropButton)&&this._tabSelectorsDiv.addChild(this._dropButton),o.element.trigger("click"),r.onAdded(),r},i.prototype.getTab=function(e){for(var t=this._tabPairs.length;t--;)if(this._tabPairs[t].name==e)return this._tabPairs[t];return null},i.prototype.dispose=function(){this._tabSelectorsDiv=null,this._pagesDiv=null;for(var e=this._tabPairs.length,t=0;e>t;t++)this._tabPairs[t].dispose();this._pagesDiv=null,this._tabPairs=null,this._selectedPair=null,n.prototype.dispose.call(this)},i.prototype.clear=function(){for(;this._tabPairs.length>0;)this.removeTab(this._tabPairs[0],!0)},i.prototype.removeTab=function(n,i){i=void 0===i?!0:i;for(var o=this._tabPairs.length,r=0;o>r;r++)if(this._tabPairs[r]==n||this._tabPairs[r].name==n){var s=new e.TabEvent(t.REMOVED,this._tabPairs[r]);if(this._tabPairs[r].onRemove(s),s.cancel)return;var a=this._tabPairs[r];return this._tabPairs.splice(r,1),a.tab=this,this._tabPairs.length<=1&&this.contains(this._dropButton)&&this._tabSelectorsDiv.removeChild(this._dropButton),this.onTabPairClosing(a),this._tabSelectorsDiv.removeChild(a.tabSelector),this._pagesDiv.removeChild(a.page),i&&a.dispose(),this._selectedPair==a&&(this._selectedPair=null,o>1&&this._tabPairs[0].tabSelector.element.trigger("click")),a}return null},Object.defineProperty(i.prototype,"tabs",{get:function(){return this._tabPairs},enumerable:!0,configurable:!0}),i}(e.Component);e.Tab=n}(Animate||(Animate={}));var Animate;!function(e){var t=function(){function e(e,t,n){this.tab=null,this.tabSelector=e,this._modified=!1,this.page=t,this.name=n,this._savedSpan=jQuery("<span class='modified'>*</span>")}return Object.defineProperty(e.prototype,"modified",{get:function(){return this._modified},set:function(e){this._modified=e,e?jQuery(".text",this.tabSelector.element).prepend(this._savedSpan):this._savedSpan.detach()},enumerable:!0,configurable:!0}),e.prototype.onResize=function(){},e.prototype.onRemove=function(e){},e.prototype.onSaveAll=function(){},e.prototype.onAdded=function(){},e.prototype.onSelected=function(){},Object.defineProperty(e.prototype,"text",{get:function(){return jQuery(".text",this.tabSelector.element).text()},set:function(e){jQuery(".text",this.tabSelector.element).text(e),this._modified&&jQuery(".text",this.tabSelector.element).prepend(this._savedSpan)},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){this.tabSelector.dispose(),this.page.dispose(),this._savedSpan.remove(),this.tabSelector=null,this.page=null,this.name=null,this._savedSpan=null},e}();e.TabPair=t}(Animate||(Animate={}));var Animate;!function(e){var t=function(e){function t(t,n,i){void 0===i&&(i="<div class='label'></div>"),e.call(this,i,n),this._text=t,this.textfield=this.addChild("<div class='textfield'>"+t+"</div>")}return __extends(t,e),Object.defineProperty(t.prototype,"text",{get:function(){return this._text},set:function(e){this._text=e,this.textfield.element.html(e)},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){this.textfield=null,e.prototype.dispose.call(this)},Object.defineProperty(t.prototype,"textHeight",{get:function(){var e=this.textfield.element.clone();e.css({width:this.element.width()}),jQuery("body").append(e);var t=e.height();return e.remove(),t},enumerable:!0,configurable:!0}),t}(e.Component);e.Label=t}(Animate||(Animate={}));var Animate;!function(e){var t=function(t){function n(e,n,i,o,r){void 0===i&&(i="<div class='button reg-gradient curve-small'></div>"),void 0===o&&(o=70),void 0===r&&(r=30),t.call(this,e,n,i);var s=this.element.height(),a=this.textfield.element.height();this.textfield.element.css("top",s/2-a/2),this.element.css({width:o+"px",height:r+"px",margin:"3px"})}return __extends(n,t),n.prototype.css=function(e,t){var n=this.element.css(e,t),i=this.element.height(),o=this.textHeight;return this.textfield.element.css("top",i/2-o/2),n},n.prototype.dispose=function(){e.Label.prototype.dispose.call(this),this.textfield=null},Object.defineProperty(n.prototype,"selected",{get:function(){return this.element.hasClass("button-selected")?!0:!1},set:function(e){e?this.element.addClass("button-selected"):this.element.removeClass("button-selected")},enumerable:!0,configurable:!0}),n}(e.Label);e.Button=t}(Animate||(Animate={}));var Animate;!function(e){var t=function(t){function n(e,n,i,o,r){return void 0===i&&(i=!1),void 0===o&&(o=!1),void 0===r&&(r="<div class='input-box'></div>"),t.call(this,r,e),i?this._textfield=this.addChild("<textarea></textarea>"):o?this._textfield=this.addChild("<input type='password' />"):this._textfield=this.addChild("<input type='text' />"),this.text=n,this._limit=null}return __extends(n,t),n.prototype.onTextChange=function(e){var t=this._textfield.element.val();t.length>this._limit&&this._textfield.element.val(t.substring(0,this._limit))},Object.defineProperty(n.prototype,"limitCharacters",{get:function(){return this._limit},set:function(e){this._limit=e,isNaN(this._limit)||0==this._limit||null==this._limit?this._textfield.element.off():this._textfield.element.on("input",jQuery.proxy(this.onTextChange,this))},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"text",{get:function(){return this._textfield.element.val()},set:function(e){this._textfield.element.val(e)},enumerable:!0,configurable:!0}),n.prototype.focus=function(t){void 0===t&&(t=!1),t&&this._textfield.element.focus(),this._textfield.element.select(),e.Application.getInstance().focusObj=this},n.prototype.dispose=function(){this._textfield=null,t.prototype.dispose.call(this)},Object.defineProperty(n.prototype,"textfield",{get:function(){return this._textfield},enumerable:!0,configurable:!0}),n}(e.Component);e.InputBox=t}(Animate||(Animate={}));var Animate;!function(e){var t=function(t){function n(n,i){t.call(this,"<div class='group'><div class='group-header background'></div><div class='group-content'></div></div>",i),this.heading=new e.Label(n,this),this.heading.element.addClass("group-header"),this.heading.element.addClass("background"),this.content=this.addChild("<div class='group-content'></div>")}return __extends(n,t),n.prototype.text=function(e){return this.heading.element.text(e)},n.prototype.dispose=function(){this.heading=null,this.content=null,t.prototype.dispose.call(this)},n}(e.Component);e.Group=t}(Animate||(Animate={}));var Animate;!function(e){var t=function(e){function t(t,n,i,o){void 0===o&&(o="<div class='checkbox'></div>"),e.call(this,o,t),this.checkbox=this.addChild("<input type='checkbox'></input>"),this.textfield=this.addChild("<div class='text'>"+n+"</div>"),i&&this.checkbox.element.prop("checked",i)}return __extends(t,e),Object.defineProperty(t.prototype,"checked",{get:function(){return this.checkbox.element.prop("checked")},set:function(e){this.checkbox.element.prop("checked",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"text",{get:function(){return this.textfield.element.val()},set:function(e){this.textfield.element.val(e)},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){this.textfield=null,this.checkbox=null,e.prototype.dispose.call(this)},t}(e.Component);e.Checkbox=t}(Animate||(Animate={}));var Animate;!function(e){var t=function(t){function n(n,i,o,r){void 0===r&&(r=null),t.call(this,"<div class='label-val'></div>",n),this.label=new e.Label(i,this),this._val=o,this.element.append(this._val.element),this.element.append("<div class='fix'></div>"),r&&this._val.element.css(r)}return __extends(n,t),n.prototype.dispose=function(){this.label.dispose(),this.val.dispose(),this.label=null,this._val=null,t.prototype.dispose.call(this)},Object.defineProperty(n.prototype,"val",{get:function(){return this._val},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"text",{get:function(){return this.label.text},enumerable:!0,configurable:!0}),n}(e.Component);e.LabelVal=t}(Animate||(Animate={}));var Animate;!function(e){var t=function(){function t(e,t,n){void 0===t&&(t=""),void 0===n&&(n=""),this._fields=e,this._smallImg=t,this._largeIMG=n,this._rowNum=0,this.tag=null,this._components=[]}return t.prototype.clearComponents=function(){for(var e=this._components.length;e--;)this._components[e].dispose();this._components=[]},t.prototype.dispose=function(){for(var e=this._components.length;e--;)this._components[e].dispose();this._fields=null,this._smallImg=null,this._largeIMG=null,this._rowNum=null,this._components=null,this.tag=null},t.prototype.preview=function(t,n){var i=new e.Component("<div class='list-view-preview' style='width:"+n+"px; height:"+(n+30)+"px;'><div class='image' style='width:"+n+"px; height:"+n+"px;'><img src='"+this.largeIMG+"' /></div><div class='info'>"+t+"</div></div>",null);return this.components.push(i),i.element.data("item",this),i},t.prototype.field=function(t){var n=new e.Component("<div class='list-view-field unselectable'>"+t+"</div>",null);return this.components.push(n),n.element.data("item",this),n},Object.defineProperty(t.prototype,"components",{get:function(){return this._components},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fields",{get:function(){return this._fields},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"smallImg",{get:function(){return this._smallImg},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"largeIMG",{get:function(){return this._largeIMG},enumerable:!0,configurable:!0}),t}();e.ListViewItem=t}(Animate||(Animate={}));var Animate;!function(e){var t=function(e){function t(t,n){e.call(this,"<div class='list-view-header light-gradient'><span class='inner'>"+(n&&""!=n?"<img src='"+n+"'/>":"")+t+"</span><div class='dragger light-gradient'></div></div>",null),this.text=t}return __extends(t,e),t}(e.Component);e.ListViewHeader=t}(Animate||(Animate={}));var Animate;!function(e){var t=function(e){function t(t){e.call(this,t)}return __extends(t,e),t.ITEM_CLICKED=new t("list_view_item_clicked"),t.ITEM_DOUBLE_CLICKED=new t("list_view_item_double_clicked"),t}(e.ENUM);e.ListViewEvents=t;var n=function(){function e(e,t){void 0===t&&(t=""),this.text=e,this.image=t}return e}();e.ColumnItem=n;var i=function(){function e(e){this.value=e}return e.prototype.toString=function(){return this.value},e.DETAILS=new e("details"),e.IMAGES=new e("images"),e}();e.ListViewType=i;var o=function(o){function r(e){o.call(this,"<div class='list-view'></div>",e),this._mode=i.DETAILS,this._selectedItem=null,this._lists=[],this._items=[],this._columns=[],this._sortableColumn=0,this._multiSelect=!1,this._fix=this.addChild("<div class='fix'></div>"),this._divider=this.addChild("<div class='divider'></div>"),this._divider.element.detach(),this._selectedColumn=null,this._imgSize=100,this._dClickProxy=this.onDoubleClick.bind(this),this._clickProxy=this.onClick.bind(this),this._downProxy=this.onDown.bind(this),this._upProxy=this.onUp.bind(this),this._moveProxy=this.onMove.bind(this),this.element.on("dblclick",this._dClickProxy),this.element.on("click",this._clickProxy),this.element.on("mousedown",this._downProxy)}return __extends(r,o),Object.defineProperty(r.prototype,"displayMode",{get:function(){return this._mode},set:function(e){if(void 0!==e){for(var t=0;t<this._items.length;t++){for(var n=0;n<this._items[t].components.length;n++)this._items[t].components[n].dispose();this._items[t].components.splice(0,this._items[t].components.length)}this._mode=e,this.updateItems()}},enumerable:!0,configurable:!0}),r.prototype.onDown=function(e){var t=jQuery(e.target);return t.hasClass("dragger")&&(this._selectedColumn=t.parent().parent(),this._selectedColumn.length>0)?(e.preventDefault(),this.element.append(this._divider.element),jQuery(document).on("mousemove",this._moveProxy),jQuery(document).on("mouseup",this._upProxy),this._divider.element.css({left:t.position().left+t.width()/2+"px"}),!1):void 0},r.prototype.onMove=function(e){var t=this.element.offset(),n=5,i=this.element.width(),o=e.clientX-t.left;n>o&&(o=0),o>i-n&&(o=i-n),this._divider.element.css({left:o+"px"})},r.prototype.onUp=function(e){var t=this._selectedColumn.offset(),n=e.clientX-t.left;this._selectedColumn.css({width:n+"px"});for(var i=0,o=this._lists.length;o--;)i+=this._lists[o].element.outerWidth();this.element.css({"min-width":i+"px"}),this._divider.element.detach(),jQuery(document).off("mousemove",this._moveProxy),jQuery(document).off("mouseup",this._upProxy)},r.prototype.onDoubleClick=function(n){var i=jQuery(n.target).data("item");if(i){for(var o=i.components.length;o--;){var r=i.components[o];r.element.removeClass("selected")}for(o=i.components.length;o--;){var r=i.components[o];r.element.addClass("selected")}this.emit(new e.ListViewEvent(t.ITEM_DOUBLE_CLICKED,i))}return n.preventDefault(),!1},r.prototype.onClick=function(n){var i=jQuery(n.target).data("component");if(i instanceof e.ListViewHeader){for(var o=this._lists.length;o--;)if(this._lists[o].children[0]==i)return this._sortableColumn=o,void this.updateItems()}else{var r=jQuery(n.target).data("item");if(r){if(!n.ctrlKey&&jQuery(n.target).hasClass("selected")){for(o=r.components.length;o--;){var i=r.components[o];i.element.removeClass("selected")}return void this.emit(new e.ListViewEvent(t.ITEM_CLICKED,null))}if(0==this._multiSelect||!n.ctrlKey){var s=jQuery(".selected",this.element);s.each(function(){jQuery(this).removeClass("selected")})}if(jQuery(n.target).hasClass("selected"))for(o=r.components.length;o--;){var i=r.components[o];i.element.removeClass("selected"),this.emit(new e.ListViewEvent(t.ITEM_CLICKED,null))}else{for(o=r.components.length;o--;){var i=r.components[o];i.element.addClass("selected")}this.emit(new e.ListViewEvent(t.ITEM_CLICKED,r))}}}},r.prototype.getSelectedItems=function(){var e=[],t=jQuery(".selected",this.element);return t.each(function(){var t=jQuery(this).data("item");-1==e.indexOf(t)&&e.push(t)}),e},r.prototype.setSelectedItems=function(e){if(null==e){var t=jQuery(".selected",this.element);t.each(function(){jQuery(this).removeClass("selected")})}},r.prototype.dispose=function(){this._selectedColumn=null;for(var e=this._lists.length;e--;)this._lists[e].dispose();for(e=this._items.length;e--;)this._items[e].dispose();this.element.off("dblclick",this._dClickProxy),this.element.off("click",this._clickProxy),jQuery(document).off("mousemove",this._moveProxy),jQuery(document).off("mouseup",this._upProxy),this._selectedItem=null,this._items=null,this._columns=null,this._lists=null,this._dClickProxy=null},r.prototype.updateItems=function(){this._fix.element.detach();var t=[];for(n=this._items.length;n--;)this._items[n].clearComponents();for(var n=0;n<this._lists.length;n++)t.push(this._lists[n].element.width()),this._lists[n].dispose();if(this._lists=[],this._mode==i.DETAILS){for(var o=this._sortableColumn,r=0,n=0;n<this._columns.length;n++){var s=this.addChild("<div class='list' "+(t.length>0?"style='width:"+t[n]+"px;'":"")+"></div>");this._lists.push(s);var a=new e.ListViewHeader(this._columns[n].text+(n==o?"   ▼":""),this._columns[n].image);s.addChild(a);var l=0,h=a.element.clone();h.css({"float":"left"}),jQuery("body").append(h),l=h.width()+10,h.remove(),t.length>0&&t[n]>l&&(l=t[n]),r+=l,s.element.css({"min-width":l+"px",width:l+"px"})}this.element.append(this._fix.element),this.element.css({"min-width":r+"px"}),this._items.sort(function(e,t){if(o<e.fields.length&&o<e.fields.length){var n=e.fields[o].toString().toLowerCase(),i=t.fields[o].toString().toLowerCase();return i>n?-1:n>i?1:0}return 1});for(var n=0;n<this._items.length;n++)for(var c=0;c<this._items[n].fields.length;c++)if(c<this._lists.length){var u=this._items[n].field(this._items[n].fields[c]);this._lists[c].addChild(u)}}else{this.element.css({"min-width":""});for(var n=0;n<this._items.length;n++){var u=this._items[n].preview(this._items[n].fields[1],this._imgSize);this.addChild(u)}}},r.prototype.addColumn=function(e,t){void 0===t&&(t=""),this._columns.push(new n(e,t)),this.updateItems()},r.prototype.removeColumn=function(e){-1!=this._columns.indexOf(e)&&this._columns.splice(this._columns.indexOf(e,1)),this.updateItems()},r.prototype.addItem=function(e){var t=e;if(this._items.push(t),e.rowNum=this._items.length,this._mode==i.DETAILS){for(var n=0;n<e.fields.length;n++)if(n<this._lists.length){var o=e.field(e.fields[n]);this._lists[n].addChild(o)}}else{var o=e.preview(e.fields[1],this._imgSize);this.addChild(o)}return t},r.prototype.setColumnWidth=function(e,t){this._lists.length>e&&this._lists[e].element.css("width",t),this.updateItems()},r.prototype.removeItem=function(e,t){return void 0===t&&(t=!0),this._items.splice(this._items.indexOf(e),1),t&&e.dispose(),e},r.prototype.clearItems=function(e){void 0===e&&(e=!0);for(var t=this._items.length;t--;)e&&this._items[t].dispose();this._items.splice(0,this._items.length)},Object.defineProperty(r.prototype,"items",{get:function(){return this._items},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"lists",{get:function(){return this._lists},enumerable:!0,configurable:!0}),r}(e.Component);e.ListView=o}(Animate||(Animate={}));var Animate;!function(e){var t=function(e){function t(t){e.call(this,t)}return __extends(t,e),t.ITEM_SELECTED=new t("list_item_selected"),t}(e.ENUM);e.ListEvents=t;var n=function(n){function i(e,t,i,o){void 0===t&&(t="<div class='list-box'></div>"),void 0===i&&(i="<select class='list' size='6'></select>"),void 0===o&&(o=!1),o&&(i="<select></select>"),n.call(this,t,e),this.selectBox=this.addChild(i),this.selectProxy=this.onSelection.bind(this),this.selectBox.element.on("change",this.selectProxy),this.items=[]}return __extends(i,n),i.prototype.onSelection=function(n){this.emit(new e.ListEvent(t.ITEM_SELECTED,this.selectedItem))},i.prototype.addItem=function(e){var t=jQuery("<option value='"+this.items.length+"'>"+e+"</option>");return this.items.push(t),this.selectBox.element.append(t),t},i.prototype.sort=function(){for(var e=this.items,t=e.length;t--;)e[t].detach();this.items=e.sort(function(e,t){var n=e.text().toUpperCase(),i=t.text().toUpperCase();return i>n?-1:n>i?1:0});for(var n=e.length,t=0;n>t;t++)this.selectBox.element.append(e[t])},i.prototype.removeItem=function(e){for(var t=this.items.length,n=0;t>n;n++){var i=this.items[n].text();if(i==e){var o=this.items[n];return this.items.splice(n,1),o.detach(),o}}return null},i.prototype.numItems=function(){return this.items.length},Object.defineProperty(i.prototype,"selectedItem",{get:function(){for(var e=this.items.length,t=0;e>t;t++)if(this.items[t].prop("selected"))return this.items[t].text();return null},set:function(e){jQuery("select option",this.element).filter(function(){return jQuery(this).text()==e}).prop("selected",!0)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"selectedIndex",{get:function(){for(var e=this.items.length,t=0;e>t;t++)if(this.items[t].prop("selected")===!0)return t;return-1},set:function(e){if("undefined"!=typeof e){for(var t=this.items.length,n=0;t>n;n++)this.items[n].prop("selected",!1);this.items[e].prop("selected",!0)}},enumerable:!0,configurable:!0}),i.prototype.getItem=function(e){for(var t=this.items.length,n=0;t>n;n++){var i=this.items[n].text();if(i==e)return this.items[n]}return null},i.prototype.clearItems=function(){for(var e=this.items.length,t=0;e>t;t++)this.items[t].remove();this.items.splice(0,e)},i.prototype.dispose=function(){this.selectProxy=null,this.selectBox.element.off(),this.items=null,this.selectBox=null,n.prototype.dispose.call(this)},i}(e.Component);e.List=n}(Animate||(Animate={}));var Animate;!function(e){var t=function(e){function t(t){void 0===t&&(t=null),e.call(this,t,"<div class='combo-box'></div>","<select class='combo'></select>");
}return __extends(t,e),t}(e.List);e.ComboBox=t}(Animate||(Animate={}));var Animate;!function(e){var t=function(t){function n(i){if(t.call(this,i,null),null!=n._singleton)throw new Error("The Application class is a singleton. You need to call the Application.getSingleton() function.");n.bodyComponent=new e.Component("body"),n._singleton=this,this._canvasContext=new e.CanvasContext,this._focusObj=null,e.TooltipManager.create(),e.User.get,this._resizeProxy=this.onWindowResized.bind(this),this._downProxy=this.onMouseDown.bind(this);var o=new e.Component("#stage"),r=e.Toolbar.getSingleton(new e.Component("#toolbar"));this.addChild(r),this.addChild(o);var s=new e.SplitPanel(o,e.SplitOrientation.VERTICAL,.75);s.element.css({width:"100%",height:"100%"});var a=new e.SplitPanel(s.left,e.SplitOrientation.HORIZONTAL,.85),l=new e.SplitPanel(s.right,e.SplitOrientation.HORIZONTAL,.5);a.element.css({width:"100%",height:"100%"}),l.element.css({width:"100%",height:"100%"});var h=new e.PropertyGrid(l.top),c=e.SceneTab.getSingleton(l.bottom),u=e.CanvasTab.getSingleton(a.top);e.Logger.getSingleton(a.bottom),e.Logger.logMessage("let's get animated!",null,e.LogType.MESSAGE),this._dockerlefttop=new e.Docker(a.top),this._dockerlefttop.addComponent(u,!1),this._dockerleftbottom=new e.Docker(a.bottom),this._dockerleftbottom.addComponent(e.Logger.getSingleton(),!1),this._dockerrightbottom=new e.Docker(l.bottom),this._dockerrightbottom.addComponent(c,!1),this._dockerrighttop=new e.Docker(l.top),this._dockerrighttop.addComponent(h,!1),this.update(),jQuery(window).on("resize",this._resizeProxy),jQuery(document).on("mousedown",this._downProxy)}return __extends(n,t),n.prototype.onMouseDown=function(e){for(var t=jQuery(e.target),n=t.data("component");!n&&0!=t.length;)t=jQuery(t).parent(),n=t.data("component");this.setFocus(n)},n.prototype.setFocus=function(e){this._focusObj&&this._focusObj.element.data("focus",!1),null!=e&&(e.element.data("focus",!0),this._focusObj=e)},n.prototype.onWindowResized=function(e){e&&$(e.target).hasClass("ui-resizable")||t.prototype.update.call(this)},n.prototype.dispose=function(){jQuery(window).off("resize",this._resizeProxy),jQuery(document).off("mousedown",this._downProxy),this._resizeProxy=null,this._downProxy=null,t.prototype.dispose.call(this)},n.prototype.projectReset=function(){var t=e.User.get;e.PropertyGrid.getSingleton().projectReset(),e.Logger.getSingleton().clearItems(),e.TreeViewScene.getSingleton().projectReset(t.project),e.CanvasTab.getSingleton().projectReset();var t=e.User.get;t.project&&t.project.reset(),e.PluginManager.getSingleton().projectReset(t.project)},n.getInstance=function(e){return void 0===n._singleton&&(n._singleton=new n(e)),n._singleton},Object.defineProperty(n.prototype,"focusObj",{get:function(){return this._focusObj},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"canvasContext",{get:function(){return this._canvasContext},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"dockerLeftTop",{get:function(){return this._dockerlefttop},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"dockerLeftBottom",{get:function(){return this._dockerleftbottom},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"dockerRightTop",{get:function(){return this._dockerrighttop},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"dockerRightBottom",{get:function(){return this._dockerrightbottom},enumerable:!0,configurable:!0}),n}(e.Component);e.Application=t}(Animate||(Animate={}));var Animate;!function(e){var t=function(t){function n(n,i){t.call(this,n,i),this.shallowId=e.Utils.generateLocalId()}return __extends(n,t),n.prototype.css=function(e,t){var n=this.element.css(e,t);return n},n.prototype.tokenize=function(t){void 0===t&&(t=!1);var n={};return n.shallowId=this.shallowId,n.type=e.CanvasItemType.Behaviour,t||(n.left=this.element.css("left"),n.top=this.element.css("top")),n},n.prototype.deTokenize=function(e){this.css({left:e.left,top:e.top})},n.prototype.link=function(e,t){},n}(e.Component);e.CanvasItem=t}(Animate||(Animate={}));var Animate;!function(e){var t=function(t){function n(n,i,o){void 0===o&&(o="<div class='behaviour reg-gradient'><div class='text'>"+i+"</div></div>"),t.call(this,o,n),this._fontSize=5;var r=this._fontSize*i.length+20,s=this._fontSize+20;this.element.css({width:r+"px",height:s+"px",margin:""}),this._originalName=i,this._alias=i,this._canGhost=!0,this._parameters=[],this._products=[],this._outputs=[],this._inputs=[],this._portals=[],this._properties=new e.EditableSet(this),this._requiresUpdated=!0}return __extends(n,t),n.prototype.getPortal=function(e){for(var t=0,n=this.portals,i=n.length;i>t;t++)if(n[t].property.name==e)return n[t];return null},n.prototype.addPortal=function(t,n,i,o){void 0===o&&(o=!1);var r=new e.Portal(this,t,n,o);this._requiresUpdated=!0,t==e.PortalType.PARAMETER?this._parameters.push(r):t==e.PortalType.PRODUCT?this._products.push(r):t==e.PortalType.OUTPUT?this._outputs.push(r):this._inputs.push(r),this._portals.push(r);r.element.width();return r.behaviour=this,i&&this.updateDimensions(),r},n.prototype.removePortal=function(e,t){void 0===t&&(t=!0),this._requiresUpdated=!0,this.removeChild(e);var n=this._parameters.indexOf(e);return-1!=n&&(this._properties.removeVar(e.property.name),this._parameters.splice(n,1),e.behaviour=null),n=this._products.indexOf(e),-1!=n&&this._products.splice(n,1),n=this._outputs.indexOf(e),-1!=n&&this._outputs.splice(n,1),n=this._inputs.indexOf(e),-1!=n&&this._inputs.splice(n,1),n=this._portals.indexOf(e),-1!=n&&this._portals.splice(n,1),t&&e.dispose(),this.updateDimensions(),e},n.prototype.onRenamed=function(e){},n.prototype.css=function(e,t){var n=this.element.css(e,t);this._requiresUpdated=!0;var i=this._fontSize*this.text.length+20,o=this._fontSize+20,r=5,s=this._portals.length>0?this._portals[0].element.outerWidth():10,a=this._products.length>this._parameters.length?this._products.length:this._parameters.length,l=this._inputs.length>this._outputs.length?this._inputs.length:this._outputs.length,h=s+r,c=h*a,u=h*l,p=10;return i=i+p>c?i+p:c,o=o+p>u?o+p:u,i=10*Math.ceil(i/10),o=10*Math.ceil(o/10),this.element.css({width:i+"px",height:o+"px",margin:""}),n},n.prototype.updateDimensions=function(){if(0!=this._requiresUpdated){this._requiresUpdated=!1;var e=this._portals.length>0?this._portals[0].element.outerWidth():10,t=5,n=this._fontSize*this.text.length+20,i=this._fontSize+20,o=this._products.length>this._parameters.length?this._products.length:this._parameters.length,r=this._inputs.length>this._outputs.length?this._inputs.length:this._outputs.length,s=e+t,a=s*o,l=s*r,h=10;n=n+h>a?n+h:a,i=i+h>l?i+h:l,n=10*Math.ceil(n/10),i=10*Math.ceil(i/10),this.css({width:n+"px",height:i+"px"});for(var c=this.element.outerWidth(),u=this.element.outerHeight(),p=0;p<this._parameters.length;p++)this._parameters[p].element.css({left:(e+t)*p+"px",top:-e+"px"});for(var p=0;p<this._outputs.length;p++)this._outputs[p].element.css({top:(e+t)*p+"px",left:c+"px"});for(var p=0;p<this._inputs.length;p++)this._inputs[p].element.css({top:(e+t)*p+"px",left:-e+"px"});for(var p=0;p<this._products.length;p++)this._products[p].element.css({left:(e+t)*p+"px",top:u+"px"})}},Object.defineProperty(n.prototype,"text",{get:function(){return jQuery(".text",this.element).text()},set:function(e){jQuery(".text",this.element).text(e),this._requiresUpdated=!0,void 0!==e&&this.updateDimensions()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"selected",{get:function(){return this.element.hasClass("selected")?!0:!1},set:function(e){e?this.element.addClass("selected"):this.element.removeClass("selected"),this.updateDimensions()},enumerable:!0,configurable:!0}),n.prototype.tokenize=function(e){void 0===e&&(e=!1);var n=t.prototype.tokenize.call(this,e);n.portals=[];for(var i=0,o=this.portals,r=o.length;r>i;i++){var s={name:o[i].property.name,property:o[i].property.tokenize(e),type:o[i].type};e||(s.custom=o[i].customPortal),n.portals.push(s)}return e||(n.alias=this.alias,n.text=this.text),n},n.prototype.deTokenize=function(n){for(t.prototype.deTokenize.call(this,n),this.alias=n.alias,this.text=n.text;this.portals.length>0;)this.portals.pop().dispose();for(var i=0,o=n.portals,r=o.length;r>i;i++){var s=e.Utils.createProperty(o[i].property.name,o[i].property.type);s.deTokenize(o[i].property);var a=this.addPortal(o[i].type,s,!1);a.customPortal=o[i].custom}this.updateDimensions()},n.prototype.dispose=function(){this.element.draggable("destroy");for(var e=0;e<this._parameters.length;e++)this._parameters[e].dispose();for(var e=0;e<this._products.length;e++)this._products[e].dispose();for(var e=0;e<this._outputs.length;e++)this._outputs[e].dispose();for(var e=0;e<this._inputs.length;e++)this._inputs[e].dispose();this._parameters=null,this._products=null,this._outputs=null,this._inputs=null,this._portals=null,this._alias=null,t.prototype.dispose.call(this)},Object.defineProperty(n.prototype,"name",{get:function(){return this._alias},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"properties",{get:function(){return this._properties},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"originalName",{get:function(){return this._originalName},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"alias",{get:function(){return this._alias},set:function(e){this._alias=e},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"canGhost",{get:function(){return this._canGhost},set:function(e){this._canGhost=e},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"requiresUpdated",{get:function(){return this._requiresUpdated},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"parameters",{get:function(){return this._parameters},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"products",{get:function(){return this._products},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"outputs",{get:function(){return this._outputs},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"inputs",{get:function(){return this._inputs},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"portals",{get:function(){return this._portals},enumerable:!0,configurable:!0}),n}(e.CanvasItem);e.Behaviour=t}(Animate||(Animate={}));var Animate;!function(e){var t=function(t){function n(n,i,o){void 0===o&&(o=e.PortalType.INPUT),this._portalType=o,this._property=i,t.call(this,n,i?i.name:"Portal"),this.element.addClass("behaviour-portal"),i&&(this._portalType==e.PortalType.OUTPUT?this.addPortal(e.PortalType.INPUT,i,!0):this._portalType==e.PortalType.INPUT?this.addPortal(e.PortalType.OUTPUT,i,!0):this._portalType==e.PortalType.PARAMETER?this.addPortal(e.PortalType.PRODUCT,i,!0):this._portalType==e.PortalType.PRODUCT&&this.addPortal(e.PortalType.PARAMETER,i,!0),this.element.addClass(e.PortalType[this._portalType].toLowerCase()))}return __extends(n,t),n.prototype.tokenize=function(n){void 0===n&&(n=!1);var i=t.prototype.tokenize.call(this,n);return i.portal={name:this._property.name,custom:!0,type:this._portalType,property:this._property.tokenize(n)},i.type=e.CanvasItemType.BehaviourPortal,i},n.prototype.deTokenize=function(n){t.prototype.deTokenize.call(this,n),this._portalType=n.portal.type,this.element.addClass(e.PortalType[this._portalType].toLowerCase()),this._property=e.Utils.createProperty(n.portal.property.name,n.portal.property.type),this._property.deTokenize(n)},n.prototype.dispose=function(){this._portalType=null,this._property=null,t.prototype.dispose.call(this)},Object.defineProperty(n.prototype,"portaltype",{get:function(){return this._portalType},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"property",{get:function(){return this._property},enumerable:!0,configurable:!0}),n}(e.Behaviour);e.BehaviourPortal=t}(Animate||(Animate={}));var Animate;!function(e){var t=function(t){function n(e,n,i){t.call(this,e,i),this.element.addClass("behaviour-shortcut"),this._originalNode=n,this._savedResource=0,n&&this.setOriginalNode(n,!0),this.tooltip="Press C to focus on source"}return __extends(n,t),n.prototype.tokenize=function(n){void 0===n&&(n=!1);var i=t.prototype.tokenize.call(this,n);return i.originalId=this._originalNode.shallowId,i.type=e.CanvasItemType.BehaviourShortcut,i},n.prototype.deTokenize=function(e){t.prototype.deTokenize.call(this,e),this._savedResource=e.originalId},n.prototype.link=function(t,n){var i=n[t].token;return n[i.originalId]?void this.setOriginalNode(n[i.originalId].item,!1):(this.text="NOT FOUND",void e.Logger.logMessage("Could not find original node for shortcut "+t,null,e.LogType.ERROR))},n.prototype.setOriginalNode=function(t,n){if(this._originalNode=t,t instanceof e.BehaviourAsset?this.element.addClass("behaviour-asset"):t instanceof e.BehaviourPortal&&this.element.addClass("behaviour-portal"),n)for(var i=0,o=t.portals.length;o>i;i++)this.addPortal(t.portals[i].type,t.portals[i].property,!1);this.updateDimensions()},n.prototype.dispose=function(){this._originalNode=null,e.Behaviour.prototype.dispose.call(this)},Object.defineProperty(n.prototype,"originalNode",{get:function(){return this._originalNode},enumerable:!0,configurable:!0}),n}(e.Behaviour);e.BehaviourShortcut=t}(Animate||(Animate={}));var Animate;!function(e){var t=function(t){function n(e,n){void 0===n&&(n="Asset"),t.call(this,e,n),this.element.addClass("behaviour-asset"),this._asset=null}return __extends(n,t),n.prototype.dispose=function(){this._asset=null,t.prototype.dispose.call(this)},n.prototype.tokenize=function(n){void 0===n&&(n=!1);var i=t.prototype.tokenize.call(this,n);return i.type=e.CanvasItemType.BehaviourAsset,i},n.prototype.addPortal=function(n,i,o){var r=t.prototype.addPortal.call(this,n,i,o);return n==e.PortalType.PARAMETER&&(this._asset=i.getVal()),r},Object.defineProperty(n.prototype,"asset",{get:function(){return this._asset},set:function(e){this._asset=e},enumerable:!0,configurable:!0}),n}(e.Behaviour);e.BehaviourAsset=t}(Animate||(Animate={}));var Animate;!function(e){var t=function(t){function n(n,i){t.call(this,n,i),this.canGhost=!1,this.element.removeClass("reg-gradient").addClass("behaviour-comment").addClass("comment").addClass("shadow-small"),this.isInInputMode=!1,this.stageClickProxy=jQuery.proxy(this.onStageClick,this),this.input=jQuery("<textarea rows='10' cols='30'></textarea>"),this.element.on("mousedown",jQuery.proxy(this.onResizeStart,this)),this.mStartX=null,this.mStartY=null,this.element.resizable({minHeight:50,minWidth:50,helper:"ui-resizable-helper",resize:jQuery.proxy(this.onResizeUpdate,this),stop:jQuery.proxy(this.onResizeStop,this)}),this.properties.addVar(new e.PropText("Comment",i)),this.on("edited",this.onEdit,this)}return __extends(n,t),n.prototype.tokenize=function(n){void 0===n&&(n=!1);var i=t.prototype.tokenize.call(this,n);return i.type=e.CanvasItemType.BehaviourComment,i.width=this.element.width(),i.height=this.element.height(),i},n.prototype.deTokenize=function(e){t.prototype.deTokenize.call(this,e),this.element.css({width:e.width+"px",height:e.height+"px"}),this.properties.getVar("Comment").setVal(e.text)},n.prototype.onEdit=function(e,t,n){this.text=t.property.getVal()},n.prototype.updateDimensions=function(){},n.prototype.onIn=function(e){this.element.css("opacity",1)},n.prototype.css=function(e,n){var i=t.prototype.css.call(this,e,n);return i},n.prototype.onOut=function(e){this.element.css("opacity",.3)},n.prototype.onResizeStart=function(e,t){this.mStartX=this.element.css("left"),this.mStartY=this.element.css("top"),this.mOffsetX=this.element.offset().left,this.mOffsetY=this.element.offset().top},n.prototype.onResizeUpdate=function(e,t){this.element.css({left:this.mStartX,top:this.mStartY});var n=jQuery(t.helper);n.css({left:this.mOffsetX,top:this.mOffsetY})},n.prototype.onResizeStop=function(e,t){this.onStageClick(null),this.element.css({left:this.mStartX,top:this.mStartY})},n.prototype.enterText=function(){return this.isInInputMode?!1:(jQuery("body").on("click",this.stageClickProxy),jQuery("body").append(this.input),this.isInInputMode=!0,this.input.css({position:"absolute",left:this.element.offset().left+"px",top:this.element.offset().top+"px",width:this.element.outerWidth()+"px",height:this.element.outerHeight()+"px","z-index":9999}),this.element.hide(),this.input.val(this.element.text()),this.input.focus(),void this.input.select())},n.prototype.onStageClick=function(e){0!=this.isInInputMode&&(null!=e&&jQuery(e.target).is(this.input)||(jQuery("body").off("click",this.stageClickProxy),this.isInInputMode=!1,this.element.css({width:this.input.width()+"px",height:this.input.height()+"px"}),this.input.detach(),this.element.show(),this.properties.getVar("Comment").setVal(this.input.val())))},n.prototype.dispose=function(){this.off("edited",this.onEdit,this),jQuery("body").off("click",this.stageClickProxy),this.input.remove(),t.prototype.dispose.call(this),this.stageClickProxy=null,this.isInInputMode=null,this.input=null},n}(e.Behaviour);e.BehaviourComment=t}(Animate||(Animate={}));var Animate;!function(e){var t=function(t){function n(n,i,o,r){void 0===r&&(r=!1),t.call(this,"<div class='portal "+e.PortalType[i].toLowerCase()+"'></div>",n),this._links=[],this._customPortal=!1,this._type=i,this.behaviour=n,this.edit(o),this._customPortal=r,(i==e.PortalType.PRODUCT||i==e.PortalType.OUTPUT)&&this.element.on("mousedown",jQuery.proxy(this.onPortalDown,this))}return __extends(n,t),n.prototype.edit=function(t){var n=10,i=.5*n,o=.65*n;this.element.html(""),this._type==e.PortalType.PARAMETER?this.element.append('<svg height="'+n+'" width="'+n+'"><polygon points="0,0 '+i+","+(n-o)+" "+n+",0 "+n+","+n+" 0,"+n+'" /></svg>'):this._type==e.PortalType.OUTPUT?this.element.append('<svg height="'+n+'" width="'+n+'"><polygon points="0,0 '+o+",0 "+n+","+i+" "+o+","+n+" 0,"+n+'" /></svg>'):this._type==e.PortalType.INPUT?this.element.append('<svg height="'+n+'" width="'+n+'"><polygon points="0,0 '+n+",0 "+n+","+n+" 0,"+n+" "+(n-o)+","+i+'" /></svg>'):this._type==e.PortalType.PRODUCT&&this.element.append('<svg height="'+n+'" width="'+n+'"><polygon points="0,0 '+n+",0 "+n+","+o+" "+i+","+n+" 0,"+o+'" /></svg>'),this._type==e.PortalType.PARAMETER&&(this.behaviour.properties.removeVar(t.name),this.behaviour.properties.addVar(t)),this._property=t,this.tooltip=t.toString()},n.prototype.checkPortalLink=function(t){return t.type==e.PortalType.OUTPUT&&this.type==e.PortalType.INPUT?!0:t.type==e.PortalType.PRODUCT&&this.type==e.PortalType.PARAMETER?null==this._property.type||this._property.type==e.PropertyType.OBJECT?!0:this._property.type==this._property.type?!0:null==e.PluginManager.getSingleton().getConverters(t._property.type,this._property.type)?!1:!0:!1},n.prototype.dispose=function(){for(var e=this._links.length;e>0;)this._links[0].dispose(),e=this._links.length;this._links=null,this.behaviour=null,this._type=null,this._property=null,t.prototype.dispose.call(this)},n.prototype.onPortalDown=function(t){var n=new e.Link(this.parent.parent.element.data("component"));n.start(this,t)},n.prototype.addLink=function(e){-1==jQuery.inArray(e,this._links)&&this._links.push(e),this._links.length>0?this.element.addClass("active"):this.element.removeClass("active")},n.prototype.removeLink=function(e){return-1==this._links.indexOf(e)?e:(this._links.splice(this._links.indexOf(e),1),0==this._links.length&&this.element.removeClass("active"),e)},n.prototype.updateAllLinks=function(){for(var e=this._links,t=e.length;t--;)e[t].updatePoints()},n.prototype.positionOnCanvas=function(){for(var e=this.parent.element,t=e,n=0,i=0,o=0,r=0;0!=e.length;)o=e.scrollLeft(),r=e.scrollTop(),n+=o,i+=r,e=e.parent();var s=this.element.position(),a=t.position();return{left:n+s.left+a.left,top:i+s.top+a.top}},Object.defineProperty(n.prototype,"type",{get:function(){return this._type},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"property",{get:function(){return this._property},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"customPortal",{get:function(){return this._customPortal},set:function(e){this._customPortal=e},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"links",{get:function(){return this._links},enumerable:!0,configurable:!0}),n}(e.Component);e.Portal=t}(Animate||(Animate={}));var Animate;!function(e){var t=function(t){function n(e,n){var i=void 0!==n.entry.name?n.entry.name:"Instance";this._container=n,t.call(this,e,i),this.element.addClass("behaviour-instance"),this.container=n,this.updateDimensions()}return __extends(n,t),n.prototype.tokenize=function(n){void 0===n&&(n=!1);var i=t.prototype.tokenize.call(this,n);return i.type=e.CanvasItemType.BehaviourInstance,i},n.prototype.deTokenize=function(e){t.prototype.deTokenize.call(this,e)},n.prototype.onContainerDeleted=function(e,t,n){if(t.container==this._container){var i=this._container.canvas;i&&i.removeItem(this)}},n.prototype.onPortalChanged=function(t,n,i){var o=(this.element.parent(),this.portals);if(t==e.EventTypes.PORTAL_ADDED){var r=null;n.portal.type==e.PortalType.INPUT?r=e.PortalType.OUTPUT:n.portal.type==e.PortalType.OUTPUT?r=e.PortalType.INPUT:n.portal.type==e.PortalType.PARAMETER?r=e.PortalType.PRODUCT:n.portal.type==e.PortalType.PRODUCT&&(r=e.PortalType.PARAMETER),this.addPortal(r,n.portal.property.clone(),!0)}else if(t==e.EventTypes.PORTAL_REMOVED){for(var s=0,a=o.length;a>s;s++)if(o[s].property.name==n.oldName){this.removePortal(o[s],!0);break}}else if(t==e.EventTypes.PORTAL_EDITED)for(var s=0,a=o.length;a>s;s++)if(o[s].property.name==n.oldName){var l=o[s];l.edit(n.portal.property.clone());break}this.updateDimensions()},n.prototype.dispose=function(){this.container=null,t.prototype.dispose.call(this)},Object.defineProperty(n.prototype,"container",{get:function(){return this._container},set:function(t){for(;this.portals.length>0;)this.removePortal(this.portals[0]);if(this._container&&(this._container.off(e.EventTypes.PORTAL_ADDED,this.onPortalChanged,this),this._container.off(e.EventTypes.PORTAL_REMOVED,this.onPortalChanged,this),this._container.off(e.EventTypes.PORTAL_EDITED,this.onPortalChanged,this),this._container.off(e.EventTypes.CONTAINER_DELETED,this.onContainerDeleted,this)),this._container=t,t){t.on(e.EventTypes.PORTAL_ADDED,this.onPortalChanged,this),t.on(e.EventTypes.PORTAL_REMOVED,this.onPortalChanged,this),t.on(e.EventTypes.PORTAL_EDITED,this.onPortalChanged,this),t.on(e.EventTypes.CONTAINER_DELETED,this.onContainerDeleted,this);for(var n=this._container.canvas.children,i=0,o=n.length;o>i;i++)if(n[i]instanceof e.BehaviourPortal)for(var r=n[i],s=r.portals,a=0,l=s.length;l>a;a++)this.addPortal(r.portaltype,s[a].property.clone(),!1)}},enumerable:!0,configurable:!0}),n}(e.Behaviour);e.BehaviourInstance=t}(Animate||(Animate={}));var Animate;!function(e){var t=function(t){function n(n,i,o,r){void 0===r&&(r=!1),t.call(this,n,"Script"),e.Utils.generateLocalId(),this.scriptTab=null,this.scriptId=i,this._loading=jQuery("<img src='media/buffering-white.png' class='rotate-360' />");var s,a=this.element,l=this,h=e.User.get.project;this.alias=o,a.addClass("behaviour-script"),this._loading.insertBefore(jQuery(".text",a)),s=i&&r?h.createResource(e.ResourceType.SCRIPT,{name:o}):h.createResource(e.ResourceType.SCRIPT,{name:o,projectId:h.entry._id}),s.then(function(t){e.Logger.logMessage("Created behaviour script '"+o+"'",null,e.LogType.MESSAGE),l._loading.detach(),l.scriptId=t.entry._id})["catch"](function(t){e.Logger.logMessage(t.message,null,e.LogType.ERROR)})}return __extends(n,t),n.prototype.onRenamed=function(e){this.scriptTab&&this.scriptTab.rename(e)},n.prototype.edit=function(){this.scriptTab?e.CanvasTab.getSingleton().selectTab(this.scriptTab):this.scriptTab=e.CanvasTab.getSingleton().addSpecialTab("",e.CanvasTabType.SCRIPT,this)},n.prototype.tokenize=function(n){void 0===n&&(n=!1);var i=t.prototype.tokenize.call(this,n);return i.scriptId=this.scriptId,i.type=e.CanvasItemType.BehaviourScript,i},n.prototype.deTokenize=function(e){t.prototype.deTokenize.call(this,e),this.scriptId=this.scriptId},n.prototype.dispose=function(){this.scriptTab=null,t.prototype.dispose.call(this)},n}(e.Behaviour);e.BehaviourScript=t}(Animate||(Animate={}));var Animate;!function(e){var t=(function(){function e(e,t){this.item=e,this.datum=t}return e}(),function(e){function t(t){e.call(this,t)}return __extends(t,e),t.MODIFIED=new t("canvas_modified"),t}(e.ENUM));e.CanvasEvents=t;var n=function(n){function i(t,i){n.call(this,"<div class='canvas' tabindex='0'></div>",t),this._proxyMoving=this.onChildMoving.bind(this),this._proxyStartDrag=this.onStartingDrag.bind(this),this._proxyStopDrag=this.onChildDropped.bind(this),this._downProxy=this.onMouseDown.bind(this),this._upProxy=this.onMouseUp.bind(this),this._x=0,this._y=0,this.name=i.entry.name,this._container=i,this._loadingScene=!1,i.canvas=this,this._contextProxy=this.onContext.bind(this),this._keyProxy=this.onKeyDown.bind(this),this._contextNode=null,this._containerReferences={groups:[],assets:[]},new e.BehaviourPortal(this,new e.PropBool("Start",!1),e.PortalType.INPUT),this.element.on("mousedown",this._downProxy),this.element.on("dblclick",jQuery.proxy(this.onDoubleClick,this)),jQuery("body").on("keydown",this._keyProxy),jQuery(document).on("contextmenu",this._contextProxy),this.element.droppable({drop:this.onObjectDropped.bind(this),accept:".behaviour-to-canvas"}),e.BehaviourPicker.getSingleton().on(e.BehaviourPickerEvents.BEHAVIOUR_PICKED,this.onBehaviourPicked,this),e.PortalForm.getSingleton().on(e.OkCancelFormEvents.CONFIRM,this.OnPortalConfirm,this),e.PluginManager.getSingleton().on(e.EditorEvents.ASSET_EDITED,this.onAssetEdited,this)}return __extends(i,n),i.prototype.onStartingDrag=function(t,n){var o=jQuery(t.currentTarget).data("component");if(t.shiftKey){if(!o.canGhost)return;var r=o.element.css("left"),s=o.element.css("top"),a=null;a=o instanceof e.BehaviourShortcut?new e.BehaviourShortcut(this,o.originalNode,o.originalNode.alias):new e.BehaviourShortcut(this,o,o.alias),a.element.css({left:r,top:s,position:"absolute"}),jQuery.ui.ddmanager.current.helper=a.element,jQuery.ui.ddmanager.current.cancelHelperRemoval=!0}jQuery.ui.ddmanager.current.options.grid=i.snapping?[10,10]:void 0},i.prototype.onChildDropped=function(n,o){var r=o.helper.data("component"),s=parseFloat(r.element.css("left").split("px")[0]),a=parseFloat(r.element.css("top").split("px")[0]);i.snapping&&(s=parseInt(s.toString()),a=parseInt(a.toString()),s-=s%10,a-=a%10),0>s&&(s=0),0>a&&(a=0),r.element.css({top:a+"px",left:s+"px"});for(var l=0,h=r.portals.length;h>l;l++)r.portals[l].updateAllLinks();this.emit(new e.CanvasEvent(t.MODIFIED,this))},i.prototype.onObjectDropped=function(t,n){var i=jQuery(n.draggable).data("component");if(i instanceof e.TreeNode){var o=this.parent.element,r=this.element.offset(),s=o.scrollLeft(),a=o.scrollTop(),l={x:t.pageX-r.left-s,y:t.pageY-r.top-a};this._x=l.x+s,this._y=l.y+a,i instanceof e.TreeNodeAssetInstance?this.addAssetAtLocation(i.resource,this._x,this._y):i instanceof e.TreeNodePluginBehaviour?this.createNode(i.template,this._x,this._y):i instanceof e.TreeNodeBehaviour&&this.createNode(e.PluginManager.getSingleton().getTemplate("Instance"),this._x,this._y,i.resource)}},i.prototype.addAssetAtLocation=function(t,n,i){var o=this.createNode(e.PluginManager.getSingleton().getTemplate("Asset"),n,i);o.asset=t,o.parameters[0].property.setVal(t),t&&(o.text=t.entry.name,o.alias=t.entry.name),this.buildSceneReferences()},i.prototype.dispose=function(){this.element.droppable("destroy"),e.PluginManager.getSingleton().off(e.EditorEvents.ASSET_EDITED,this.onAssetEdited,this),e.BehaviourPicker.getSingleton().off(e.BehaviourPickerEvents.BEHAVIOUR_PICKED,this.onBehaviourPicked,this),e.PortalForm.getSingleton().off(e.OkCancelFormEvents.CONFIRM,this.OnPortalConfirm,this),jQuery("body").off("keydown",this._keyProxy),jQuery(document).off("contextmenu",this._contextProxy),this.element.off("mousedown",this._downProxy),this._proxyMoving=null,this._proxyStartDrag=null,this._proxyStopDrag=null,this._x=null,this._y=null,this.name=null,this._container=null,this._keyProxy=null,this._contextProxy=null,this._contextNode=null,this._containerReferences=null,n.prototype.dispose.call(this)},i.prototype.removeAsset=function(t){for(var n=(e.PluginManager.getSingleton(),new e.AssetContainerEvent(e.EditorEvents.ASSET_REMOVED_FROM_CONTAINER,null,this._container),e.User.get.project,0),i=this.children.length;i>n;n++){var o=this.children[n];if(o instanceof e.Behaviour!=0)for(var r=o,s=0,a=r.parameters.length;a>s;s++){var l=r.parameters[s];if((l.property.type==e.PropertyType.ASSET||l.property.type==e.PropertyType.ASSET_LIST)&&null!=l.property.getVal()){var h=l.property.getVal();if(h instanceof e.Asset)h==t&&(l.property.setVal(null),r instanceof e.BehaviourAsset&&(r.asset=null));else if(h.length>0)for(var h,c=h,u=c.length;u>h;h++)c[h]==t&&l.property.setVal(null)}}}this.buildSceneReferences()},i.prototype.removeItem=function(n){for(var i=[],o=0;o<this.children.length;o++)i.push(this.children[o]);for(var o=0;o<i.length;o++)i[o]instanceof e.BehaviourShortcut&&i[o].originalNode==n&&this.removeItem(i[o]);for(var o=0;o<i.length;o++)i[o]==n&&(this.emit(new e.CanvasEvent(t.MODIFIED,this)),i[o]instanceof e.BehaviourPortal&&this.emit(new e.PortalEvent(e.EventTypes.PORTAL_REMOVED,"",this._container,i[o].portals[0])),i[o].dispose(),this.buildSceneReferences());i=null},i.prototype.removeItems=function(){for(var e=[],t=this.children.length;t--;)e.push(this.children[t]);for(var t=e.length;t--;)"undefined"!=typeof e[t]&&null!=e[t].disposed&&e[t].selected&&this.removeItem(e[t])},i.prototype.onContextSelect=function(n,i){var o=this._contextNode,r=this;if("Delete"==i.item.text){if(o instanceof e.Portal){var s=o.behaviour;return s.removePortal(o),void e.PropertyGrid.getSingleton().editableObject(s.properties,s.text+" - "+s.id,null)}e.Toolbar.getSingleton().onDelete()}else if("Remove Empty Assets"==i.item.text){for(var a=[],l=0,h=this.children.length;h>l;l++)a.push(this.children[l]);for(var l=0,h=a.length;h>l;l++)"undefined"!=typeof a[l]&&a[l]instanceof e.BehaviourAsset&&":"==a[l].parameters[0].value&&this.removeItem(a[l])}else if("Edit Portal"==i.item.text&&o instanceof e.Portal)e.PortalForm.getSingleton().editPortal(o.property,o.type,function(e){for(var t=0,n=o.behaviour.portals,i=n.length;i>t;t++)if(n[t].property.name==e)return!1;return!0}).then(function(e){e.cancel||o.edit(e.prop)});else if("Create Behaviour"==i.item.text){var c=e.Application.getInstance().canvasContext;e.BehaviourPicker.getSingleton().show(e.Application.getInstance(),c.element.offset().left,c.element.offset().top,!1,!0)}else if("Create Comment"==i.item.text){var u=new e.BehaviourComment(this,"Comment");u.element.addClass("scale-in-animation"),u.css({left:this._x+"px",top:this._y+"px",width:"100px",height:"60px"})}else if("Create Input"==i.item.text||"Create Output"==i.item.text||"Create Parameter"==i.item.text||"Create Product"==i.item.text){var p=e.PortalType.INPUT;"Create Output"==i.item.text?p=e.PortalType.OUTPUT:"Create Parameter"==i.item.text&&(p=e.PortalType.PARAMETER),"Create Product"==i.item.text&&(p=e.PortalType.PRODUCT),e.PortalForm.getSingleton().editPortal(null,p,function(t){if(o instanceof e.Behaviour){for(var n=0,i=o.portals,s=i.length;s>n;n++)if(i[n].property.name==t)return!1}else for(var n=0,a=r.children,s=a.length;s>n;n++)if(a[n]instanceof e.BehaviourPortal&&a[n].property.name==t)return!1;return!0}).then(function(n){if(!n.cancel){if(o instanceof e.Behaviour)o.addPortal(p,n.prop,!0,!0);else{var i=new e.BehaviourPortal(r,n.prop,p);i.css({left:r._x+"px",top:r._y+"px",position:"absolute"}),r.emit(new e.PortalEvent(e.EventTypes.PORTAL_ADDED,"",r._container,i.portals[0]))}r.emit(new e.CanvasEvent(t.MODIFIED,this))}})}this.onContextHide(e.WindowEvents.HIDDEN,null)},i.prototype.getAssetList=function(t,n){if(t){-1==n.indexOf(t.entry.shallowId)&&n.push(t.entry.shallowId);for(var i=(e.User.get.project,
t.properties.variables),o=0,r=i.length;r>o;o++)if(i[o].type==e.PropertyType.ASSET)this.getAssetList(i[o].getVal(),n);else if(i[o].type==e.PropertyType.ASSET_LIST)for(var s=i[o].getVal(),a=0,l=s.length;l>a;a++)this.getAssetList(s[a],n)}},i.prototype.onAssetEdited=function(e,t,n){this.buildSceneReferences()},i.prototype.buildSceneReferences=function(){for(var t=[],n=[],i=this.children,o=e.User.get.project,r=0;r<i.length;r++)if(i[r]instanceof e.Behaviour)for(var s=i[r],a=s.portals,l=0;l<a.length;l++){var h=a[l].property.getVal();if(h)if(h instanceof e.Asset)this.getAssetList(h,t);else if(h instanceof e.GroupArray)n.push(h.entry._id);else if(h.constructor===Array)for(var c,u=h,p=u.length;p>c;c++)this.getAssetList(u[c],t)}for(var d=e.PluginManager.getSingleton(),m=new e.AssetContainerEvent(e.EditorEvents.ASSET_ADDED_TO_CONTAINER,null,this._container),f=new e.AssetContainerEvent(e.EditorEvents.ASSET_REMOVED_FROM_CONTAINER,null,this._container),r=0,v=this._containerReferences.assets.length;v>r;r++)-1==t.indexOf(this._containerReferences.assets[r])&&(f.asset=o.getResourceByShallowID(this._containerReferences.assets[r],e.ResourceType.ASSET),d.emit(f));for(var r=0,v=t.length;v>r;r++)-1==this._containerReferences.assets.indexOf(t[r])&&(m.asset=o.getResourceByShallowID(t[r],e.ResourceType.ASSET),d.emit(m));this._containerReferences.assets=t,this._containerReferences.groups=n},i.prototype.onItemEdited=function(n,i,o){this._loadingScene||(this.emit(new e.CanvasEvent(t.MODIFIED,this)),this.buildSceneReferences())},i.prototype.OnPortalConfirm=function(n,i){if(0!=this.element.is(":visible")&&"Ok"==i.text){var o=this._contextNode;if(o instanceof e.Portal){var r=o,s=r.property.name;r.edit(e.PortalForm.getSingleton().getProperty());var a=r.parent;a instanceof e.BehaviourPortal&&(a.text=r.property.name);var l=r.behaviour;return e.PropertyGrid.getSingleton().editableObject(l.properties,l.text+" - "+l.id,""),void this.emit(new e.PortalEvent(e.EventTypes.PORTAL_EDITED,s,this._container,r))}if(o instanceof e.Behaviour)var r=o.addPortal(e.PortalForm.getSingleton().portalType,e.PortalForm.getSingleton().getProperty(),!0,!0);else{var h=new e.BehaviourPortal(this,e.PortalForm.getSingleton().getProperty(),e.PortalForm.getSingleton().portalType);h.css({left:this._x+"px",top:this._y+"px",position:"absolute"}),this.emit(new e.PortalEvent(e.EventTypes.PORTAL_ADDED,"",this._container,h.portals[0]))}this.emit(new e.CanvasEvent(t.MODIFIED,this))}},i.prototype.onContextHide=function(t,n){var i=e.Application.getInstance().canvasContext;i.off(e.WindowEvents.HIDDEN,this.onContextHide,this),i.off(e.ContextMenuEvents.ITEM_CLICKED,this.onContextSelect,this)},i.prototype.onContext=function(t){if(0!=this.element.is(":visible")){var n=this.parent.element,o=this.element.offset(),r=n.scrollLeft(),s=n.scrollTop(),a={x:t.pageX-o.left-r,y:t.pageY-o.top-s};this._x=a.x+r,this._y=a.y+s;var l=jQuery(t.target),h=l.data("component"),c=e.Application.getInstance().canvasContext;if(this._contextNode=l.data("component"),h instanceof i)this._contextNode=null,t.preventDefault(),c.showContext(t.pageX,t.pageY,null),c.on(e.WindowEvents.HIDDEN,this.onContextHide,this),c.on(e.ContextMenuEvents.ITEM_CLICKED,this.onContextSelect,this);else if(h instanceof e.Portal)t.preventDefault(),c.showContext(t.pageX,t.pageY,this._contextNode),c.on(e.WindowEvents.HIDDEN,this.onContextHide,this),c.on(e.ContextMenuEvents.ITEM_CLICKED,this.onContextSelect,this);else if(h instanceof e.Link){t.preventDefault();var u=l.data("component"),p=u.hitTestPoint(t);p&&(c.showContext(t.pageX,t.pageY,u),c.on(e.WindowEvents.HIDDEN,this.onContextHide,this),c.on(e.ContextMenuEvents.ITEM_CLICKED,this.onContextSelect,this))}else h instanceof e.BehaviourInstance||h instanceof e.BehaviourAsset||h instanceof e.BehaviourPortal?(t.preventDefault(),c.showContext(t.pageX,t.pageY,this._contextNode),c.on(e.WindowEvents.HIDDEN,this.onContextHide,this),c.on(e.ContextMenuEvents.ITEM_CLICKED,this.onContextSelect,this)):h instanceof e.BehaviourComment?t.preventDefault():h instanceof e.Behaviour?(t.preventDefault(),c.showContext(t.pageX,t.pageY,this._contextNode),c.on(e.WindowEvents.HIDDEN,this.onContextHide,this),c.on(e.ContextMenuEvents.ITEM_CLICKED,this.onContextSelect,this)):c.hide()}},i.prototype.onBehaviourPicked=function(t,n){if(0!=this.element.is(":visible")&&0!=this.element.parent().parent().length){var i=e.PluginManager.getSingleton().getTemplate(n.behaviourName),o=this;i&&("Script"==i.behaviourName?e.RenameForm.get.renameObject({name:"Script"},null,e.ResourceType.SCRIPT).then(function(e){e.cancelled||o.createNode(i,o._x,o._y,null,e.newName)}):o.createNode(i,o._x,o._y))}},i.prototype.isCyclicDependency=function(t,n){var i=e.User.get.project,o=this._container,r=null,s=null;if(t==o)return!0;if(s=e.CanvasTab.getSingleton().getTabCanvas(t.entry._id),r=s&&!s._container.saved?s.tokenize(!1):t.entry.json,!t.entry.json)return!1;for(var a=r.items,l=0,h=a.length;h>l;l++)if(a[l].type==e.CanvasItemType.BehaviourInstance){var c=i.getResourceByShallowID(a[l].shallowId,e.ResourceType.CONTAINER);if(c&&this.isCyclicDependency(c,n))return n=c.entry.name,!0}return!1},i.prototype.createNode=function(n,i,o,r,s){var a=null;if("Instance"==n.behaviourName){var l="",h=this.isCyclicDependency(r,l);if(h)return e.MessageBox.show("You have a cylic dependency with the behaviour '"+l+"'",["Ok"],null,null),null;a=new e.BehaviourInstance(this,r)}else a="Asset"==n.behaviourName?new e.BehaviourAsset(this,n.behaviourName):"Script"==n.behaviourName?new e.BehaviourScript(this,null,s):new e.Behaviour(this,n.behaviourName);"Instance"!=n.behaviourName&&"Script"!=n.behaviourName&&(a.text=n.behaviourName);var c=n.portalsTemplates();if(c)for(var u=0;u<c.length;u++){var p=a.addPortal(c[u].type,c[u].property.clone(),!1);a instanceof e.BehaviourScript==0&&(p.customPortal=!1)}return i=parseInt(i.toString()),o=parseInt(o.toString()),i-=i%10,o-=o%10,a.element.css({left:i+"px",top:o+"px"}),a.element.addClass("scale-in-animation"),a.updateDimensions(),this.emit(new e.CanvasEvent(t.MODIFIED,this)),a},i.prototype.onKeyDown=function(t){if(0!=this.element.is(":visible")&&!jQuery(t.target).is("input")){var n=e.Application.getInstance().focusObj,i=this;if(null!=n)if(113==t.keyCode){if(n instanceof e.BehaviourPortal)return;if(n instanceof e.BehaviourComment)return n.enterText();if(n instanceof e.Behaviour)return void e.RenameForm.get.renameObject(n,n.id,null).then(function(t){if(!t.cancelled){var o=null;o=n instanceof e.BehaviourShortcut?n.originalNode:n,o.text=t.newName,o.alias=t.newName;for(var r=i.children.length;r--;){var s=i.children[r];s instanceof e.BehaviourShortcut&&s.originalNode==o&&(s.text=t.newName,s.alias=t.newName)}}})}else if(67==t.keyCode){if(t.ctrlKey)return;if(n instanceof e.BehaviourShortcut)return this.selectItem(null),n.selected=!1,this.selectItem(n.originalNode),void this.element.parent().scrollTo("#"+n.originalNode.id,500)}else 46==t.keyCode&&e.Toolbar.getSingleton().onDelete()}},i.prototype.onDoubleClick=function(t){if(!jQuery(t.target).is("textarea")){var n=jQuery(t.target).data("component");if(n instanceof e.BehaviourComment)return void n.enterText();if(n instanceof e.BehaviourInstance){var i=e.TreeViewScene.getSingleton(),o=i.findNode("resource",n.container);return i.selectNode(o),void i.onDblClick(null)}if(n instanceof e.BehaviourScript)return void n.edit();var r=this.parent.element,s=this.element.offset(),a=r.scrollLeft(),l=r.scrollTop(),h={x:t.pageX-s.left-a,y:t.pageY-s.top-l};this._x=h.x+a,this._y=h.y+l,e.BehaviourPicker.getSingleton().show(e.Application.getInstance(),t.pageX,t.pageY,!1,!0),t.preventDefault()}},i.prototype.selectItem=function(t){if(null==t){for(var n=this.children,o=0,r=n.length;r>o;o++)n[o].element.removeClass("green-glow-strong").removeClass("short-active"),n[o].selected&&(n[o].selected=!1);return i.lastSelectedItem=null,e.PropertyGrid.getSingleton().editableObject(null,"",""),void e.Toolbar.getSingleton().itemSelected(null)}if(t.selected)return t.element.removeClass("green-glow-strong"),t.selected=!1,i.lastSelectedItem=null,e.PropertyGrid.getSingleton().editableObject(null,"",""),void e.Toolbar.getSingleton().itemSelected(null);if(t.selected=!0,i.lastSelectedItem=t,t instanceof e.Behaviour){t.element.removeClass("scale-in-animation"),t instanceof e.BehaviourComment?e.PropertyGrid.getSingleton().editableObject(t.properties,"Comment",""):t instanceof e.BehaviourShortcut==0&&e.PropertyGrid.getSingleton().editableObject(t.properties,t.text+" - "+t.id,"");for(var n=this.children,o=n.length;o--;)"undefined"!=typeof n[o]&&(n[o]instanceof e.BehaviourShortcut&&n[o].originalNode==t?n[o].element.addClass("short-active"):n[o].element.removeClass("short-active"))}else t instanceof e.Link&&t.startPortal.type==e.PortalType.OUTPUT&&e.PropertyGrid.getSingleton().editableObject(t.properties,"Link - "+t.id,"");e.Toolbar.getSingleton().itemSelected(t)},i.prototype.onMouseDown=function(e){e.preventDefault();var t=jQuery(e.currentTarget).data("component");return t instanceof i&&!e.ctrlKey?void this.selectItem(null):void 0},i.prototype.onMouseUp=function(t){var n=jQuery(t.currentTarget).data("component");if(!t.ctrlKey)for(var i=0;i<this.children.length;i++)this.children[i].selected=!1;if(n instanceof e.Behaviour)return n.element.removeClass("scale-in-animation"),void this.selectItem(n);for(var o=this.children.length,i=0;o>i;i++)if(n=this.children[i],n instanceof e.Link){var r=n.hitTestPoint(t);if(r)return void this.selectItem(n)}},i.prototype.onSelected=function(){for(var e=this.children.length,t=0;e>t;t++)this.children[t].element.removeClass("scale-in-animation")},i.prototype.addChild=function(t){var i=n.prototype.addChild.call(this,t);return i instanceof e.Behaviour&&i.element.draggable({drag:this._proxyMoving,start:this._proxyStartDrag,stop:this._proxyStopDrag,cancel:".portal",scroll:!0,scrollSensitivity:10}),(i instanceof e.Behaviour||i instanceof e.Link)&&i.on("edited",this.onItemEdited,this),i.element.on("mouseup",this._upProxy),i},i.prototype.removeChild=function(t){(i instanceof e.Behaviour||i instanceof e.Link)&&i.off("edited",this.onItemEdited,this);var i=n.prototype.removeChild.call(this,t);return i&&i.element.off("mouseup",this._upProxy),i},i.prototype.onChildMoving=function(e,t){for(var n=jQuery(e.target).data("component"),i=n.portals.length,i=0,o=n.portals.length;o>i;i++)n.portals[i].updateAllLinks();this.checkDimensions()},i.prototype.open=function(e){},i.prototype.tokenize=function(e,t){for(var n=t||this.children,i={items:[],properties:this._container.properties.tokenize(e)},o=0,r=n.length;r>o;o++)i.items.push(n[o].tokenize(e));return i},i.prototype.deTokenize=function(t,n){void 0===n&&(n=!0),t=t||this._container.entry.json,n&&t&&(this._loadingScene=!0);var i=this.children;if(n)for(;i.length>0;)i[0].dispose();for(var o={},r=[],s=0,a=t.items.length;a>s;s++){var l=e.Utils.createItem(this,t.items[s]);l?(l.deTokenize(t.items[s]),r.push(t.items[s].shallowId),o[t.items[s].shallowId]={item:l,token:t.items[s]}):e.Logger.logMessage("Could not create canvas item",null,e.LogType.ERROR)}for(var s=0,a=r.length;a>s;s++)o[r[s]].item.link(r[s],o);this.checkDimensions(),this.buildSceneReferences(),this._loadingScene=!1},i.prototype.checkDimensions=function(){for(var e=0,t=0,n=this.children.length,i=null;n--;){i=this.children[n];var o=i.element.css("left"),r=o.split("px"),s=parseFloat(r[0])+i.element.width()+5,a=i.element.css("top"),l=a.split("px"),h=parseFloat(l[0])+i.element.height()+5;s>e&&(e=s),h>t&&(t=h)}var c=this.element.css("min-width"),u=c.split("px"),p=parseFloat(u[0]),d=this.element.css("min-height"),m=d.split("px"),f=parseFloat(m[0]);this.element.css({"min-width":(e>p?e:p).toString()+"px","min-height":(t>f?t:f).toString()+"px"})},Object.defineProperty(i.prototype,"container",{get:function(){return this._container},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"containerReferences",{get:function(){return this._containerReferences},enumerable:!0,configurable:!0}),i.lastSelectedItem=null,i.snapping=!1,i}(e.Component);e.Canvas=n}(Animate||(Animate={}));var Animate;!function(e){var t=function(t){function n(n){t.call(this,"<canvas class='link' style='pointer-events:none'></canvas>",n),this.startPortal=null,this.endPortal=null,this._mouseMoveProxy=this.onMouseMove.bind(this),this._mouseUpProxy=this.onMouseUpAnchor.bind(this),this._mouseUpAnchorProxy=this.onMouseUpAnchor.bind(this),this._prevPortal=null,this._canvas=document.getElementById(this.id),this._graphics=this._canvas.getContext("2d"),this._graphics.font="14px arial",this._linePoints=[],this._selected=!1,this._properties=new e.EditableSet(this),this._properties.addVar(new e.PropNum("Frame Delay",1,0,Number.MAX_VALUE,0,1)),this.on("edited",this.onEdit,this)}return __extends(n,t),n.prototype.tokenize=function(n){void 0===n&&(n=!1);var i=t.prototype.tokenize.call(this,n);return i.endBehaviour=this._endBehaviour.shallowId,i.startBehaviour=this._startBehaviour.shallowId,i.endPortal=this.endPortal.property.name,i.startPortal=this.startPortal.property.name,i.frameDelay=this._properties.getVar("Frame Delay").getVal(),i.type=e.CanvasItemType.Link,i},n.prototype.deTokenize=function(e){t.prototype.deTokenize.call(this,e),this._properties.getVar("Frame Delay").setVal(e.frameDelay)},n.prototype.link=function(e,t){var n=t[e].token;return t[n.endBehaviour]&&t[n.startBehaviour]?(this._endBehaviour=t[n.endBehaviour].item,this._startBehaviour=t[n.startBehaviour].item,this.endPortal=this._endBehaviour.getPortal(n.endPortal),this.startPortal=this._startBehaviour.getPortal(n.startPortal),this.endPortal.addLink(this),this.startPortal.addLink(this),this.element.css("pointer-events",""),void this.updatePoints()):void this.dispose()},n.prototype.start=function(t,n){this.startPortal=t,this.parent.element.on("mousemove",this._mouseMoveProxy),this.parent.element.on("mouseup",this._mouseUpProxy),jQuery(".portal",this.parent.element).on("mouseup",this._mouseUpAnchorProxy);var i=t.positionOnCanvas();this._startClientX=n.clientX,this._startClientY=n.clientY,this.delta=t.element.width()/2,this._startX=i.left+this.delta,this._startY=i.top+this.delta,this.element.css({left:this._startX+"px",top:this._startY+"px"}),this.startPortal.type==e.PortalType.PRODUCT?jQuery(".parameter").addClass("green-glow"):this.startPortal.type==e.PortalType.OUTPUT&&jQuery(".input").addClass("green-glow"),this.onMouseMove(n)},n.prototype.hitTestPoint=function(t){for(var n=e.Utils.getMousePos(t,this.id),i=this._graphics.getImageData(n.x-4,n.y-4,8,8),o=(4*(n.x+n.y*i.width),0);o<i.data.length;o++)if(i.data[o]>0)return!0;return!1},Object.defineProperty(n.prototype,"selected",{get:function(){return this._selected},set:function(e){this._selected!==e&&(e?this.element.data("selected",!0):this.element.data("selected",!1),this._selected=e,this.updatePoints())},enumerable:!0,configurable:!0}),n.prototype.buildDimensions=function(){for(var e=this._linePoints,t=this._canvas,n=e.length,i=99999,o=99999,r=0,s=0,a=0;n>a;a++){var l=e[a].x,h=e[a].y;i>l?i=l:l>r&&(r=l),o>h?o=h:h>s&&(s=h)}var c=r-i+4+20,u=s-o+4+20;4>=c&&(c=24),4>=u&&(u=24),t.width=c,t.height=u,this.element.css({left:i-5+"px",top:o-5+"px",width:c+"px",height:u+"px"});for(var a=0;n>a;a++){var p=e[a];p.x=p.x-i+5,p.y=p.y-o+5}},n.prototype.buildLinePoints=function(t){var n=this._linePoints;n.splice(0,n.length);var i=this.startPortal.positionOnCanvas();this.delta=this.startPortal.element.width()/2;var o=this.delta;this._startX=i.left+this.delta,this._startY=i.top+this.delta;var r=(this.parent.element.offset(),this._startX),s=this._startY,a=0,l=0;if(null!=this.endPortal){var h=this.endPortal.positionOnCanvas();a=h.left+o,l=h.top+o}else{if(null==t)return;var c=2;a=r+t.clientX-this._startClientX+c,l=s+t.clientY-this._startClientY+c}if(null!=this.endPortal)if(this.startPortal.behaviour==this.endPortal.behaviour&&this.startPortal!=this.endPortal){n.push({x:r,y:s}),this.startPortal.type==e.PortalType.OUTPUT?n.push({x:r+10,y:s}):n.push({x:r,y:s+20});var u=parseFloat(this.endPortal.behaviour.element.css("left").split("px")[0]),p=parseFloat(this.endPortal.behaviour.element.css("top").split("px")[0]),d=this.endPortal.behaviour.element.width();this.endPortal.behaviour.element.height();this.startPortal.type==e.PortalType.PRODUCT&&n.push({x:u+d+20,y:s+20}),n.push({x:u+d+20,y:s}),n.push({x:u+d+20,y:p-20}),this.endPortal.type==e.PortalType.INPUT&&(n.push({x:u-20,y:p-20}),n.push({x:u-20,y:l})),(this.endPortal.type==e.PortalType.PARAMETER||this.endPortal.type==e.PortalType.INPUT)&&(this.endPortal.type==e.PortalType.INPUT?n.push({x:a-10,y:l}):n.push({x:a,y:l-10}))}else(this.endPortal.type==e.PortalType.PARAMETER||this.endPortal.type==e.PortalType.INPUT)&&(n.push({x:r,y:s}),this.startPortal.type==e.PortalType.OUTPUT?n.push({x:r+20,y:s}):n.push({x:r,y:s+30}),this.endPortal.type==e.PortalType.INPUT?n.push({x:a-20,y:l}):n.push({x:a,y:l-20}));else n.push({x:r,y:s}),this.startPortal.type==e.PortalType.OUTPUT?n.push({x:r+20,y:s}):n.push({x:r,y:s+30}),n.push({x:a-20,y:l});n.push({x:a,y:l})},n.prototype.updatePoints=function(){this.buildLinePoints(null),this.buildDimensions();var e=this._graphics;e.clearRect(0,0,this._canvas.width,this._canvas.height),this.draw()},n.prototype.onMouseMove=function(e){var t=this._curTarget;null!=t&&t.element.css("cursor","");var n=jQuery(e.target);this.endPortal=null,n.hasClass("portal")?(this._curTarget=n.data("component"),t=this._curTarget,this.endPortal=t,t.checkPortalLink(this.startPortal)?t.element.css("cursor",""):t.element.css("cursor","no-drop")):(n.css("cursor","crosshair"),this._curTarget=n.data("component")),this.buildLinePoints(e),this.buildDimensions();var i=this._graphics;i.clearRect(0,0,this._canvas.width,this._canvas.height),this.draw()},n.prototype.draw=function(){var t=this._linePoints,n=t.length;if(0!=n){var i=null,o=null,r=null,s=this._graphics,a=this.element,l=this.startPortal,h=this.endPortal,c=l.behaviour,u=h?h.behaviour:null,p=!1;s.lineCap="round",s.lineJoin="round",l.type!=e.PortalType.OUTPUT&&void 0!==s.setLineDash&&s.setLineDash([5]),s.beginPath(),h&&c==u&&l!=h&&(p=!0);for(var d=1;n>d;d++){o={x:t[d-1].x,y:t[d-1].y},r={x:t[d].x,y:t[d].y};var m={x:o.x+.5*(r.x-o.x),y:o.y+(r.y-o.y)/2};p?(s.moveTo(o.x,o.y),s.lineTo(r.x,r.y)):i?(s.moveTo(i.x,i.y),p?s.lineTo(o.x,o.y):s.quadraticCurveTo(o.x,o.y,m.x,m.y)):(s.moveTo(o.x,o.y),s.lineTo(m.x,m.y)),i=m}if(r&&s.lineTo(r.x,r.y-1),l.type==e.PortalType.OUTPUT){s.lineWidth=3,a.data("selected")?s.strokeStyle="#FF0000":s.strokeStyle="#9D5BAF",s.stroke();var f=this._canvas,v=this._properties.getVar("Frame Delay").getVal(),g=0,y=0;p?(g=.5*f.width-5,y=8):(g=.5*f.width-5,y=.5*f.height+3),s.lineWidth=5,s.strokeStyle="#ffffff",s.strokeText(v.toString(),g,y),s.fillText(v.toString(),g,y)}else s.lineWidth=2,a.data("selected")?s.strokeStyle="#FF0000":s.strokeStyle="#E2B31F",s.stroke()}},n.prototype.onMouseUpAnchor=function(t){this._curTarget&&this._curTarget.element.css("cursor",""),this.parent.element.css("cursor",""),this.startPortal.element.css("cursor",""),this.startPortal.type==e.PortalType.PRODUCT?jQuery(".parameter").removeClass("green-glow"):this.startPortal.type==e.PortalType.OUTPUT&&jQuery(".input").removeClass("green-glow");var n=jQuery(t.target);n.hasClass("portal")?(this._curTarget=n.data("component"),this._curTarget.type==e.PortalType.PRODUCT||this._curTarget.type==e.PortalType.OUTPUT?this.dispose():this.startPortal.type==e.PortalType.OUTPUT&&this._curTarget.type==e.PortalType.INPUT||this.startPortal.type==e.PortalType.PRODUCT&&this._curTarget.type==e.PortalType.PARAMETER?(this._curTarget.checkPortalLink(this.startPortal)&&(this.parent.element.off("mousemove",this._mouseMoveProxy),this.parent.element.off("mouseup"),jQuery(".portal",this.parent.element).off("mouseup",this._mouseUpAnchorProxy),this.endPortal=this._curTarget,this.startPortal.addLink(this),this.endPortal.addLink(this),this._endBehaviour=this.endPortal.behaviour,this._startBehaviour=this.startPortal.behaviour,this.element.css("pointer-events",""),this.parent.emit(new e.CanvasEvent(e.CanvasEvents.MODIFIED,this.parent))),this._curTarget.element.css("cursor","")):this.dispose()):this.dispose(),this._curTarget=null},n.prototype.onEdit=function(e,t,n){this.draw()},Object.defineProperty(n.prototype,"properties",{get:function(){return this._properties},enumerable:!0,configurable:!0}),n.prototype.dispose=function(){this.startPortal&&this.startPortal instanceof e.Portal&&this.startPortal.removeLink(this),this.endPortal&&this.endPortal instanceof e.Portal&&this.endPortal.removeLink(this),this.off("edited",this.onEdit,this),this.parent.element.off("mousemove",this._mouseMoveProxy),this.parent.element.off("mouseup"),jQuery(".portal",this.parent.element).off("mouseup",this._mouseUpAnchorProxy),this.element.off(),this.startPortal=null,this.endPortal=null,this._mouseMoveProxy=null,this._mouseUpProxy=null,this._mouseUpAnchorProxy=null,this._prevPortal=null,this._canvas=null,this._graphics=null,this._linePoints=null,this._curTarget=null,this._properties=null,this._endBehaviour=null,this._startBehaviour=null,t.prototype.dispose.call(this)},n}(e.CanvasItem);e.Link=t}(Animate||(Animate={}));var Animate;!function(e){var t=function(t){function n(){t.call(this),this.mDel=this.addItem(new e.ContextMenuItem("Delete","media/cross.png")),this.mCreate=this.addItem(new e.ContextMenuItem("Create Behaviour","media/behavior_20.png")),this.mCreateComment=this.addItem(new e.ContextMenuItem("Create Comment","media/comment.png")),this.mCreateInput=this.addItem(new e.ContextMenuItem("Create Input","media/portal.png")),this.mCreateOutput=this.addItem(new e.ContextMenuItem("Create Output","media/portal.png")),this.mCreateParam=this.addItem(new e.ContextMenuItem("Create Parameter","media/portal.png")),this.mCreateProduct=this.addItem(new e.ContextMenuItem("Create Product","media/portal.png")),this.mEditPortal=this.addItem(new e.ContextMenuItem("Edit Portal","media/portal.png")),this.mDelEmpty=this.addItem(new e.ContextMenuItem("Remove Empty Assets","media/cross.png"))}return __extends(n,t),n.prototype.showContext=function(n,i,o){if(this.mCreateInput.element.show(),this.mCreateOutput.element.show(),this.mCreateParam.element.show(),this.mCreateProduct.element.show(),this.mEditPortal.element.hide(),this.mDelEmpty.element.hide(),null==o)this.mDel.element.hide(),this.mCreate.element.show(),this.mCreateComment.element.show(),this.mDelEmpty.element.show();else if(o instanceof e.Portal){if(this.mCreateInput.element.hide(),this.mCreateOutput.element.hide(),this.mCreateParam.element.hide(),this.mCreateProduct.element.hide(),this.mDel.element.hide(),!o.customPortal)return;this.mEditPortal.element.show(),this.mDel.element.show(),this.mCreate.element.hide(),this.mCreateComment.element.hide()}else if((o instanceof e.Behaviour||o instanceof e.BehaviourPortal)&&(this.mDel.element.show(),this.mCreate.element.hide(),this.mCreateComment.element.hide(),this.mCreateInput.element.hide(),this.mCreateOutput.element.hide(),this.mCreateParam.element.hide(),this.mCreateProduct.element.hide(),o instanceof e.BehaviourPortal==0)){var r=e.PluginManager.getSingleton().getTemplate(o.originalName);r&&(r.canBuildOutput(o)&&this.mCreateOutput.element.show(),r.canBuildInput(o)&&this.mCreateInput.element.show(),r.canBuildParameter(o)&&this.mCreateParam.element.show(),r.canBuildProduct(o)&&this.mCreateProduct.element.show())}t.prototype.show.call(this,null,n,i,!1,!0)},n}(e.ContextMenu);e.CanvasContext=t}(Animate||(Animate={}));var Animate;!function(e){var t=function(t){function n(i){if(t.call(this,i),null!=n._singleton)throw new Error("The TreeViewScene class is a singleton. You need to call the TreeViewScene.getSingleton() function.");n._singleton=this,this.element.addClass("treeview-scene"),this._sceneNode=this.addNode(new e.TreeNode("Scene","media/world_16.png")),this._assetsNode=this.addNode(new e.TreeNode("Assets","media/wrench.png")),this._groupsNode=this.addNode(new e.TreeNode("Groups","media/array.png")),this._pluginBehaviours=this.addNode(new e.TreeNode("Behaviours","media/behavior_20.png")),this._sceneNode.canUpdate=!0,this._groupsNode.canUpdate=!0,this._contextMenu=new e.ContextMenu,this._contextCopy=this._contextMenu.addItem(new e.ContextMenuItem("Copy","media/copy-small.png")),this._contextDel=this._contextMenu.addItem(new e.ContextMenuItem("Delete","media/cross.png")),this._contextAddInstance=this._contextMenu.addItem(new e.ContextMenuItem("Add Instance","media/portal.png")),this._contextSave=this._contextMenu.addItem(new e.ContextMenuItem("Save","media/save-20.png")),this._contextRefresh=this._contextMenu.addItem(new e.ContextMenuItem("Update","media/refresh.png")),this._contextAddGroup=this._contextMenu.addItem(new e.ContextMenuItem("Add Group","media/array.png")),this._contextMenu.on(e.ContextMenuEvents.ITEM_CLICKED,this.onContextSelect,this),jQuery(document).on("contextmenu",this.onContext.bind(this)),jQuery(".selectable .text",this._sceneNode.element).addClass("top-node"),jQuery(".selectable .text",this._assetsNode.element).addClass("top-node"),jQuery(".selectable .text",this._groupsNode.element).addClass("top-node"),jQuery(".selectable .text",this._pluginBehaviours.element).addClass("top-node"),this._quickAdd=new e.Component("<div class='quick-button'><img src='media/portal.png'/></div>",this),this._quickCopy=new e.Component("<div class='quick-button'><img src='media/copy-small.png'/></div>",this),this._quickAdd.tooltip="Add new instance",this._quickCopy.tooltip="Copy instance",this._contextNode=null,this._shortcutProxy=this.onShortcutClick.bind(this),jQuery("body").on("keydown",this.onKeyDown.bind(this)),this.element.on("dblclick",this.onDblClick.bind(this)),this.element.on("mousemove",this.onMouseMove.bind(this)),this._quickAdd.element.detach(),this._quickCopy.element.detach(),e.RenameForm.get.on("renaming",this.onRenameCheck,this)}return __extends(n,t),n.prototype.onShortcutClick=function(t){var n=jQuery(t.currentTarget).data("component"),i=n.element.parent().parent().parent().data("component");this.selectedNode=i,this._contextNode=i,n==this._quickAdd?this.onContextSelect(e.ContextMenuEvents.ITEM_CLICKED,new e.ContextMenuEvent(this._contextAddInstance,e.ContextMenuEvents.ITEM_CLICKED)):this.onContextSelect(e.ContextMenuEvents.ITEM_CLICKED,new e.ContextMenuEvent(this._contextCopy,e.ContextMenuEvents.ITEM_CLICKED))},n.prototype.onMouseMove=function(t){if(!jQuery(t.target).hasClass("quick-button")){var n=jQuery(t.target).parent().data("component");this._quickAdd.element.off("click",this._shortcutProxy),this._quickCopy.element.off("click",this._shortcutProxy),this._quickAdd.element.detach(),this._quickCopy.element.detach(),n&&n instanceof e.TreeNode&&(n instanceof e.TreeNodeAssetInstance?(jQuery(".text:first",n.element).append(this._quickCopy.element),this._quickCopy.element.on("click",this._shortcutProxy)):n instanceof e.TreeNodeAssetClass&&!n.assetClass.abstractClass&&(jQuery(".text:first",n.element).append(this._quickAdd.element),this._quickAdd.element.on("click",this._shortcutProxy)))}},n.prototype.projectReady=function(t){t.on("resource-created",this.onResourceCreated,this);for(var n,i=e.PluginManager.getSingleton().assetTemplates,o=i.length,r=0;o>r;r++)for(var s=0;s<i[r].classes.length;s++){n=i[r].classes[s];var a=new e.TreeNodeAssetClass(n,this);this._assetsNode.addNode(a)}},n.prototype.onResourceCreated=function(t,n){var i=n.resource;i instanceof e.Asset?this.addAssetInstance(i,!1):i instanceof e.Container?this._sceneNode.addNode(new e.TreeNodeBehaviour(i)):i instanceof e.GroupArray&&this._groupsNode.addNode(new e.TreeNodeGroup(i))},n.prototype.projectReset=function(e){e.off("resource-created",this.onResourceCreated,this),this.children[0].clear(),this.children[1].clear(),this._groupsNode.clear()},n.prototype.onKeyDown=function(t){if(null!=e.Application.getInstance().focusObj&&e.Application.getInstance().focusObj instanceof e.TreeNode&&0==jQuery(t.target).is("input")&&113==t.keyCode){var n,i=this.selectedNode;null!=i&&(i instanceof e.TreeNodeGroup?n=e.RenameForm.get.renameObject(i.resource.entry,i.resource.entry._id,e.ResourceType.GROUP):i instanceof e.TreeNodeBehaviour?n=e.RenameForm.get.renameObject(i.resource.entry,i.resource.entry._id,e.ResourceType.CONTAINER):i instanceof e.TreeNodeAssetInstance&&(n=e.RenameForm.get.renameObject(i.resource.entry,i.resource.entry._id,e.ResourceType.ASSET)),n&&(i.loading=!0,n.then(function(t){t.cancelled||(i.loading=!1,i.text=t.newName,i instanceof e.TreeNodeAssetInstance&&e.PluginManager.getSingleton().emit(new e.AssetRenamedEvent(i.resource,t.oldName)))})))}},n.prototype.addAssetInstance=function(t,n){void 0===n&&(n=!0);var i=this.findNode("className",t.entry.className);if(null!=i){var o=new e.TreeNodeAssetInstance(i.assetClass,t);return i.addNode(o,n),o.element.draggable({opacity:.7,helper:"clone",appendTo:"body",containment:"body"}),!0}return!1},n.prototype.onContextSelect=function(t,n,i){for(var o,r=e.User.get.project,s=this._contextNode,a=n.item.text,l=[],h=this.selectedNodes.length;h--;)l.push(this.selectedNodes[h]);if(s){var c=function(t,n){t.then(function(){n.loading=!1})["catch"](function(t){n.loading=!1,e.Logger.logMessage(t.message,null,e.LogType.ERROR)})};switch(a){case"Delete":this._quickAdd.element.off("click",this._shortcutProxy),this._quickCopy.element.off("click",this._shortcutProxy),this._quickAdd.element.detach(),this._quickCopy.element.detach(),l.forEach(function(t,n){t.loading=!0,t instanceof e.TreeNodeResource?c(r.deleteResources([t.resource.entry._id]),t):t.dispose()});break;case"Copy":s instanceof e.TreeNodeAssetInstance&&(s.loading=!0,c(r.copyResource(s.resource.entry._id,e.ResourceType.ASSET),s));break;case"Add Instance":s instanceof e.TreeNodeAssetClass&&r.createResource(e.ResourceType.ASSET,{name:"New "+s.assetClass.name,className:s.assetClass.name});break;case"Save":l.forEach(function(t,n){t.loading=!0,t instanceof e.TreeNodeResource&&c(r.saveResource(t.resource.entry._id),t)});break;case"Add Group":s.loading=!0,o=r.createResource(e.ResourceType.GROUP,{name:"New Group"}).then(function(){s.loading=!1})["catch"](function(t){s.loading=!1,e.Logger.logMessage(t.message,null,e.LogType.ERROR)});break;case"Update":if(s==this._sceneNode||s==this._groupsNode){s.loading=!0;for(var u=(s==this._sceneNode?e.ResourceType.CONTAINER:e.ResourceType.GROUP,!1),h=0,p=s.nodes.length;p>h;h++)if(s.nodes[h].modified){u=!0,e.MessageBox.show("You have unsaved work are you sure you want to refresh?",["Yes","No"],function(t){"Yes"==t?c(r.loadResources(e.ResourceType.CONTAINER),s):s.loading=!0});break}u||c(r.loadResources(e.ResourceType.CONTAINER),s)}else if(s instanceof e.TreeNodeAssetClass){var d=s.getAllNodes(s.constructor);d.forEach(function(e,t){e.loading=!0,c(r.refreshResource(d[h].resource.entry._id),e)})}else if(s instanceof e.TreeNodeResource){if(s.loading=!0,s.modified){e.MessageBox.show("You have unsaved work are you sure you want to refresh?",["Yes","No"],function(e){"Yes"==e?c(r.refreshResource(s.resource.entry._id),s):s.loading=!1});break}c(r.refreshResource(s.resource.entry._id),s)}}}},n.prototype.onDblClick=function(t){if(this.selectedNode instanceof e.TreeNodeBehaviour){var n=e.CanvasTab.getSingleton().getTab(this.selectedNode.text);if(null==n&&(n=e.CanvasTab.getSingleton().getTab("*"+this.selectedNode.text)),n)e.CanvasTab.getSingleton().selectTab(n);else{var n=e.CanvasTab.getSingleton().addSpecialTab(this.selectedNode.text,e.CanvasTabType.CANVAS,this.selectedNode.resource),i=n.canvas;i.deTokenize(),i.checkDimensions(),e.CanvasTab.getSingleton().selectTab(n)}}},n.prototype.onRenameCheck=function(t,n,i){var o=e.User.get.project,r=o.containers.length;if(n.resourceType==e.ResourceType.CONTAINER)for(var s=0;r>s;s++)if(o.containers[s].entry.name==n.name)return void(n.reason="A behaviour with the name '"+n.name+"' already exists, please choose another.");n.cancel=!1},n.prototype.getAssets=function(t){for(var n=this._assetsNode.children.length,i=new Array;n--;)if(this._assetsNode.children[n]instanceof e.TreeNodeAssetClass){var o=this._assetsNode.children[n].getInstances(t);
if(null!=o)for(var r=0;r<o.length;r++)i.push(o[r])}return i},n.prototype.getAssetClasses=function(){for(var t=this._assetsNode.children.length,n=new Array,i=0;t>i;i++)if(this._assetsNode.children[i]instanceof e.TreeNodeAssetClass){n.push(this._assetsNode.children[i].assetClass);var o=this._assetsNode.children[i].getClasses();if(null!=o)for(var r=0;r<o.length;r++)n.push(o[r])}return n},n.prototype.onContext=function(t){var n=jQuery(t.target).parent();if(null!=n){var i=n.data("component");i instanceof e.TreeNode&&(i.canDelete?this._contextDel.element.show():this._contextDel.element.hide(),i.canCopy&&1==this.selectedNodes.length?this._contextCopy.element.show():this._contextCopy.element.hide(),i.canUpdate?this._contextRefresh.element.show():this._contextRefresh.element.hide(),i.modified?this._contextSave.element.show():this._contextSave.element.hide(),i==this._groupsNode?this._contextAddGroup.element.show():this._contextAddGroup.element.hide(),i instanceof e.TreeNodeAssetClass&&0==i.assetClass.abstractClass?this._contextAddInstance.element.show():this._contextAddInstance.element.hide(),this._contextNode=i,t.preventDefault(),this._contextMenu.show(e.Application.getInstance(),t.pageX,t.pageY,!1,!0))}},n.prototype.selectNode=function(n,i,o){if(void 0===i&&(i=!1),void 0===o&&(o=!1),this.enabled){var r=!1;if(o){for(var s=[],a=this.selectedNodes.length;a--;)s.push(this.selectedNodes[a]);for(s.push(n),a=s.length;a--;){for(var l=s.length;l--;)if(s[a].constructor.name!=s[l].constructor.name&&s[a]!=s[l]){r=!0;break}if(r)break}r&&(o=!1)}t.prototype.selectNode.call(this,n,i,o),null==n&&e.PluginManager.getSingleton().emit(new e.AssetEvent(e.EditorEvents.ASSET_SELECTED,null))}},n.getSingleton=function(){return n._singleton||new n,n._singleton},n.prototype.addPluginBehaviour=function(t){var n=new e.TreeNodePluginBehaviour(t);return this._pluginBehaviours.addNode(n),n},n.prototype.removePluginBehaviour=function(e,t){void 0===t&&(t=!0);var n=this._pluginBehaviours.findNode("mText",e);return null!=n&&(this._pluginBehaviours.removeNode(n),t&&n.dispose()),n},Object.defineProperty(n.prototype,"sceneNode",{get:function(){return this._sceneNode},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"assetsNode",{get:function(){return this._assetsNode},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"groupsNode",{get:function(){return this._groupsNode},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"pluginBehaviours",{get:function(){return this._pluginBehaviours},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"contextNode",{get:function(){return this._contextNode},set:function(e){this._contextNode=e},enumerable:!0,configurable:!0}),n}(e.TreeView);e.TreeViewScene=t}(Animate||(Animate={}));var Animate;!function(e){var t=function(t){function n(e,n,i){void 0===n&&(n=null),void 0===i&&(i=!0),n=null!=n&&""!=n?"<img src='"+n+"' />":"",this.mText=e,this._expanded=!1,this.hasExpandButton=i,this._modified=!1,this._loading=!1,this._modifiedStar=jQuery("<span>*</span>"),t.call(this,"<div class='tree-node'><div class='selectable'>"+(this.hasExpandButton?"<div class='tree-node-button'>+</div>":"")+n+"<div class='buffering'><img src='media/buffering-gray.png' class='rotate-360 gray' /><img src='media/buffering-white.png' class='rotate-360 white' /></div><span class='text'>"+this.mText+"</span><div class='fix'></div></div></div>",null),this.element.disableSelection(!0),jQuery(".tree-node-button",this.element).first().css("visibility","hidden"),this.treeview=null,this.canDelete=!1,this.canFocus=!0,this.canCopy=!1}return __extends(n,t),Object.defineProperty(n.prototype,"modified",{get:function(){return this._modified},set:function(e){this._modified=e,e?this._modifiedStar.insertBefore(jQuery(".text:first",this.element)):this._modifiedStar.detach()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"loading",{get:function(){return this._loading},set:function(e){this._loading=e,e?jQuery(".buffering:first",this.element).css("display","inline-block"):jQuery(".buffering:first",this.element).css("display","none")},enumerable:!0,configurable:!0}),n.prototype.dispose=function(){this._modifiedStar.remove(),this.treeview&&(-1!=this.treeview.selectedNodes.indexOf(this)&&this.treeview.selectedNodes.splice(this.treeview.selectedNodes.indexOf(this),1),this.treeview.selectedNode==this&&(this.treeview.selectedNode=null)),this._modifiedStar=null,this.mText=null,this._expanded=null,this.hasExpandButton=null,this.treeview=null,this.canDelete=null,t.prototype.dispose.call(this)},n.prototype.onSelect=function(){},n.prototype.getAllNodes=function(e,t){void 0===t&&(t=null);var n=null;n=t?t:[];for(var i=this.children,o=i.length,r=0;o>r;r++)i[r].getAllNodes(e,n),null==e?n.push(i[r]):i[r]instanceof e&&n.push(i[r]);return n},n.prototype.expand=function(){if(0!=this.hasExpandButton){for(var e=this.children,t=e.length,n=0;t>n;n++)e[n].element.show();jQuery(".tree-node-button",this.element).first().text("-"),this._expanded=!0}},n.prototype.collapse=function(){if(0!=this.hasExpandButton){for(var e=this.children,t=e.length,n=0;t>n;n++)e[n].element.hide();jQuery(".tree-node-button",this.element).first().text("+"),this._expanded=!1}},n.prototype.findNode=function(e,t){if(this[e]==t)return this;for(var i=this.children,o=i.length,r=0;o>r;r++)if(i[r]instanceof n!=0){var s=i[r].findNode(e,t);if(null!=s)return s}},n.prototype.clear=function(){for(var e=this.children;e.length>0;)e[0].treeview&&-1!=e[0].treeview.selectedNodes.indexOf(e[0])&&e[0].treeview.selectedNodes.splice(e[0].treeview.selectedNodes.indexOf(e[0]),1),e[0].dispose()},Object.defineProperty(n.prototype,"selected",{get:function(){return this.element.hasClass("selected")?!0:!1},set:function(e){e?jQuery(" > .selectable",this.element).addClass("selected").addClass("reg-gradient"):jQuery(" > .selectable",this.element).removeClass("selected").removeClass("reg-gradient")},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"text",{get:function(){return this.mText},set:function(e){this.mText=e,jQuery(".text:first",this.element).text(this.mText)},enumerable:!0,configurable:!0}),n.prototype.addNode=function(t,n){t.treeview=this.treeview;var i=e.Component.prototype.addChild.call(this,t);return void 0!==n?n?this.collapse():this.expand():this._expanded||1!=this.children.length?this._expanded||i.element.hide():this.expand(),jQuery(".tree-node-button",this.element).first().css("visibility",""),i},Object.defineProperty(n.prototype,"nodes",{get:function(){return this.children},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"expanded",{get:function(){return this._expanded},enumerable:!0,configurable:!0}),n.prototype.removeChild=function(e){var n=t.prototype.removeChild.call(this,e);return 0==this.nodes.length&&jQuery(".tree-node-button",this.element).first().css("visibility","hidden"),n},n.prototype.removeNode=function(e){-1!=this.treeview.selectedNodes.indexOf(e)&&this.treeview.selectedNodes.splice(this.treeview.selectedNodes.indexOf(e),1),this.treeview.selectedNode==e&&(this.treeview.selectedNode=null),e.treeview=null;var t=this.removeChild(e);return t},Object.defineProperty(n.prototype,"name",{get:function(){return this.mText},enumerable:!0,configurable:!0}),n}(e.Component);e.TreeNode=t}(Animate||(Animate={}));var Animate;!function(e){var t=function(e){function t(t,n,i,o){e.call(this,n,i,o),this.resource=t,this.canDelete=!0,this.canUpdate=!0,this._dropProxy=this.onDropped.bind(this),this.element.draggable({opacity:.7,helper:"clone",appendTo:"body",containment:"body"}),this.element.droppable({drop:this._dropProxy,accept:".tree-node-asset,.tree-node-group"}),t.on("modified",this.onModified,this),t.on("deleted",this.onDeleted,this),t.on("refreshed",this.onRefreshed,this)}return __extends(t,e),t.prototype.onRefreshed=function(e,t,n){this.text=this.resource.entry.name},t.prototype.onDeleted=function(e,t,n){this.dispose()},t.prototype.onModified=function(e,t,n){this.modified=!this.resource.saved},t.prototype.onDropped=function(e,t){jQuery(t.draggable).data("component")},t.prototype.dispose=function(){this.resource.on("refreshed",this.onRefreshed,this),this.resource.off("modified",this.onModified,this),this.resource.on("deleted",this.onDeleted,this),this.element.draggable("destroy"),this.element.droppable("destroy"),e.prototype.dispose.call(this),this._dropProxy=null,this.resource=null},t}(e.TreeNode);e.TreeNodeResource=t}(Animate||(Animate={}));var Animate;!function(e){var t=function(t){function n(e,i){t.call(this,e.name,e.imgURL,!0),this.canDelete=!1,this.assetClass=e,this.treeview=i,this.className=e.name,this.canUpdate=!0;for(var o=0;o<e.classes.length;o++){var r=e.classes[o],s=new n(r,i);this.addNode(s)}}return __extends(n,t),n.prototype.getInstances=function(t){var i,o=null,r=this.children;i=t?"string"==typeof t?[t]:t:[null],o=[];for(var s=0,a=i.length;a>s;s++)if(null==i[s]||i[s]==this.assetClass.name||""==i[s]){for(var l=r.length,s=0;l>s;s++)if(r[s]instanceof e.TreeNodeAssetInstance)o.push(r[s]);else if(r[s]instanceof n){var h=r[s].getInstances(null);if(null!=h)for(var c=0;c<h.length;c++)o.push(h[c])}}else for(var l=r.length,c=0;l>c;c++)if(r[c]instanceof n){var h=r[c].getInstances(i);if(null!=h)for(var u=0,p=h.length;p>u;u++)-1==o.indexOf(h[u])&&o.push(h[u])}return o},n.prototype.getClasses=function(){for(var e=[],t=this.children,i=this.children.length,o=0;i>o;o++)if(t[o]instanceof n){e.push(t[o].assetClass);var r=t[o].getClasses();if(null!=r)for(var s=0;s<r.length;s++)e.push(r[s])}return e},n.prototype.dispose=function(){this.canDelete=null,this.assetClass=null,this.treeview=null,this.className=null,t.prototype.dispose.call(this)},n}(e.TreeNode);e.TreeNodeAssetClass=t}(Animate||(Animate={}));var Animate;!function(e){var t=function(t){function n(e,n){t.call(this,n,""==jQuery.trim(n.entry.name)?"New "+e.name:n.entry.name,"media/variable.png",!1),this.canCopy=!0,this.canUpdate=!0,this.assetClass=e,this.element.addClass("behaviour-to-canvas"),this.element.addClass("tree-node-asset"),n.on("edited",this.onAssetEdited,this)}return __extends(n,t),n.prototype.onSelect=function(){e.PropertyGrid.getSingleton().editableObject(this.resource.properties,this.text+"  ["+this.resource.entry.shallowId+"]","media/variable.png"),e.PluginManager.getSingleton().emit(new e.AssetEvent(e.EditorEvents.ASSET_SELECTED,this.resource))},n.prototype.onAssetEdited=function(e,t,n){this.resource.saved=!1},n.prototype.dispose=function(){this.resource.off("edited",this.onAssetEdited,this),this.assetClass=null,t.prototype.dispose.call(this)},n}(e.TreeNodeResource);e.TreeNodeAssetInstance=t}(Animate||(Animate={}));var Animate;!function(e){var t=function(t){function n(e){t.call(this,e,e.entry.name,"media/variable.png",!1),this.element.addClass("behaviour-to-canvas"),e.on("edited",this.onPropertyGridEdited,this)}return __extends(n,t),n.prototype.onSelect=function(){e.PropertyGrid.getSingleton().editableObject(this.resource.properties,this.text,"media/variable.png")},n.prototype.onPropertyGridEdited=function(e,t,n){this.resource.saved=!1},n.prototype.dispose=function(){this.resource.off("edited",this.onPropertyGridEdited,this),t.prototype.dispose.call(this)},n}(e.TreeNodeResource);e.TreeNodeBehaviour=t}(Animate||(Animate={}));var Animate;!function(e){var t=function(t){function n(n){t.call(this,n,n.entry.name,"media/array.png",!0),this.element.addClass("tree-node-group");for(var i=e.User.get.project,o=0,r=n.entry.items,s=r.length;s>o;o++){var a=i.getResourceByShallowID(r[o]);this.addNode(new e.TreeNodeGroupInstance(a.entry._id,a.entry.name,n))}}return __extends(n,t),n.prototype.onRefreshed=function(n,i,o){for(t.prototype.onRefreshed.call(this,n,i,o);this.children.length>0;)this.children[0].dispose();for(var r=e.User.get.project,s=this.resource,a=0,l=s.entry.items,h=l.length;h>a;a++){var c=r.getResourceByShallowID(l[a]);this.addNode(new e.TreeNodeGroupInstance(c.entry._id,c.entry.name,s))}},n.prototype.onDropped=function(t,i){var o=jQuery(i.draggable).data("component");if(o instanceof e.TreeNodeAssetInstance||o instanceof n){var r,s=null;o instanceof e.TreeNodeAssetInstance?(r=o.resource.entry,s=this.addNode(new e.TreeNodeGroupInstance(r.shallowId,r.name,this.resource))):o instanceof n&&(r=o.resource.entry,s=this.addNode(new e.TreeNodeGroupInstance(r.shallowId,r.name,this.resource))),this.expand(),this.treeview.selectNode(s),this.resource.addReference(r.shallowId)}},n}(e.TreeNodeResource);e.TreeNodeGroup=t}(Animate||(Animate={}));var Animate;!function(e){var t=function(e){function t(t,n,i){e.call(this,n,"media/instance_ref.png",!1),this._group=i,this._instanceID=t,this.canDelete=!0}return __extends(t,e),t.prototype.dispose=function(){this._group.removeReference(this._instanceID),this._instanceID=null,this._group=null,e.prototype.dispose.call(this)},Object.defineProperty(t.prototype,"shallowId",{get:function(){return this._instanceID},enumerable:!0,configurable:!0}),t}(e.TreeNode);e.TreeNodeGroupInstance=t}(Animate||(Animate={}));var Animate;!function(e){var t=function(e){function t(t){e.call(this,t.behaviourName,"media/variable.png",!1),this._template=t,this.canDelete=!1,this.element.addClass("behaviour-to-canvas"),this.element.draggable({opacity:.7,helper:"clone",appendTo:"body",containment:"body"})}return __extends(t,e),t.prototype.dispose=function(){this._template.dispose(),this.template=null,this.canDelete=null,e.prototype.dispose.call(this)},Object.defineProperty(t.prototype,"template",{get:function(){return this._template},enumerable:!0,configurable:!0}),t}(e.TreeNode);e.TreeNodePluginBehaviour=t}(Animate||(Animate={}));var Animate;!function(e){var t=function(e){function t(t,n){e.call(this,null,null,n),this._canvas=t,this.forceClose=!1,this._canvas.container.on("refreshed",this.onRefreshed,this),this._canvas.container.on("modified",this.onContainerModified,this),this._canvas.container.on("deleted",this.onContainerDeleted,this)}return __extends(t,e),t.prototype.onRefreshed=function(e,t,n){this.text=n.entry.name},t.prototype.onContainerDeleted=function(e,t,n){this.forceClose=!0,this.tab.removeTab(this,!0),this.forceClose=!1},t.prototype.onContainerModified=function(e,t,n){this.modified=!this._canvas.container.saved},t.prototype.dispose=function(){this._canvas.container.off("refreshed",this.onRefreshed,this),this._canvas.container.off("modified",this.onContainerModified,this),this._canvas.container.off("deleted",this.onContainerDeleted,this),this._canvas=null,e.prototype.dispose.call(this)},Object.defineProperty(t.prototype,"canvas",{get:function(){return this._canvas},enumerable:!0,configurable:!0}),t}(e.TabPair);e.CanvasTabPair=t}(Animate||(Animate={}));var Animate;!function(e){var t=function(t){function n(e){t.call(this,null,null,e),this._originalName=e,this._proxyChange=jQuery.proxy(this.onChange,this),this._proxyMessageBox=jQuery.proxy(this.onMessage,this),this._loadingGif=jQuery("<img src='media/buffering-gray.png' class='rotate-360' />"),this._close=!1,this._editor=null}return __extends(n,t),n.prototype.onMessage=function(t){"Yes"==t?(this._close=!0,this.save()):(this.modified=!1,e.CanvasTab.getSingleton().removeTab(this,!0))},n.prototype.loading=function(e){e?jQuery(".text",this.tabSelector.element).prepend(this._loadingGif):this._loadingGif.detach()},n.prototype.onChange=function(e){this.modified=!0},n.prototype.onRemove=function(t){return this.modified?(t.cancel=!0,void e.MessageBox.show("Document not saved, would you like to save it now?",["Yes","No"],this._proxyMessageBox,this)):(this._editor.off("change",this._proxyChange),this._editor.destroy(),this._editor=null,this._proxyChange=null,this._proxyMessageBox=null,void(this._editor=null))},n.prototype.onResize=function(){this._editor.resize()},n.prototype.onAdded=function(){var t=new e.Component("<pre style='position:absolute; margin: 0; top: 0; bottom: 0; left: 0; right: 0;'></pre>",this.page),n=this,i=ace.edit(t.id),o=this.initialize();this._editor=i,i.setTheme("ace/theme/chrome"),i.getSession().setMode(o.contentType),i.setValue(o.content),i.selection.moveCursorFileStart(),i.commands.addCommand({name:"save",bindKey:{win:"Ctrl-S",mac:"Command-S",sender:"editor|cli"},exec:function(){n.save()}}),i.on("change",this._proxyChange)},Object.defineProperty(n.prototype,"editor",{get:function(){return this._editor},enumerable:!0,configurable:!0}),n}(e.TabPair);e.EditorPair=t}(Animate||(Animate={}));var Animate;!function(e){var t=function(t){function n(e){t.call(this,e)}return __extends(n,t),n.prototype.save=function(){var t=this,n=t.editor;this.loading(!0),e.User.get.project.curBuild.update({html:n.getValue()}).then(function(){t.loading(!1),t.modified=!1,t._close&&e.CanvasTab.getSingleton().removeTab(t,!0)})["catch"](function(n){t.loading(!1),e.Logger.logMessage("Could not update the build HTML: '"+n.message+"'",null,e.LogType.ERROR)})},n.prototype.initialize=function(){return{content:e.User.get.project.curBuild.entry.html,contentType:"ace/mode/html"}},n.prototype.onAdded=function(){n.singleton=this,t.prototype.onAdded.call(this)},n.prototype.onRemove=function(e){t.prototype.onRemove.call(this,e),e.cancel||(n.singleton=null)},n}(e.EditorPair);e.HTMLTab=t}(Animate||(Animate={}));var Animate;!function(e){var t=function(t){function n(e){t.call(this,e)}return __extends(n,t),n.prototype.save=function(){var t=this,n=t.editor;this.loading(!0),e.User.get.project.curBuild.update({css:n.getValue()}).then(function(){t.loading(!1),t.modified=!1,t._close&&e.CanvasTab.getSingleton().removeTab(t,!0)})["catch"](function(n){t.loading(!1),e.Logger.logMessage("Could not update the build CSS: '"+n.message+"'",null,e.LogType.ERROR)})},n.prototype.initialize=function(){return{content:e.User.get.project.curBuild.entry.css,contentType:"ace/mode/css"}},n.prototype.onAdded=function(){n.singleton=this,t.prototype.onAdded.call(this)},n.prototype.onRemove=function(e){t.prototype.onRemove.call(this,e),e.cancel||(n.singleton=null)},n}(e.EditorPair);e.CSSTab=t}(Animate||(Animate={}));var Animate;!function(e){var t=function(t){function n(e){this.originalName=e.id+" - "+e.alias,t.call(this,null,null,this.originalName),this.scriptNode=e,this.proxyFunctionClick=this.OnFunctionClick.bind(this),this.saved=!0,this.close=!1,this._editor=null,this.onEnter=null,this.onFrame=null,this.onInitialize=null,this.onDispose=null,this.curFunction=null,this.userDefinedChange=!0,this.scripts={}}return __extends(n,t),n.prototype.OnFunctionClick=function(e){this.userDefinedChange=!1;var t=jQuery(e.target).attr("function");jQuery(".function-button",this.right.element).removeClass("function-pushed"),jQuery(e.target).addClass("function-pushed"),this.curFunction=t,jQuery("#local-total").hide(),jQuery("#local-delta").hide(),jQuery("#local-name").hide(),jQuery("#local-portal").hide(),"onInitialize"==this.curFunction?this._editor.setValue(this.onInitialize):"onEnter"==this.curFunction?(this._editor.setValue(this.onEnter),jQuery("#local-name").show(),jQuery("#local-portal").show()):"onDispose"==this.curFunction?this._editor.setValue(this.onDispose):"onFrame"==this.curFunction&&(this._editor.setValue(this.onFrame),jQuery("#local-total").show(),jQuery("#local-delta").show()),this._editor.selection.moveCursorFileStart(),this.userDefinedChange=!0},n.prototype.onResize=function(){this._editor.resize()},n.prototype.rename=function(e){this.originalName=this.scriptNode.id+" - "+e,this.saved?this.name=this.originalName:this.name="*"+this.originalName,this.text=this.name},n.prototype.onAdded=function(){var t=new e.Component("<div class='script-content'></div>",this.page),n="<div class='script-menus'><div title='Called when the script is first initialized' class='function-button' function='onInitialize'>On Initialize</div><div title='Called each time the behaviour is entered from an input gate' class='function-button function-pushed' function='onEnter'>On Enter</div><div title='Called each frame as long as the script is active' class='function-button' function='onFrame'>On Frame</div><div title='Called when the script needs to be cleaned up and destroyed' class='function-button' function='onDispose'>On Dispose</div><div class='script-helpers'></div></div>";this.right=new e.Component(n,this.page),this.page.element.append("<div class='fix'></div>"),jQuery(".function-button",this.right.element).on("click",this.proxyFunctionClick),this._editorComponent=new e.Component("<pre style='position:absolute; margin: 0; top: 0; bottom: 0; left: 0; right: 0;'></pre>",t);var i=ace.edit(this._editorComponent.id);this._editor=i,i.setTheme("ace/theme/chrome"),i.getSession().setMode("ace/mode/javascript"),this._editorComponent.on(e.ComponentEvents.UPDATED,this.onResize,this),i.commands.addCommand({name:"save",bindKey:{win:"Ctrl-S",mac:"Command-S",sender:"editor|cli"},exec:function(){e.Toolbar.getSingleton().saveAll()}});var o=new e.AnimateLoader,r=this.scriptNode.scriptId,s=this,a=function(t,n,o){if(t==e.LoaderEvents.COMPLETE){var r=n.tag.script;r||(r={}),s.userDefinedChange=!1,i.setValue(r.onEnter?r.onEnter:""),i.selection.moveCursorFileStart(),s.curFunction="onEnter",s.onEnter=r.onEnter?r.onEnter:"",s.onInitialize=r.onInitialize?r.onInitialize:"",s.onDispose=r.onDispose?r.onDispose:"",s.onFrame=r.onFrame?r.onFrame:"",s.userDefinedChange=!0}},l=function(){s.userDefinedChange&&(s.saved=!1,s.name="*"+s.originalName,s.text=s.name,s[s.curFunction]=s._editor.getValue())};i.on("change",l),o.on(e.LoaderEvents.COMPLETE,a),o.on(e.LoaderEvents.FAILED,a),o.load("/project/get-behaviour-scripts",{projectId:e.User.get.project.entry._id,_id:r}),this.onSelected()},n.prototype.onServer=function(t,n){t==e.ProjectEvents.FAILED?this.saved=!1:(this.save(),this.close&&e.CanvasTab.getSingleton().removeTab(this,!0))},n.prototype.onSaveAll=function(){this.save()},n.prototype.onSelected=function(){if(this.right){var e=jQuery(".script-helpers",this.right.element);e.empty(),this.scripts={};var t=this.scripts;t.portalName="portalName",t.portal="portal",t.totalTime="totalTime",t.delta="delta";var n="";n+="<div id='local-name' style='display:block;' title='The local portal name variable' script='portalName' class='script-helper'><span class='identifier'>local</span> - <span class='name'>portalName</span> <span class='type'>(string)</span></div>",n+="<div id='local-portal' style='display:block;' title='The portal that entered' script='portal' class='script-helper'><span class='identifier'>local</span> - <span class='name'>portal</span> <span class='type'>(Anim.Portal)</span></div>",n+="<div id='local-total' style='display:none;' title='The total time that has elapsed in milliseconds' script='totalTime' class='script-helper'><span class='identifier'>local</span> - <span class='name'>totalTime</span> <span class='type'>(number)</span></div>",n+="<div id='local-delta' style='display:none;' title='The delta time since the last on frame call' script='delta' class='script-helper'><span class='identifier'>local</span> - <span class='name'>delta</span> <span class='type'>(number)</span></div>";for(var i=this.scriptNode.inputs,o=i.length,r=0;o>r;r++)t[i[r].property.name]='if ( portalName == "'+i[r].property.name+'" )\r{\r}',n+="<div title='Inserts an input condition' script='"+i[r].property.name+"' class='helper-onenter script-helper'><span class='identifier'>input</span> - <span class='name'>"+i[r].property.name+"</span> <span class='type'>(bool)</span></div>";i=this.scriptNode.outputs,o=i.length;for(var r=0;o>r;r++)t[i[r].property.name]='this.exit( "'+i[r].property.name+'", false );',n+="<div title='Inserts an exit snippet' script='"+i[r].property.name+"' class='helper-onenter script-helper'><span class='identifier'>output</span> - <span class='name'>"+i[r].property.name+"</span> <span class='type'>(bool)</span></div>";i=this.scriptNode.parameters,o=i.length;for(var r=0;o>r;r++)t[i[r].property.name]='this.getParam("'+i[r].property.name+'")',n+="<div title='Inserts a get parameter snippet' script='"+i[r].property.name+"' class='helper-onenter script-helper'><span class='identifier'>parameters</span> - <span class='name'>"+i[r].property.name+"</span></div>";i=this.scriptNode.products,o=i.length;for(var r=0;o>r;r++)t[i[r].property.name]='this.setProduct( "'+i[r].property.name+'", /*VALUE*/ );',n+="<div title='Inserts a set product snippet' script='"+i[r].property.name+"' class='helper-onenter script-helper'><span class='identifier'>products</span> - <span class='name'>"+i[r].property.name+"</span></div>";e.html(n);var s=this._editor;jQuery(".script-helper",e).on("click",function(e){s.insert(t[jQuery(e.currentTarget).attr("script")]),s.focus()})}},n.prototype.onRemove=function(t){var n=this,i=function(t){"Yes"==t?(n.close=!0,n.save()):(n.close=!0,n.saved=!0,e.CanvasTab.getSingleton().removeTab(n,!0))};return this.saved?(this._editorComponent.off(e.ComponentEvents.UPDATED,this.onResize,this),jQuery(".function-button",this.right.element).off("click",this.proxyFunctionClick),this._editor.commands.removeCommand("save"),this._editor.removeAllListeners("change"),this._editor.destroy(),this._editor=null,this.right=null,this.proxyFunctionClick=null,this._editor=null,this.onEnter=null,this.onInitialize=null,this.onDispose=null,this.onFrame=null,this._editorComponent=null,this.scriptNode=null,void(this.scripts=null)):(t.cancel=!0,void e.MessageBox.show("Script not saved, would you like to save it now?",["Yes","No"],i,this))},n.prototype.save=function(){if(!this.saved){var t=this,n=function(n,i,o){if(n==e.LoaderEvents.COMPLETE){if(i.return_type==e.AnimateLoaderResponses.ERROR)return void e.MessageBox.show("There was an error saving the script: '"+i.message+"'",Array("Ok"),null,null);t.name=t.originalName,jQuery(".text",t.tabSelector.element).text(t.name),t.saved=!0,t.close&&e.CanvasTab.getSingleton().removeTab(t,!0)}},i=new e.AnimateLoader;i.on(e.LoaderEvents.COMPLETE,n),i.on(e.LoaderEvents.FAILED,n),i.load("/project/save-behaviour-script",{projectId:e.User.get.project.entry._id,onEnter:this.onEnter,onInitialize:this.onInitialize,onDispose:this.onDispose,onFrame:this.onFrame,_id:this.scriptNode.scriptId})}},n}(e.TabPair);e.ScriptTab=t}(Animate||(Animate={}));var Animate;!function(e){var t=function(t){function n(i){if(t.call(this,i),null!=n._singleton)throw new Error("The SceneTab class is a singleton. You need to call the SceneTab.get() function.");n._singleton=this,this.element.css({width:"100%",height:"100%"}),this.mDocker=null,this.assetPanel=this.addTab("Assets",!1).page,new e.TreeViewScene(this.assetPanel)}return __extends(n,t),n.prototype.getPreviewImage=function(){return"media/world_48.png"},n.prototype.getDocker=function(){return this.mDocker},n.prototype.setDocker=function(e){this.mDocker=e},n.prototype.onShow=function(){},n.prototype.onHide=function(){},n.getSingleton=function(e){return n._singleton||new n(e),n._singleton},n}(e.Tab);e.SceneTab=t}(Animate||(Animate={}));var Animate;!function(e){var t=function(e){function t(t){e.call(this,t)}return __extends(t,e),t.CANVAS=new t("canvas"),t.HTML=new t("html"),t.CSS=new t("css"),t.SCRIPT=new t("script"),t.BLANK=new t("blank"),t}(e.ENUM);e.CanvasTabType=t;var n=function(n){function i(e){if(n.call(this,e),null!=i._singleton)throw new Error("The CanvasTab class is a singleton. You need to call the CanvasTab.getSingleton() function.");i._singleton=this,this.element.css({width:"100%",height:"100%"}),this._currentCanvas=null,this.welcomeTab=null,this.closingTabPair=null,this.mDocker=null}return __extends(i,n),i.prototype.getPreviewImage=function(){return"media/canvas.png"},i.prototype.getDocker=function(){return this.mDocker},i.prototype.setDocker=function(e){this.mDocker=e},i.prototype.onShow=function(){},i.prototype.saveAll=function(){for(var e=this.tabs.length;e--;)this.tabs[e].onSaveAll()},i.prototype.onHide=function(){},i.prototype.onTabPairClosing=function(t){if(t instanceof e.CanvasTabPair){var n=t.canvas;if(!t.forceClose&&t.modified&&!n.container.disposed)return this.closingTabPair=t,e.MessageBox.show("Do you want to save this node before you close it?",["Yes","No"],this.onMessage,this),!1;e.PluginManager.getSingleton().emit(new e.ContainerEvent(e.EventTypes.CONTAINER_SELECTED,null))}return!0},i.prototype.onMessage=function(t){var n=this.closingTabPair.canvas,i=this;"Yes"==t?e.User.get.project.saveResource(n.container.entry._id,e.ResourceType.CONTAINER).then(function(){i.removeTab(this.closingTabPair,!0),i.closingTabPair=null})["catch"](function(t){e.Logger.logMessage(t.message,null,e.LogType.ERROR)}):(i.closingTabPair.forceClose=!0,i.removeTab(i.closingTabPair,!0),i.closingTabPair=null)},i.prototype.removeAsset=function(t){for(var n=this.tabs.length;n--;)if(this.tabs[n].page.children.length>0){var i=this.tabs[n].page.children[0];i instanceof e.Canvas&&i.removeAsset(t)}},i.prototype.getTabCanvas=function(t){for(var n=this.tabs,i=0,o=n.length;o>i;i++){var r=n[i];if(r instanceof e.CanvasTabPair&&r.canvas.container.entry._id==t)return r.canvas}return null},i.prototype.onTabSelected=function(t){var n=e.PluginManager.getSingleton(),i=e.User.get.project;if(this._currentCanvas&&!this._currentCanvas.disposed)for(var o=new e.AssetContainerEvent(e.EditorEvents.ASSET_REMOVED_FROM_CONTAINER,null,this._currentCanvas.container),r=this._currentCanvas.containerReferences,s=0,a=r.assets.length;a>s;s++){var l=i.getResourceByShallowID(r.assets[s],e.ResourceType.ASSET);o.asset=l,n.emit(o)}if(t.page.children[0]instanceof e.Canvas?this._currentCanvas=t.page.children[0]:this._currentCanvas=null,null!=this._currentCanvas&&this._currentCanvas.element.data("component")instanceof e.Canvas){var h=this._currentCanvas.element.data("component");h.onSelected();var c=e.TreeViewScene.getSingleton().sceneNode.findNode("resource",h.container);c&&e.TreeViewScene.getSingleton().selectNode(c);for(var o=new e.AssetContainerEvent(e.EditorEvents.ASSET_ADDED_TO_CONTAINER,null,this._currentCanvas.container),r=h.containerReferences,s=0,a=r.assets.length;a>s;s++){var l=i.getResourceByShallowID(r.assets[s],e.ResourceType.ASSET);o.asset=l,n.emit(o)}n.emit(new e.ContainerEvent(e.EventTypes.CONTAINER_SELECTED,h.container))}else n.emit(new e.ContainerEvent(e.EventTypes.CONTAINER_SELECTED,null));e.Tab.prototype.onTabSelected.call(this,t)},i.prototype.projectReady=function(t){var n=new e.AnimateLoader;n.on(e.LoaderEvents.COMPLETE,this.onNewsLoaded,this),n.on(e.LoaderEvents.FAILED,this.onNewsLoaded,this),n.load("/misc/get-news-tab",{})},i.prototype.projectReset=function(){this._currentCanvas=null,this.welcomeTab=null,this.clear()},i.prototype.onNewsLoaded=function(n,i,o){if(n==e.LoaderEvents.COMPLETE&&i.return_type==e.AnimateLoaderResponses.SUCCESS){this.welcomeTab&&this.removeTab(this.welcomeTab.name,!0),this.welcomeTab=this.addSpecialTab("Welcome to Animate!",t.BLANK);var r=new e.Component(i.tag.html,this.welcomeTab.page);r.element.css({width:"100%",height:"100%"}),r.addLayout(new e.Fill)}},i.getSingleton=function(e){return i._singleton||new i(e),i._singleton},i.prototype.renameTab=function(e,t){var n=this.getTab(e);return n.tabSelector.element.text(t),n.canvas.name=t,n},i.prototype.removeTab=function(t,i){if(t instanceof e.CanvasTabPair){for(var o=t.canvas,r=e.PluginManager.getSingleton(),s=new e.AssetContainerEvent(e.EditorEvents.ASSET_REMOVED_FROM_CONTAINER,null,o.container),a=e.User.get.project,l=o.containerReferences,h=0,c=l.assets.length;c>h;h++){var u=a.getResourceByShallowID(l.assets[h],e.ResourceType.ASSET);s.asset=u,r.emit(s)}o.container.canvas=null,o.off(e.CanvasEvents.MODIFIED,this.onCanvasModified,this)}return n.prototype.removeTab.call(this,t,i)},i.prototype.onCanvasModified=function(e,t,n){this._currentCanvas.container.saved=!1},i.prototype.addSpecialTab=function(i,o,r){void 0===o&&(o=t.CANVAS),void 0===r&&(r=null);var s=e.PluginManager.getSingleton(),a=null;if(o==t.CANVAS){a=n.prototype.addTab.call(this,new e.CanvasTabPair(new e.Canvas(null,r),i),!0);var l=a.canvas;r.canvas=l,a.page.addChild(l),l.on(e.CanvasEvents.MODIFIED,this.onCanvasModified,this),a.modified=!l.container.saved,this._currentCanvas=l,l.children[0].updateDimensions(),
s.emit(new e.ContainerEvent(e.EventTypes.CONTAINER_CREATED,r)),s.emit(new e.ContainerEvent(e.EventTypes.CONTAINER_SELECTED,r))}else o==t.BLANK?a=n.prototype.addTab.call(this,i,!0):o==t.HTML?a=e.HTMLTab.singleton?this.selectTab(e.HTMLTab.singleton):n.prototype.addTab.call(this,new e.HTMLTab("HTML"),!0):o==t.CSS?a=e.CSSTab.singleton?this.selectTab(e.CSSTab.singleton):n.prototype.addTab.call(this,new e.CSSTab("CSS"),!0):o==t.SCRIPT&&(a=e.Tab.prototype.addTab.call(this,new e.ScriptTab(r)));return a},Object.defineProperty(i.prototype,"currentCanvas",{get:function(){return this._currentCanvas},enumerable:!0,configurable:!0}),i}(e.Tab);e.CanvasTab=n}(Animate||(Animate={}));var Animate;!function(e){var t=function(e){function t(t){e.call(this,"<div class='property-grid-group background-view-light'></div>",null),this.name=t,this.element.append("<div class='property-grid-group-header tooltip-text-bg'>"+t+"</div>"),this.content=jQuery("<div class='content'></div>"),this.element.append(this.content)}return __extends(t,e),t.prototype.dispose=function(){this.name=null,this.content=null,e.prototype.dispose.call(this)},t}(e.Component);e.PropertyGridGroup=t}(Animate||(Animate={}));var Animate;!function(e){var t=function(t){function n(e){t.call(this,e)}return __extends(n,t),n.prototype.canEdit=function(t){return t instanceof e.PropText?!0:!1},n.prototype.edit=function(e,t){var n=e,i=jQuery("<div class='property-grid-label'>"+n.name+"</div><div class='property-grid-value'><input type='text' class='PropTextbox' value = '"+n.getVal().toString()+"' /></div><div class='fix'></div>");t.element.append(i);var o=function(e){n.setVal(jQuery("input",i).val())};jQuery("input",i).val(n.getVal()),jQuery("input",i).on("keyup",o)},n}(e.PropertyGridEditor);e.PGTextbox=t}(Animate||(Animate={}));var Animate;!function(e){var t=function(t){function n(e){t.call(this,e)}return __extends(n,t),n.prototype.canEdit=function(t){return t instanceof e.PropNum?!0:!1},n.prototype.edit=function(e,t){var n=e,i=n.getVal(),o=n.min,r=n.max,s=n.interval,a=jQuery("<div class='property-grid-label'>"+n.name+"</div><div class='property-grid-value'><input type='text' class='PropTextbox' value = '"+i+"' /></div><div class='fix'></div>");t.element.append(a);var l=function(e){var t=parseFloat(jQuery("input",a).val());isNaN(t)&&(t=0),o>t&&(t=o),t>r&&(t=r);var i=t;n.setVal(i)};jQuery("input",a).val(i.toString()),jQuery("input",a).on("keyup",l),jQuery("input",a).on("mouseup",l),jQuery("input",a).jStepper({allowDecimals:!0,maxValue:r,minValue:o,normalStep:s,onStep:l})},n}(e.PropertyGridEditor);e.PGNumber=t}(Animate||(Animate={}));var Animate;!function(e){var t=function(t){function n(e){t.call(this,e)}return __extends(n,t),n.prototype.canEdit=function(t){return t instanceof e.PropBool?!0:!1},n.prototype.edit=function(e,t){var n=e,i=jQuery("<div class='property-grid-label'>"+n.name+"</div><div class='property-grid-value'><select class='prop-combo'></select></div><div class='fix'></div>"),o=jQuery("select",i);t.element.append(i),o.append("<option value='true' "+(e.getVal()?"selected='selected'":"")+">True</option>"),o.append("<option value='false' "+(e.getVal()?"":"selected='selected'")+">False</option>");var r=function(t){var n=o.val();e.setVal("true"==n?!0:!1)};return o.on("change",r),i},n}(e.PropertyGridEditor);e.PGComboBool=t}(Animate||(Animate={}));var Animate;!function(e){var t=function(t){function n(e){t.call(this,e)}return __extends(n,t),n.prototype.canEdit=function(t){return t instanceof e.PropEnum?!0:!1},n.prototype.edit=function(e,t){var n=e,i=jQuery("<div class='property-grid-label'>"+n.name+"</div><div class='property-grid-value'><select class='prop-combo'></select></div><div class='fix'></div>"),o=jQuery("select",i);t.element.append(i);var r=n.getVal(),s=n.choices;s=s.sort();for(var a=s.length,l=0;a>l;l++)o.append("<option value='"+s[l]+"' "+(r==s[l]?"selected='selected'":"")+">"+s[l]+"</option>");var h=function(e){var t=o.val();n.setVal(t)};o.on("change",h)},n}(e.PropertyGridEditor);e.PGComboEnum=t}(Animate||(Animate={}));var Animate;!function(e){var t=function(t){function n(e){t.call(this,e)}return __extends(n,t),n.prototype.canEdit=function(t){return t instanceof e.PropFileResource?!0:!1},n.prototype.edit=function(t,n){var i=t,o=i.getVal(),r=(o||o.entry._id||"",i.extensions),s=(e.User.get.project,jQuery("<div class='property-grid-label'>"+i.name+"</div><div class='property-grid-value'><div class='prop-file'><div class='file-name'>"+(o?o.entry.name:"")+"</div><div class='file-button reg-gradient'>...</div><div class='file-button-image'><img src='media/download-file.png'/></div></div></div><div class='fix'></div>")),a=function(t,n){if(e.FileViewer.get.off("cancelled",a),e.FileViewer.get.off("change",a),"cancelled"!=t){var r=n.file;jQuery(".file-name",s).text(r?r.name:""),o.entry=r,i.setVal(o)}},l=function(t){e.FileViewer.get.off("cancelled",a),e.FileViewer.get.off("change",a),e.FileViewer.get.on("change",a),e.FileViewer.get.on("cancelled",a),e.FileViewer.get.choose(r)};s.on("mouseup",l)},n}(e.PropertyGridEditor);e.PGFile=t}(Animate||(Animate={}));var Animate;!function(e){var t=function(t){function n(e){t.call(this,e)}return __extends(n,t),n.prototype.canEdit=function(t){return t instanceof e.PropGroup?!0:!1},n.prototype.edit=function(t,n){var i=t,o=i.getVal(),r=o?i.getVal().entry.shallowId:"",s=jQuery("<div class='property-grid-label'>"+i.name+"</div><div class='property-grid-value'><select class='prop-combo' style = 'width:90%;'></select><div class='eye-picker'><img src='media/eye.png' /></div></div><div class='fix'></div>"),a=jQuery("select",s),l=jQuery(".eye-picker",s);n.element.append(s);var h=e.User.get.project,c=h.groups.slice(0,h.groups.length);c=c.sort(function(e,t){var n=e.entry.name,i=t.entry.name;return i>n?-1:n>i?1:0}),a.append("<option value='' "+(i.getVal()?"":"selected='selected'")+"></option>");for(var u=0;u<c.length;u++)a.append("<option title='"+c[u].entry.shallowId+"' value='"+c[u].entry.shallowId+"' "+(r==c[u].entry.shallowId?"selected='selected'":"")+">"+c[u].entry.name+"</option>");var p=function(t){var n=parseFloat(a.val()),o=h.getResourceByShallowID(n,e.ResourceType.GROUP);i.setVal(o)},d=function(t){var n=parseFloat(a.val()),i=h.getResourceByShallowID(n,e.ResourceType.GROUP);e.TreeViewScene.getSingleton().selectNode(e.TreeViewScene.getSingleton().findNode("resource",i),!0)};l.on("mouseup",d),a.on("change",p)},n}(e.PropertyGridEditor);e.PGComboGroup=t}(Animate||(Animate={}));var Animate;!function(e){var t=function(t){function n(e){t.call(this,e)}return __extends(n,t),n.prototype.canEdit=function(t){return t instanceof e.PropAsset&&t.type==e.PropertyType.ASSET?!0:!1},n.prototype.edit=function(t,n){var i=t,o=jQuery("<div class='property-grid-label'>"+i.name+"</div><div class='property-grid-value'><select class='prop-combo' style = 'width:90%;'></select><div class='eye-picker'><img src='media/eye.png' /></div></div><div class='fix'></div>"),r=jQuery("select",o),s=jQuery(".eye-picker",o);n.element.append(o);var a=i.getVal(),l=a?a.entry._id:null,h=i.classNames,c=e.TreeViewScene.getSingleton().getAssets(h);r.append("<option value='' "+(l?"":"selected='selected'")+"></option>"),c=c.sort(function(e,t){var n=e.resource.entry.name.toUpperCase(),i=t.resource.entry.name.toUpperCase();return i>n?-1:n>i?1:0});for(var u=c.length,p=0;u>p;p++)r.append("<option title='"+(c[p].resource.entry.shallowId+" : "+c[p].resource.entry.className)+"' value='"+c[p].resource.entry.shallowId+"' "+(l==c[p].resource.entry.shallowId?"selected='selected'":"")+">"+c[p].resource.entry.name+"</option>");var d=function(t){var n=parseFloat(r.val()),o=e.User.get.project.getResourceByShallowID(n,e.ResourceType.ASSET);i.setVal(o)},m=function(t){var n=parseInt(r.val()),i=e.User.get.project.getResourceByShallowID(n,e.ResourceType.ASSET);i?e.TreeViewScene.getSingleton().selectNode(e.TreeViewScene.getSingleton().findNode("resource",i),!0):e.TreeViewScene.getSingleton().selectNode(e.TreeViewScene.getSingleton().findNode("className",h[0]),!0)};s.on("mouseup",m),r.on("change",d)},n}(e.PropertyGridEditor);e.PGComboAsset=t}(Animate||(Animate={}));var Animate;!function(e){var t=function(t){function n(e){t.call(this,e)}return __extends(n,t),n.prototype.canEdit=function(t){return t instanceof e.PropAssetList?!0:!1},n.prototype.edit=function(t,n){var i,o,r=t,s=jQuery("<div class='property-grid-label'>"+r.name+"</div><div class='property-grid-value'><select class='prop-combo' style= 'width:90%;' ></select><div class='eye-picker'><img src='media/eye.png'/></div><div class='asset- list'><select class='asset-list-select' size='4'></select><div class='add'>Add</div><div class='remove'>Remove</div></div></div><div class='fix'></div>"),a=jQuery("select.prop-combo",s),l=jQuery(".eye-picker",s),h=jQuery("select.asset-list-select",s),c=jQuery(".add",s),u=jQuery(".remove",s),p=r.getVal(),d=r.classNames,m=e.TreeViewScene.getSingleton().getAssets(d);m=m.sort(function(e,t){var n=e.resource.entry.name.toUpperCase(),i=t.resource.entry.name.toUpperCase();return i>n?-1:n>i?1:0});for(var f=0,v=m.length;v>f;f++)0==f&&(i=m[f].resource.entry.shallowId,o=m[f].resource),a.append("<option title='"+m[f].resource.entry.shallowId+" : "+m[f].resource.entry.className+"' value='"+m[f].resource.entry.shallowId+"' "+(0==f?"selected='selected'":"")+">"+m[f].resource.entry.name+"</option>");for(var f=0,v=p.length;v>f;f++){var g=e.User.get.project.getResourceByShallowID(p[f].entry.shallowId,e.ResourceType.ASSET);g&&h.append("<option title='"+(p[f]+" : "+g.entry.className)+"' value='"+g.entry.shallowId+"'>"+g.entry.name+"</option>")}var y=function(t){i=parseInt(a.val()),o=e.User.get.project.getResourceByShallowID(i,e.ResourceType.ASSET)},_=function(e){a.val(h.val())},b=function(t){var n=parseInt(a.val());o=e.User.get.project.getResourceByShallowID(n,e.ResourceType.ASSET),o?e.TreeViewScene.getSingleton().selectNode(e.TreeViewScene.getSingleton().findNode("resource",o),!0):e.TreeViewScene.getSingleton().selectNode(e.TreeViewScene.getSingleton().findNode("className",o["class"].name),!0)},w=function(e){o&&-1==p.indexOf(o)&&(p.push(o),h.append("<option title='"+(i+" : "+o.entry.className)+"' value='"+o.entry.shallowId+"'>"+o.entry.name+"</option>"),r.setVal(p))},P=function(t){var n=parseInt(h.val());o=e.User.get.project.getResourceByShallowID(n,e.ResourceType.ASSET),-1!=p.indexOf(o)&&(p.splice(p.indexOf(o),1),jQuery("option:selected",h).remove(),r.setVal(p))};l.on("mouseup",b),a.on("change",y),h.on("change",_),c.on("mouseup",w),u.on("mouseup",P)},n}(e.PropertyGridEditor);e.PGAssetList=t}(Animate||(Animate={}));var Animate;!function(e){var t=function(t){function n(e){t.call(this,e)}return __extends(n,t),n.prototype.canEdit=function(t){return t instanceof e.PropColor?!0:!1},n.prototype.edit=function(t,n){var i=t,o=i.getVal().color,r=i.getVal().alpha,s="c"+e.Component.idCounter++,a="c"+e.Component.idCounter++,l=jQuery("<div class='property-grid-label'>"+i.name+"</div><div class='property-grid-value'><div style='width:100%; height:20px; background:url(media/map-opacity.png);' ><input style='width:80%; opacity:"+r+";' class='color PropTextbox' id = '"+s+"' value = '\" + color + \"' ></input><input id='"+a+"' class='PropTextbox' style='width:20%;' value='"+r+"'></input></div></div ><div class='fix' ></div >");n.element.append(l);var h=new jscolor.color(document.getElementById(s),{});h.fromString(o.toString());var c=function(n){var i=parseFloat(jQuery("#"+s).val()),o=parseFloat(jQuery("#"+a).val());jQuery("#"+s).css("opacity",o),t.setVal(new e.Color(i,o))};jQuery("#"+a,l).on("keyup",c),jQuery("#"+s,l).on("change",c),l.on("mouseup",c)},n}(e.PropertyGridEditor);e.PGColorPicker=t}(Animate||(Animate={}));var Animate;!function(e){var t=function(t){function n(i){if(null!=n._singleton)throw new Error("PropertyGrid is a singleton, you need to call the PropertyGrid.getSingleton() function to get its instance.");n._singleton=this,t.call(this,"<div class='property-grid'></div>",i),this._header=jQuery("<div class='property-grid-header background-dark'>Select an Object</div>"),this.element.append(this._header),this._editors=[],this._docker=null,this._groups=[],this.addEditor(new e.PGTextbox(this)),this.addEditor(new e.PGNumber(this)),this.addEditor(new e.PGComboBool(this)),this.addEditor(new e.PGComboEnum(this)),this.addEditor(new e.PGComboGroup(this)),this.addEditor(new e.PGColorPicker(this)),this.addEditor(new e.PGFile(this)),this.addEditor(new e.PGAssetList(this)),this.addEditor(new e.PGComboAsset(this))}return __extends(n,t),n.prototype.getPreviewImage=function(){return"media/spanner.png"},n.prototype.getDocker=function(){return this._docker},n.prototype.setDocker=function(e){this._docker=e},n.prototype.onShow=function(){},n.prototype.onHide=function(){},n.prototype.cleanup=function(){for(var e=0,t=this._editors.length;t>e;e++)this._editors[e].cleanup();for(var e=0,t=this._groups.length;t>e;e++)this.removeChild(this._groups[e]),this._groups[e].dispose();this._groups=[]},n.prototype.editableObject=function(t,n,i){if(void 0===i&&(i=""),this.enabled){if(this.cleanup(),void 0!==t&&null!=t){this._header.html((i&&""!=i?"<img src='"+i+"' />":"")+n);var o=[];this._object=t;for(var r=this._groups,s=t.variables,a=0;a<s.length;a++){for(var l=s[a],h=null,c=0,u=r.length;u>c;c++)if(r[c].name==l.category){h=r[c];break}null==h&&(h=new e.PropertyGridGroup(l.category),r.push(h)),o.push({prop:l,group:h})}o.sort(function(e,t){var n=e.group.name.toUpperCase(),i=t.group.name.toUpperCase();return n>i?-1:i>n?1:0});for(var a=0;a<o.length;a++)o[a].group.parent||this.addChild(o[a].group);o.sort(function(e,t){var n=e.prop.name.toUpperCase(),i=t.prop.name.toUpperCase();return n>i?1:i>n?-1:0});for(var a=0;a<o.length;a++)for(var p=this._editors,d=0,m=p.length;m>d;d++)if(o[a].prop.type!=e.PropertyType.HIDDEN&&o[a].prop.type!=e.PropertyType.HIDDEN_FILE&&p[d].canEdit(o[a].prop)){var f=new e.Component("<div class='editor-container'></div>");o[a].group.addChild(f),p[d].edit(o[a].prop,f)}}else this._header.html("Please select an object."),this._object=null;return this._object}},n.prototype.projectReset=function(){this.editableObject(null,"","")},n.prototype.addEditor=function(e){return this._editors.push(e),e},n.prototype.removeEditor=function(e){return-1!=this._editors.indexOf(e)?(this._editors.splice(this._editors.indexOf(e),1),e):null},n.prototype.dispose=function(){this._object=null,t.prototype.dispose.call(this)},n.getSingleton=function(e){return n._singleton||new n(e),n._singleton},Object.defineProperty(n.prototype,"currentObject",{get:function(){return this._object},enumerable:!0,configurable:!0}),n}(e.Component);e.PropertyGrid=t}(Animate||(Animate={}));var Animate;!function(e){var t=function(e){function t(t,n,i,o){void 0===i&&(i=!1),e.call(this,"<div class='toolbar-button tooltip'><div><img src='"+n+"' /></div><div class='tooltip-text tooltip-text-bg'>"+t+"</div></div>",o),this._pushButton=i,this._radioMode=!1,this._proxyDown=this.onClick.bind(this),this.element.on("click",this._proxyDown)}return __extends(t,e),t.prototype.dispose=function(){this.element.off("mousedown",this._proxyDown),this._proxyDown=null,e.prototype.dispose.call(this)},t.prototype.onClick=function(e){var t=this.element;this._pushButton&&(t.hasClass("selected")?this.selected=!1:this.selected=!0)},Object.defineProperty(t.prototype,"selected",{get:function(){return this.element.hasClass("selected")},set:function(e){if(e?this.element.addClass("selected"):this.element.removeClass("selected"),this._radioMode&&e&&this.parent)for(var n=this.parent.children,i=0,o=n.length;o>i;i++)n[i]!=this&&n[i]instanceof t&&(n[i].selected=!1)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"radioMode",{get:function(){return this._radioMode},set:function(e){this._radioMode=e},enumerable:!0,configurable:!0}),t}(e.Component);e.ToolBarButton=t}(Animate||(Animate={}));var Animate;!function(e){var t=function(e){function t(t){e.call(this,t)}return __extends(t,e),t.CHANGED=new t("toolbar_number_changed"),t}(e.ENUM);e.ToolbarNumberEvents=t;var n=function(n){function i(t,o,r,s,a,l){void 0===l&&(l=1),n.call(this,"<div class='toolbar-button tooltip scrolling-number'></div>",t);var h=this.addChild("<div class='number-holder'></div>");this.addChild("<div class='tooltip-text tooltip-text-bg'>"+o+"</div>"),this.defaultVal=r,this.minValue=s,this.maxValue=a,this.delta=l,i.input||(i.input=new e.InputBox(null,""),i.input.element.css({"pointer-events":"all"}),i.numInstances=0),this.label=h.addChild("<div class='number-label'>"+r+"</div>");var c=h.addChild("<div class='arrows'></div>");this.leftArrow=c.addChild("<div class='left'>←</div>"),this.rightArrow=c.addChild("<div class='right'>→</div>"),this.element.css("pointer-events","all"),this.startPos=0,this.stageUpPoxy=jQuery.proxy(this.onStageUp,this),this.stageMovePoxy=jQuery.proxy(this.onStageMove,this),this.downProxy=jQuery.proxy(this.onDown,this),this.clickProxy=jQuery.proxy(this.onClick,this),this.wheelProxy=jQuery.proxy(this.onWheel,this),this.keyProxy=jQuery.proxy(this.onKeyDown,this),this.leftArrow.element.on("mousedown",this.downProxy),this.rightArrow.element.on("mousedown",this.downProxy),this.leftArrow.element.on("click",this.clickProxy),this.rightArrow.element.on("click",this.clickProxy),this.label.element.on("click",this.clickProxy),this.element.on("mousewheel",this.wheelProxy)}return __extends(i,n),i.prototype.onStageUp=function(n){var o=i.input.parent?!0:!1,r=jQuery(window);if(r.off("mouseup",this.stageUpPoxy),r.off("mousemove",this.stageMovePoxy),jQuery(document).off("keydown",this.keyProxy),o){var s=jQuery(n.target).data("component");if(!s)return;if(s.parent==i.input&&!n.keyCode)return;this.defaultVal=parseFloat(parseFloat(i.input.text).toFixed(2)),i.input.parent.removeChild(i.input),this.defaultVal<this.minValue&&(this.defaultVal=this.minValue),this.defaultVal>this.maxValue&&(this.defaultVal=this.maxValue),this.label.element.text(this.defaultVal.toString()),this.emit(new e.ToolbarNumberEvent(t.CHANGED,this.defaultVal))}},i.prototype.onStageMove=function(n){var i=n.screenX-this.startPos;this.startPos=n.screenX,0>i?this.defaultVal-=this.delta:this.defaultVal+=this.delta,this.defaultVal<this.minValue&&(this.defaultVal=this.minValue),this.defaultVal>this.maxValue&&(this.defaultVal=this.maxValue),this.defaultVal=parseFloat(this.defaultVal.toFixed(2)),this.label.element.text(this.defaultVal.toString()),this.emit(new e.ToolbarNumberEvent(t.CHANGED,this.defaultVal))},Object.defineProperty(i.prototype,"value",{get:function(){return this.defaultVal},set:function(e){this.defaultVal=e,this.defaultVal<this.minValue&&(this.defaultVal=this.minValue),this.defaultVal>this.maxValue&&(this.defaultVal=this.maxValue),this.defaultVal=parseFloat(this.defaultVal.toFixed(2)),this.label.element.text(this.defaultVal.toString())},enumerable:!0,configurable:!0}),i.prototype.onWheel=function(n,i,o,r){0>i?this.defaultVal-=this.delta:this.defaultVal+=this.delta,this.defaultVal<this.minValue&&(this.defaultVal=this.minValue),this.defaultVal>this.maxValue&&(this.defaultVal=this.maxValue),this.defaultVal=parseFloat(this.defaultVal.toFixed(2)),this.label.element.text(this.defaultVal.toString()),this.emit(new e.ToolbarNumberEvent(t.CHANGED,this.defaultVal))},i.prototype.onKeyDown=function(e){13==e.keyCode&&this.onStageUp(e)},i.prototype.onDown=function(e){var t=jQuery(window);t.off("mouseup",this.stageUpPoxy),t.off("mousemove",this.stageMovePoxy),t.on("mouseup",this.stageUpPoxy),t.on("mousemove",this.stageMovePoxy),this.startPos=e.screenX,e.preventDefault()},i.prototype.onClick=function(n){if(!i.input.parent){var o=jQuery(n.currentTarget).data("component");if(o==this.label)return i.input.text=o.element.text(),o.element.text(""),o.addChild(i.input),jQuery("body").off("mouseup",this.stageUpPoxy),jQuery("body").on("mouseup",this.stageUpPoxy),void jQuery(document).on("keydown",this.keyProxy);o==this.leftArrow?this.defaultVal-=this.delta:o==this.rightArrow&&(this.defaultVal+=this.delta),this.defaultVal<this.minValue&&(this.defaultVal=this.minValue),this.defaultVal>this.maxValue&&(this.defaultVal=this.maxValue),this.defaultVal=parseFloat(this.defaultVal.toFixed(2)),this.label.element.text(this.defaultVal.toString()),this.emit(new e.ToolbarNumberEvent(t.CHANGED,this.defaultVal))}},i.prototype.dispose=function(){var e=jQuery(window);e.off("mouseup",this.stageUpPoxy),e.off("mousemove",this.stageMovePoxy),this.leftArrow.element.off("mousedown",this.downProxy),this.rightArrow.element.off("mousedown",this.downProxy),this.element.off("mousewheel",this.wheelProxy),this.leftArrow.element.off("click",this.clickProxy),this.rightArrow.element.off("click",this.clickProxy),this.label.element.off("click",this.clickProxy),this.downProxy=null,this.clickProxy=null,this.defaultVal=null,this.minValue=null,this.maxValue=null,this.delta=null,this.label=null,this.leftArrow=null,this.rightArrow=null,this.wheelProxy=null,this.stageUpPoxy=null,this.stageMovePoxy=null,this.startPos=null,i.numInstances--,i.numInstances<=0&&(i.numInstances=0,i.input.dispose(),i.input=null),n.prototype.dispose.call(this)},i.numInstances=0,i}(e.Component);e.ToolbarNumber=n}(Animate||(Animate={}));var Animate;!function(e){var t=function(e){function t(t,n,i){e.call(this,"<div class='toolbar-button tooltip'></div>",t),this.numberInput=this.addChild("<input class='toolbar-color' value='#ff0000'></input>"),this.addChild("<div class='tooltip-text tooltip-text-bg'>"+n+"</div>"),this.picker=new jscolor.color(document.getElementById(this.numberInput.id)),this.picker.fromString(i)}return __extends(t,e),Object.defineProperty(t.prototype,"color",{get:function(){return parseInt(this.numberInput.element.val(),16)},set:function(e){this.picker.fromString(e)},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){this.picker=null,this.numberInput=null},t}(e.Component);e.ToolbarColorPicker=t}(Animate||(Animate={}));var Animate;!function(e){var t=function(e){function t(t,n,i){e.call(this,"<div class='toolbar-button tooltip'><div><img src='"+t+"' /></div><div class='tooltip-text tooltip-text-bg'>"+n+"</div></div>",i),this.img=t,this.text=n}return __extends(t,e),t}(e.Component);e.ToolbarItem=t;var n=function(t){function n(n,i){t.call(this,"<div class='toolbar-button-drop-down tooltip'></div>",n),this.items=i,this._popupContainer=new e.Component("<div class='tool-bar-dropdown background shadow-small'></div>");for(var o=i.length;o--;)this._popupContainer.addChild(i[o]);i.length>0?this._selectedItem=this.addChild(i[0]):this._selectedItem=null,this._stageDownProxy=this.onStageUp.bind(this),this._clickProxy=this.onClick.bind(this),this.element.on("click",this._clickProxy)}return __extends(n,t),n.prototype.addItem=function(e){var t=this._popupContainer.addChild(e);return this.items.push(e),t},n.prototype.removeItem=function(e,t){void 0===t&&(t=!0);for(var n=this.items.length,i=this.items;n--;)if(i[n]==e||i[n].text==e||i[n].comp==e)return t?i[n].dispose():i[n].element.detach(),i.splice(n,1),i[n];return null},n.prototype.clear=function(e){void 0===e&&(e=!0);for(var t=this.items.length,n=this.items;t--;)e?n[t].dispose():n[t].element.detach();this._selectedItem=null,n.splice(0,n.length)},Object.defineProperty(n.prototype,"selectedItem",{get:function(){return this._selectedItem},set:function(t){if(this._selectedItem!==t){this._selectedItem&&this._popupContainer.addChild(this._selectedItem),this.addChild(t),this._selectedItem=t;var n=new e.ToolbarDropDownEvent(t,"clicked");this.emit(n),n.dispose()}},enumerable:!0,configurable:!0}),n.prototype.onStageUp=function(e){var t=jQuery("body");t.off("mousedown",this._stageDownProxy);var n=jQuery(e.target).data("component");if(this._popupContainer.element.detach(),this.element.removeClass("active"),n)for(var i=this.items.length;i--;)if(n==this.items[i])return void(this.selectedItem=n)},n.prototype.onClick=function(e){var t=this.element.offset();this.element.addClass("active");var n=jQuery("body");n.off("mousedown",this._stageDownProxy),n.on("mousedown",this._stageDownProxy),this._popupContainer.element.css({top:t.top+this.element.height(),left:t.left}),n.append(this._popupContainer.element)},n.prototype.dispose=function(){for(var e=this.items.length;e--;)this.items[e].dispose();this._popupContainer.dispose(),this.element.off("click",this._clickProxy),this._clickProxy=null,this.items=null,this._popupContainer=null,this._selectedItem=null,t.prototype.dispose.call(this)},n}(e.Component);e.ToolbarDropDown=n}(Animate||(Animate={}));var Animate;!function(e){var t=function(e){function t(t){e.call(this,t)}return __extends(t,e),t.CONFIRM=new t("ok_cancel_confirm"),t}(e.ENUM);e.OkCancelFormEvents=t;var n=function(n){function i(t,i,o,r,s,a){void 0===t&&(t=400),void 0===i&&(i=400),void 0===o&&(o=!0),void 0===r&&(r=!1),void 0===s&&(s=""),void 0===a&&(a=!1),n.call(this,t,i,o,r,s),this.element.css("height",""),this.okCancelContent=new e.Component("<div class='content'></div>",this.content),this.mButtonContainer=new e.Component("<div class='button-container'></div>",this.content),this.mOk=new e.Button("Ok",this.mButtonContainer),this.mCancel=new e.Button("Cancel",this.mButtonContainer),this.mOk.css({width:"70px",height:"30px","margin-right":"3px"}),this.mCancel.css({width:"70px",height:"30px"}),a&&this.mCancel.element.hide(),this.mOk.element.on("click",this.OnButtonClick.bind(this)),this.mCancel.element.on("click",this.OnButtonClick.bind(this)),this.keyProxy=this.onKeyDown.bind(this)}return __extends(i,n),i.prototype.onCloseClicked=function(n){var i=new e.OkCancelFormEvent(t.CONFIRM,"Cancel");this.emit(i),i.cancel===!1&&this.hide()},i.prototype.OnButtonClick=function(n){var i=new e.OkCancelFormEvent(t.CONFIRM,jQuery(n.target).text());this.emit(i),i.cancel===!1&&this.hide()},i.prototype.hide=function(){n.prototype.hide.call(this),jQuery("body").off("keydown",this.keyProxy)},i.prototype.dispose=function(){this.mOk.element.off(),this.mCancel.element.off(),jQuery("body").off("keydown",this.keyProxy),this.content=null,this.mButtonContainer=null,this.mOk=null,this.mCancel=null,this.keyProxy=null,this.okCancelContent=null,n.prototype.dispose.call(this)},i.prototype.show=function(e,t,i,o,r){void 0===e&&(e=null),void 0===t&&(t=NaN),void 0===i&&(i=NaN),void 0===o&&(o=!0),void 0===r&&(r=!1),n.prototype.show.call(this,null,t,i,!0,!1),jQuery("body").on("keydown",this.keyProxy),this.onWindowResized(null)},i.prototype.onKeyDown=function(e){13==e.keyCode&&this.mOk.element.trigger("click")},i}(e.Window);e.OkCancelForm=n}(Animate||(Animate={}));var Animate;!function(e){var t=function(t){function n(){t.call(this,600,500,!0,!0,"Settings"),n._singleton=this,this.element.addClass("build-options-form"),this._tab=new e.Tab(this.content);var i=this._tab.addTab("Project",!1).page;this._projectElm=jQuery("#options-project").remove().clone(),this._buildElm=jQuery("#options-build").remove().clone(),this._userElm=jQuery("#options-user").remove().clone(),i.element.append(this._projectElm),this.$user=e.User.get,this.$project=null,this.$errorMsg="",this.$errorMsgImg="",this.$loading=!1,this.$projectToken={tags:[]},this.$loadingPercent="",e.Compiler.build(this._projectElm,this,!1),i=this._tab.addTab("Build Options",!1).page,i.element.append(this._buildElm),this._settingPages=[],this._tab.on(e.TabEvents.SELECTED,this.onTab,this),i=this._tab.addTab("User Options",!1).page,i.element.append(this._userElm);var o=this;this.element.resizable({minHeight:50,minWidth:50,helper:"ui-resizable-helper",stop:function(){o.update()}})}return __extends(n,t),n.prototype.pickAvatar=function(){var t=this;this.$loading=!0,this.$errorMsgUserImg="",e.FileViewer.get.choose("img").then(function(n){e.User.get.updateDetails({image:n?n.url:null}).then(function(){t.$loading=!1,e.Compiler.digest(t._userElm,t,!1)})["catch"](function(n){t.$errorMsgUserImg=n.message,t.$loading=!1,e.Compiler.digest(t._userElm,t,!1)})})},n.prototype.pickProjectPick=function(){var t=this;this.$loading=!0;var n=e.User.get.project;this.$errorMsgProjImg="",e.FileViewer.get.choose("img").then(function(i){n.updateDetails({image:i?i.url:null}).then(function(){t.$loading=!1,e.Compiler.digest(t._projectElm,t,!1)})["catch"](function(n){t.$errorMsgProjImg=n.message,t.$loading=!1,e.Compiler.digest(t._projectElm,t,!1)})})},n.prototype.updateDetails=function(t){var n=this,i=e.User.get.project;this.$loading=!0,this.$errorMsg="",i.updateDetails(t).then(function(){for(var o in t)i.entry[o]=t[o];n.$loading=!1,e.Compiler.digest(n._projectElm,n,!1)})["catch"](function(t){n.$errorMsg=t.message,n.$loading=!1,e.Compiler.digest(n._projectElm,n,!1)})},n.prototype.reportError=function(e){if(e.$error){var t=e.$errorInput;switch(t=t.charAt(0).toUpperCase()+t.slice(1),e.$errorExpression){case"alpha-numeric":this.$errorMsg=t+" must only contain alphanumeric characters";break;case"email-plus":this.$errorMsg=t+" must only contain alphanumeric characters or a valid email";break;case"non-empty":this.$errorMsg=t+" cannot be empty";break;case"email":this.$errorMsg=t+" must be a valid email";break;case"alpha-numeric-plus":this.$errorMsg=t+" must only contain alphanumeric characters and '-', '!', or '_'";break;case"no-html":this.$errorMsg=t+" must not contain any html";break;default:this.$errorMsg=""}}else this.$errorMsg="";return""==this.$errorMsg?!1:!0},n.prototype.updateBio=function(t){var n=this,i=this.$user;this.$loading=!0,this.$errorMsg="",i.updateDetails({bio:t})["catch"](function(t){n.$errorMsg=t.message,n.$loading=!1,e.Compiler.digest(n._userElm,n,!1)}).then(function(){n.$loading=!1,e.Compiler.digest(n._userElm,n,!1)})},n.prototype.onTab=function(t,n,i){for(var o=this._settingPages.length;o--;)this._settingPages[o].name==n.pair.text&&this._settingPages[o].onTab();e.Compiler.digest(this._projectElm,this,!1),e.Compiler.digest(this._buildElm,this,!1),e.Compiler.digest(this._userElm,this,!1)},n.prototype.addSettingPage=function(e){this._settingPages.push(e);var t=this._tab.addTab(e.name,!1);t.page.addChild(e)},n.prototype.show=function(){e.OkCancelForm.prototype.show.call(this),this._tab.selectTab(this._tab.getTab("Project"));var t=e.User.get,n=t.project,i=n.entry;this.$project=n,this.$projectToken={name:i.name,description:i.description,tags:i.tags,category:i.category,"public":i["public"]},e.Compiler.digest(this._projectElm,this,!1),e.Compiler.digest(this._buildElm,this,!1),e.Compiler.digest(this._userElm,this,!1),this.update()},n.getSingleton=function(){return n._singleton||new n,n._singleton},n}(e.Window);e.BuildOptionsForm=t}(Animate||(Animate={}));var Animate;!function(e){var t=function(t){function n(){n._singleton=this;var i=this;t.call(this,1e3,600,!0,!0,"Asset Browser"),this.element.attr("id","file-viewer-window"),this._browserElm=jQuery("#file-viewer").remove().clone(),this.content.element.append(this._browserElm),this.$newFolder=!1,this.$selectedFile=null,this.$errorMsg="",this.$confirmDelete=!1,this._cancelled=!0,this.$pager=new e.PageLoader(this.updateContent.bind(this)),this.$pager.limit=15,this.selectedEntities=[],this.selectedEntity=null,this.selectedFolder=null,this.$search="",this.$onlyFavourites=!1,this.$entries=[],this.$folders=[],this.extensions=[],this.multiSelect=!0,this._shiftkey=!1,this.$editMode=!1,this._searchType=e.FileSearchType.User,this.$fileToken={tags:[]},this.$uploader=new e.FileUploader(function(t){e.Compiler.digest(i._browserElm,i)},function(t){t?(i.$errorMsg=t.message,e.Compiler.digest(i._browserElm,i)):i.$pager.invalidate()}),e.Compiler.build(this._browserElm,this);var o=new e.ToolbarDropDown(null,[new e.ToolbarItem("media/assets-user.png","Filter by My Files"),new e.ToolbarItem("media/assets-project.png","Filter by Project Files"),new e.ToolbarItem("media/assets-global.png","Filter by Global Files")]);jQuery("#file-search-mode",this._browserElm).append(o.element),$(document).on("keyup keydown",function(e){i._shiftkey=e.shiftKey}),o.on("clicked",function(t,n,o){"Filter by Project Files"==o.selectedItem.text?i.selectMode(e.FileSearchType.Project):"Filter by My Files"==o.selectedItem.text?i.selectMode(e.FileSearchType.User):i.selectMode(e.FileSearchType.Global);
}),this.element.resizable({minHeight:50,minWidth:50,helper:"ui-resizable-helper"}),jQuery(".file-items",this.element).on("dragexit",this.onDragLeave.bind(this)),jQuery(".file-items",this.element).on("dragleave",this.onDragLeave.bind(this)),jQuery(".file-items",this.element).on("dragover",this.onDragOver.bind(this)),jQuery(".file-items",this.element).on("drop",this.onDrop.bind(this))}return __extends(n,t),n.prototype.getThumbnail=function(e){return e.previewUrl?e.previewUrl:"./media/appling.png"},n.prototype.selectMode=function(e){this._searchType=e,this.$pager.invalidate()},n.prototype.openFolder=function(e){this.$pager.index=0,this.selectedFolder=e,this.$confirmDelete=!1,this.$newFolder=!1,this.$errorMsg="",this.$search="",this.$pager.invalidate()},n.prototype.newFolder=function(){var t=this,n=e.User.get.entry,i=$("#new-folder-name").val(),o=e.DB.USERS+"/media";return""==i.trim()?(t.$errorMsg="Please specify a valid folder name",e.Compiler.digest(t._browserElm,t)):(t.$errorMsg="",t.$loading=!0,void jQuery.post(o+"/create-bucket/"+n.username+"/"+i,null).then(function(n){n.error?t.$errorMsg=n.message:($("#new-folder-name").val(""),t.$newFolder=!1,t.$pager.invalidate()),t.$loading=!1,e.Compiler.digest(t._browserElm,t)}))},n.prototype.confirmDelete=function(){if(this.$confirmDelete=!this.$confirmDelete,this.$confirmDelete){var e="file";this.$errorMsg="Are you sure you want to delete "+(this.selectedEntities.length>1?"these ["+this.selectedEntities.length+"]":"the ")+" "+e+(this.selectedEntities.length>1?"s":" '"+this.selectedEntities[0].name+"'")}else this.$errorMsg=""},n.prototype.getPreview=function(t){var n=this._browserElm[0].querySelector("#file-preview"),i=e.PluginManager.getSingleton().displayPreview(t,this.uploadPreview),o=n.childNodes.length>0?n.childNodes[0]:null;o&&i!=o&&n.removeChild(n.childNodes[0]),i&&o!=i&&n.appendChild(i)},n.prototype.selectEntity=function(e){this.$errorMsg="",this.$confirmDelete=!1,e.selected=!e.selected;var t=this.selectedEntities;if(e.selected){if(this.multiSelect&&0==this._shiftkey){for(var n=0,i=t.length;i>n;n++)t[n].selected=!1;t.splice(0,t.length)}t.push(e)}else t.splice(t.indexOf(e),1);0==t.length?this.selectedEntity=null:this.selectedEntity=t[t.length-1];var o=this.$selectedFile=this.selectedEntity;o&&(this.$fileToken={name:o.name,tags:o.tags.slice(),favourite:o.favourite,global:o.global,_id:o._id})},n.prototype.hide=function(){this.emit(new e.FileViewerEvent("selected",this._cancelled?null:this.selectedEntity)),t.prototype.hide.call(this),this.extensions.splice(0,this.extensions.length)},n.prototype.fileChosen=function(e){this._cancelled=!1,this.hide(),this._cancelled=!0},n.prototype.removeEntities=function(){var t=this;t.$errorMsg="",t.$editMode=!1,t.$loading=!0;for(var n=e.DB.USERS+"/media",i="remove-files",o="",r=0,s=this.selectedEntities.length;s>r;r++)o+=this.selectedEntities[r].identifier+",";o=o.length>0?o.substr(0,o.length-1):"",e.Utils["delete"](n+"/"+i+"/"+o).then(function(e){e.error&&(t.$errorMsg=e.message),t.$loading=!1,t.$confirmDelete=!1,t.$pager.invalidate()})},n.prototype.updateContent=function(t,n){var i=this,o=e.User.get.entry,r=e.User.get.project,s="";i.$loading=!0,i.$errorMsg="",i.$selectedFile=null,this.selectedEntities.splice(0,this.selectedEntities.length),this.selectedEntity=null,e.Compiler.digest(i._browserElm,i),s=this._searchType==e.FileSearchType.Project?e.DB.API+"/files/"+o.username+"/"+r.entry._id+"/?index="+t+"&limit="+n+"&favourite="+this.$onlyFavourites+"&search="+i.$search+"&bucket="+o.username+"-bucket":e.DB.API+"/files/"+o.username+"/?index="+t+"&limit="+n+"&favourite="+this.$onlyFavourites+"&search="+i.$search+"&bucket="+o.username+"-bucket",jQuery.getJSON(s).then(function(t){return t.error?(i.$errorMsg=t.message,i.$entries=[],i.$pager.last=1):(i.$entries=t.data,i.$entries=i.filterByExtensions(),i.$pager.last=t.count),i.$loading=!1,e.Compiler.digest(i._browserElm,i)})},n.prototype.onDragOver=function(e){if(this.visible){var t=e.originalEvent.dataTransfer.items;t.length>0?jQuery(".file-items",this.element).hasClass("drag-here")||jQuery(".file-items",this.element).addClass("drag-here"):jQuery(".file-items",this.element).hasClass("drag-here")&&jQuery(".file-items",this.element).removeClass("drag-here")}e.preventDefault(),e.stopPropagation()},n.prototype.onDragLeave=function(e){this.visible&&jQuery(".file-items",this.element).hasClass("drag-here")&&jQuery(".file-items",this.element).removeClass("drag-here")},n.prototype.checkIfAllowed=function(e){var t=this.extensions;if(t.length>0)for(var n=0,i=e.length;i>n;n++){for(var o=e[n].name.split("."),r=o[o.length-1].toLowerCase(),s=!1,a=0,l=t.length;l>a;a++)if(t[a]==r){s=!0;break}if(!s)return!1}return!0},n.prototype.filterByExtensions=function(){var e=this.extensions,t=this.$entries,n="",i=!1;if(0==e.length)return this.$entries;for(var o=[],r=0,s=t.length;s>r;r++){n=t[r].extension.split(/\\|\//).pop().trim(),i=!1;for(var a=0,l=e.length;l>a;a++)if(n==e[a]){i=!0;break}i&&o.push(t[r])}return o},n.prototype.onDrop=function(t){e.User.get.entry;if(this.visible){jQuery(".file-items",this.element).hasClass("drag-here")&&jQuery(".file-items",this.element).removeClass("drag-here"),t.preventDefault(),t.stopPropagation();var n=t.originalEvent.dataTransfer.files;if(n.length>0){if(!this.checkIfAllowed(n))return this.$errorMsg="Only "+this.extensions.join(", ")+" file types are allowed",e.Compiler.digest(this._browserElm,this),!1;for(var i=0,o=n.length;o>i;i++)this.$uploader.uploadFile(n[i],{browsable:!0});return!1}}},n.prototype.uploadPreview=function(t,i){var o=n._singleton,r=e.User.get.entry,s=jQuery(".preview-loader",o._browserElm);s.css({width:"0%",height:"1px"});var a=new e.FileUploader(function(e){s.css({width:e+"%",height:"1px"})},function(n,i){return s.css({width:"",height:""}),n?void e.Logger.logMessage(n.message,null,e.LogType.ERROR):void e.Utils.put(e.DB.API+"/files/"+r.username+"/"+t._id,{previewUrl:i[1].url}).then(function(o){o.error&&e.Logger.logMessage(n.message,null,e.LogType.ERROR),t.previewUrl=i[1].url})["catch"](function(t){e.Logger.logMessage("An error occurred while connecting to the server. "+t.status+": "+t.message,null,e.LogType.ERROR)})});a.upload2DElement(i,t.name+"-preview",{browsable:!1},t.identifier)},n.prototype.show=function(n,i,o,r,s){void 0===n&&(n=null),void 0===i&&(i=NaN),void 0===o&&(o=NaN),void 0===r&&(r=!1),void 0===s&&(s=!1),t.prototype.show.call(this,null,void 0,void 0,!0),this.$errorMsg="",this.$confirmDelete=!1,this.$loading=!1,this.$newFolder=!1,this.selectedEntity=null;var a=this;e.User.get.entry,this.extensions;this.$pager.invalidate();var l=function(){var t=this;if(!a.checkIfAllowed(t.files))return a.$errorMsg="Only "+a.extensions.join(", ")+" file types are allowed",e.Compiler.digest(a._browserElm,a),this.value="",!1;for(var n=0;n<t.files.length;n++){var i=t.files[n];a.$uploader.uploadFile(i,{browsable:!0})}this.value=""},h=document.getElementById("upload-new-file");h._func&&h.removeEventListener("change",h._func,!1),h.addEventListener("change",l,!1),h._func=l},n.prototype.choose=function(e){this.show();var t=jQuery.Deferred(),n=this;"img"==e?this.extensions=["jpg","jpeg","png","gif"]:this.extensions=e;var i=function(e,o,r){n.off("selected",i),t.resolve(o.file)};return this.on("selected",i),t.promise()},n.prototype.updateFile=function(t){var n=this,i=e.User.get.entry;n.$loading=!0,n.$errorMsg="",n.$confirmDelete=!1,e.Compiler.digest(n._browserElm,n),e.Utils.put(e.DB.API+"/files/"+i.username+"/"+t._id,t).then(function(i){if(n.$loading=!1,i.error)n.$errorMsg=i.message;else{n.$editMode=!1;for(var o in t)n.$selectedFile.hasOwnProperty(o)&&(n.$selectedFile[o]=t[o])}e.Compiler.digest(n._browserElm,n)})["catch"](function(t){n.$errorMsg="An error occurred while connecting to the server. "+t.status+": "+t.message,e.Compiler.digest(n._browserElm,n)})},Object.defineProperty(n,"get",{get:function(){return n._singleton||new n,n._singleton},enumerable:!0,configurable:!0}),n}(e.Window);e.FileViewer=t}(Animate||(Animate={}));var Animate;!function(e){var t=function(t){function n(){t.call(this,400,200,!0,!1,null),this.$message="",this.$buttons=[],this._handle=e.Compiler.build(jQuery("#en-message-box").remove(),this),this.content.element.append(this._handle),this.element.addClass("message-box"),this.element.css({width:"",height:""}),jQuery(window).on("resize",this.onResize.bind(this))}return __extends(n,t),n.prototype.onButtonClick=function(e,t){this.hide(),this._callback&&this._callback.call(this._context?this._context:this,t)},n.prototype.onResize=function(e){this.visible&&this.center()},n.show=function(t,i,o,r){var s=n.getSingleton();s._callback=o,s._context=r,i||(i=["Ok"]),s.$message=t,s.$buttons=i,e.Compiler.digest(s._handle,s),s.show(e.Application.bodyComponent,NaN,NaN,!0)},n.getSingleton=function(){return n._singleton||(n._singleton=new n),n._singleton},n}(e.Window);e.MessageBox=t}(Animate||(Animate={}));var Animate;!function(e){var t=function(t){function n(){n._singleton=this,t.call(this,400,250,!0,!0,"Portal Editor"),this.element.addClass("portal-form"),this.element.css("height",""),this._typeCombo=new e.ComboBox,this._assetClassCombo=new e.ComboBox,this.$name="",this.$class="",this.$errorMsg="",this._fromOk=!1,this._portalType=null,this._value=null,this._nameVerifier=null,this._typeCombo.on(e.ListEvents.ITEM_SELECTED,this.onTypeSelect.bind(this)),this.onTypeSelect(e.ListEvents.ITEM_SELECTED,new e.ListEvent(e.ListEvents.ITEM_SELECTED,e.PropertyType.ASSET.toString())),this._formElm=jQuery("#portal-editor").remove().clone(),this.content.element.append(this._formElm),e.Compiler.build(this._formElm,this,!1),jQuery("#portal-types",this._formElm).append(this._typeCombo.element),jQuery("#asset-classes",this._formElm).append(this._assetClassCombo.element)}return __extends(n,t),n.prototype.generateClasses=function(){this._assetClassCombo.clearItems(),this._typeCombo.clearItems(),this._typeCombo.addItem("Select Property Type"),this._assetClassCombo.addItem("Select Asset Class"),this._assetClassCombo.addItem("All");var t=e.TreeViewScene.getSingleton().getAssetClasses();t=t.sort(function(e,t){var n=e.name.toUpperCase(),i=t.name.toUpperCase();return i>n?-1:n>i?1:0});for(var n=0;n<t.length;n++)this._assetClassCombo.addItem(t[n].name);for(var i in e.PropertyType)isNaN(parseFloat(i))&&this._typeCombo.addItem(i)},n.prototype.onTypeSelect=function(t,n){n.item==e.PropertyType[e.PropertyType.ASSET]?(this._assetClassCombo.element.show(),this._assetClassCombo.element.fadeIn("fast")):this._assetClassCombo.element.hide()},n.prototype.getProperty=function(){return new e.Prop(this.$name,this._value)},n.prototype.editPortal=function(n,i,o){this.generateClasses(),this.$errorMsg="",this._portalType=i,this.$name=n?n.name:"",this._typeCombo.selectedIndex=0,this._assetClassCombo.selectedIndex=0,this._nameVerifier=o,i==e.PortalType.OUTPUT||i==e.PortalType.INPUT?(this._typeCombo.element.hide(),this._assetClassCombo.element.hide(),this._value=!0):(this._typeCombo.element.show(),this.onTypeSelect(e.ListEvents.ITEM_SELECTED,new e.ListEvent(e.ListEvents.ITEM_SELECTED,this._typeCombo.selectedItem))),t.prototype.show.call(this),this._fromOk=!1,e.Compiler.digest(this._formElm,this),jQuery("#portal-name",this._formElm).focus();var r=this;return new Promise(function(e,t){var n=function(t,i){e("property-created"==t?{prop:r._newProperty,cancel:!1}:{prop:null,cancel:!0}),r.off("property-created",n),r.off("cancelled",n)};r.on("property-created",n),r.on("cancelled",n)})},n.prototype.hide=function(){return this._fromOk||this.emit(new e.Event("cancelled")),this._fromOk=!1,t.prototype.hide.call(this)},n.prototype.ok=function(){var t=this.$name;return this.$errorMsg="",""==t.trim()?(this.$errorMsg="Name cannot be empty",e.Compiler.digest(this._formElm,this)):0!=this._typeCombo.selectedIndex||this._portalType!=e.PortalType.PARAMETER&&this._portalType!=e.PortalType.PRODUCT?this._typeCombo.selectedItem==e.PropertyType[e.PropertyType.ASSET]&&0==this._assetClassCombo.selectedIndex?(this.$errorMsg="Please select a valid asset sub-class",e.Compiler.digest(this._formElm,this)):(this._portalType==e.PortalType.INPUT||this._portalType==e.PortalType.OUTPUT?this._newProperty=new e.PropBool(this.$name,!1):this._newProperty=e.Utils.createProperty(this.$name,e.PropertyType[this._typeCombo.selectedItem]),this._newProperty instanceof e.PropAsset&&this._newProperty.type==e.PropertyType.ASSET&&(this._assetClassCombo.selectedIndex<2?this._newProperty.classNames=[]:this._newProperty.classNames=[this._assetClassCombo.selectedItem]),this._nameVerifier(this.$name)?(this.emit(new e.Event("property-created")),this._fromOk=!0,void this.hide()):(this.$errorMsg="The name "+this.$name+" is already in use, please choose another",e.Compiler.digest(this._formElm,this))):(this.$errorMsg="Please select a valid property type",e.Compiler.digest(this._formElm,this))},Object.defineProperty(n.prototype,"name",{get:function(){return this.$name},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"portalType",{get:function(){return this._portalType},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"value",{get:function(){return this._newProperty.getVal()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"parameterType",{get:function(){return this._portalType==e.PortalType.INPUT||this._portalType==e.PortalType.OUTPUT?e.PropertyType.BOOL:void this._newProperty.type},enumerable:!0,configurable:!0}),n.getSingleton=function(){return n._singleton||new n,n._singleton},n}(e.Window);e.PortalForm=t}(Animate||(Animate={}));var Animate;!function(e){var t=function(t){function n(){n._singleton=this,t.call(this,400,250,!1,!0,"Please enter a name"),this.element.addClass("rename-form"),this.element.css("height",""),this.$name="",this.$errorMsg="",this.$loading=!1,this._fromOk=!1,this._projectElm=jQuery("#rename-content").remove().clone(),this.content.element.append(this._projectElm),e.Compiler.build(this._projectElm,this,!1),this.object=null}return __extends(n,t),n.prototype.hide=function(){return this._fromOk||this.emit(new e.Event("cancelled")),this._fromOk=!1,t.prototype.hide.call(this)},n.prototype.show=function(e,n,i,o,r){void 0===e&&(e=null),void 0===n&&(n=NaN),void 0===i&&(i=NaN),void 0===o&&(o=!1),void 0===r&&(r=!1),t.prototype.show.call(this),jQuery("input",this._projectElm).select()},n.prototype.renameObject=function(n,i,o){t.prototype.show.call(this,void 0,void 0,void 0,!0),this.object=n,this.$name=n.name,this._resourceId=i,this._type=o;var r=this;return jQuery("input",this._projectElm).select(),e.Compiler.digest(this._projectElm,this),new Promise(function(e,t){var i=function(t,o){e("renamed"==t?{newName:o.name,oldName:o.oldName,object:o.object,cancelled:!1}:{newName:n.name,oldName:n.name,object:o.object,cancelled:!0}),r.off("renamed",i),r.off("cancelled",i)};r.on("renamed",i),r.on("cancelled",i)})},n.prototype.ok=function(){var t=this.$name,n=this,i=e.User.get.project,o=this.object?this.object.name:"";if(this._fromOk=!0,""==t.trim())return this.$errorMsg="Name cannot be empty",void e.Compiler.digest(this._projectElm,this);var r=new e.RenameFormEvent("renaming",t,o,this.object,this._type);return this.$loading=!0,this.$errorMsg="",this.emit(r),r.cancel?(this.$errorMsg=r.reason,void e.Compiler.digest(this._projectElm,this)):this._resourceId&&this._type?void i.editResource(this._resourceId,{name:t},this._type).then(function(i){n.emit(new e.RenameFormEvent("renamed",t,o,n.object,n._type)),n.hide(),n.$loading=!1,e.Compiler.digest(n._projectElm,n)})["catch"](function(t){n.$errorMsg=t.message,n.$loading=!1,e.Compiler.digest(n._projectElm,n)}):(n.hide(),n.emit(new e.RenameFormEvent("renamed",t,o,n.object,n._type)))},Object.defineProperty(n,"get",{get:function(){return n._singleton||new n,n._singleton},enumerable:!0,configurable:!0}),n}(e.Window);e.RenameForm=t}(Animate||(Animate={}));var Animate;!function(e){var t=function(t){function n(){if(null!=n._singleton)throw new Error("The UserPrivilegesForm class is a singleton. You need to call the UserPrivilegesForm.get() function.");n._singleton=this,t.call(this,450,600,!0,!0,"User Privileges"),this.content.element.addClass("user-privileges-content");var i=this.content.addChild("<div class='top'></div>"),o=this.content.addChild("<div class='bottom'></div>");this.mSave=new e.Button("Save",o),this.mSave.element.width(80),this.mSave.element.height(30),this.mSave.element.css({margin:"0px 3px 3px 3px","line-height":"30px"}),this.search=o.addChild("<div class='asset-search'><input type='text'></input><img src='media/search.png' /></div>"),this.mMenu=new e.ListView(i),this.mMenu.addColumn("Username"),this.mMenu.addColumn("Access Rights");this.element.width();this.mMenu.setColumnWidth(0,185),this.mMenu.setColumnWidth(1,255),this.mMenu.addItem(new e.ListViewItem(["Mat","<select><option value='hidden'>Hidden</option><option value='read'>Read</option><option value='write'>Write</option><option value='admin'>Administrate</option></select>"])),this.mMenu.addItem(new e.ListViewItem(["Mat2","<select><option value='hidden'>Hidden</option><option value='read'>Read</option><option value='write'>Write</option><option value='admin'>Administrate</option></select>"])),this.mMenu.addItem(new e.ListViewItem(["Anna","<select><option value='hidden'>Hidden</option><option value='read'>Read</option><option value='write'>Write</option><option value='admin'>Administrate</option></select>"])),this.mMenu.addItem(new e.ListViewItem(["Steve","<select><option value='hidden'>Hidden</option><option value='read'>Read</option><option value='write'>Write</option><option value='admin'>Administrate</option></select>"])),this.mMenu.addItem(new e.ListViewItem(["Ilka","<select><option value='hidden'>Hidden</option><option value='read'>Read</option><option value='write'>Write</option><option value='admin'>Administrate</option></select>"])),this.keyDownProxy=this.onInputKey.bind(this),this.buttonProxy=this.onButtonClick.bind(this),jQuery("input",this.search.element).on("keydown",this.keyDownProxy),jQuery("img",this.search.element).on("click",this.buttonProxy),this.mSave.element.on("click",this.buttonProxy)}return __extends(n,t),n.prototype.onServer=function(t,n,i){if(t==e.LoaderEvents.COMPLETE)if(n.return_type==e.AnimateLoaderResponses.SUCCESS){var o=i;if("/project/get-user-privileges"==o.url)for(var r=n.tag,s=0,a=r.length;a>s;s++){var l=new e.ListViewItem([r[s].username,"<select><option value='"+e.PrivilegeType.NONE+"' "+(r[s].privilege==e.PrivilegeType.NONE?"selected='selected'":"")+">Hidden</option><option value='"+e.PrivilegeType.READ+"' "+(r[s].privilege==e.PrivilegeType.READ?"selected='selected'":"")+">Read</option><option value='"+e.PrivilegeType.WRITE+"' "+(r[s].privilege==e.PrivilegeType.WRITE?"selected='selected'":"")+">Write</option><option value='"+e.PrivilegeType.ADMIN+"' "+(r[s].privilege==e.PrivilegeType.ADMIN?"selected='selected'":"")+">Administrate</option></select>"]);l.tag=r[s].userId,this.mMenu.addItem(l)}}else n.message&&e.MessageBox.show(n.message,["Ok"],null,null)},n.prototype.searchItems=function(){for(var e=this.mMenu.items,t=e.length;t--;)for(var n=e[t].components.length,i=jQuery("input",this.search.element).val(),o=e[t].fields[0]+e[t].fields[1],r=o.search(new RegExp(i,"i"));n--;)-1!=r?e[t].components[n].element.show():e[t].components[n].element.hide()},n.prototype.onButtonClick=function(t){if(t.preventDefault(),jQuery(t.target).is(jQuery("img",this.search.element)))this.searchItems();else{for(var n=e.User.get.project,i=[],o=[],r=0;r<this.mMenu.items.length;r++)i.push(this.mMenu.items[r].tag),o.push(jQuery(this.mMenu.items[r].components[1].element.find("select")).val());var s=new e.AnimateLoader;s.on(e.LoaderEvents.COMPLETE,this.onServer,this),s.on(e.LoaderEvents.FAILED,this.onServer,this),s.load("/project/set-users-access",{projectId:n.entry._id,ids:i,access:o})}},n.prototype.onInputKey=function(e){13==e.keyCode&&this.searchItems()},n.prototype.show=function(){t.prototype.show.call(this,null,NaN,NaN,!0);var n=e.User.get.project;this.mMenu.clearItems();var i=new e.AnimateLoader;i.on(e.LoaderEvents.COMPLETE,this.onServer,this),i.on(e.LoaderEvents.FAILED,this.onServer,this),i.load("/project/get-user-privileges",{projectId:n.entry._id,index:0,limit:20})},n.getSingleton=function(){return n._singleton||new n,n._singleton},n}(e.Window);e.UserPrivilegesForm=t}(Animate||(Animate={}));var Animate;!function(e){var t=function(e){function t(t){e.call(this,t)}return __extends(t,e),t.BEHAVIOUR_PICKED=new t("behaviour_picker_picked"),t}(e.ENUM);e.BehaviourPickerEvents=t;var n=function(n){function i(){if(null!=i._singleton)throw new Error("The BehaviourPicker class is a singleton. You need to call the BehaviourPicker.get() function.");i._singleton=this,n.call(this,200,250),this.element.addClass("tooltip-text-bg"),this.element.addClass("behaviour-picker"),this._input=new e.InputBox(this.content,"Behaviour Name"),this._list=new e.List(this.content),this._X=0,this._Y=0,this._list.selectBox.element.on("click",this.onListClick.bind(this)),this._list.selectBox.element.on("dblclick",this.onListDClick.bind(this)),this._input.textfield.element.on("keyup",this.onKeyDown.bind(this))}return __extends(i,n),i.prototype.show=function(e,t,i,o,r){void 0===e&&(e=null),void 0===t&&(t=0),void 0===i&&(i=0),void 0===o&&(o=!1),void 0===r&&(r=!1),this._list.sort(),i+this.element.height()>jQuery("body").height()&&(i=jQuery("body").height()-this.element.height()),t+this.element.width()>jQuery("body").width()&&(t=jQuery("body").width()-this.element.width()),n.prototype.show.call(this,e,t,i,o,r),this._input.focus(!0)},i.prototype.onListClick=function(e){this._input.text=this._list.selectedItem},i.prototype.onListDClick=function(n){this.emit(new e.BehaviourPickerEvent(t.BEHAVIOUR_PICKED,this._list.selectedItem)),this.hide()},i.prototype.onKeyDown=function(n){if(38!=n.keyCode&&40!=n.keyCode){13==n.keyCode&&(this.emit(new e.BehaviourPickerEvent(t.BEHAVIOUR_PICKED,this._list.selectedItem)),this.hide());for(var i=this._list.items.length,o=0;i>o;o++){var r=this._list.items[o].text().toLowerCase(),s=this._input.text.toLowerCase();if(-1!=r.indexOf(s))return void(this._list.selectedItem=this._list.items[o].text())}}else{n.preventDefault();var a=this._list.selectedIndex;if(-1!=a){var l=this._list.numItems();38==n.keyCode?0>a-1?this._list.selectedIndex=l-1:this._list.selectedIndex=a-1:l>a+1?this._list.selectedIndex=a+1:this._list.selectedIndex=0,this._input.text=this._list.selectedItem}}},i.getSingleton=function(){return i._singleton||new i,i._singleton},Object.defineProperty(i.prototype,"list",{get:function(){return this._list},enumerable:!0,configurable:!0}),i}(e.Window);e.BehaviourPicker=n}(Animate||(Animate={}));var Animate;!function(e){var t=function(t){function n(i){t.call(this,"<div class='toolbar'></div>",i),n._singleton=this,this._topMenu=this.addChild("<div class='tool-bar-top background-haze'></div>"),this._bottomMenu=this.addChild("<div class='tool-bar-bottom'></div>"),this._tabHomeContainer=this.createTab("Animate",!0),this._mainElm=jQuery("#toolbar-main").remove().clone(),this._tabHomeContainer.element.append(this._mainElm),e.Compiler.build(this._mainElm,this),this.$itemSelected=!1,this._copyPasteToken=null,this._currentContainer=this._tabHomeContainer,this._currentTab=this._tabHomeContainer.element.data("tab").element.data("component"),jQuery(document).bind("keydown","Ctrl+s",this.onKeyDown.bind(this)),jQuery(document).bind("keydown","Ctrl+c",this.onKeyDown.bind(this)),jQuery(document).bind("keydown","Ctrl+x",this.onKeyDown.bind(this)),jQuery(document).bind("keydown","Ctrl+v",this.onKeyDown.bind(this)),this._topMenu.element.on("click",jQuery.proxy(this.onMajorTab,this))}return __extends(n,t),n.prototype.itemSelected=function(t){t instanceof e.Behaviour||t instanceof e.Link?this.$itemSelected=!0:this.$itemSelected=!1,e.Compiler.digest(this._mainElm,this)},n.prototype.newProject=function(t){this.$itemSelected=!1,this._copyPasteToken=null,e.Compiler.digest(this._mainElm,this)},n.prototype.onMajorTab=function(e){var t=jQuery(e.target).data("container");null!=t&&t!=this._currentContainer&&(this._currentContainer.element.slideUp("fast",function(){jQuery(this).hide(),jQuery(this).css({left:"0px",top:"0px"});var e=jQuery(this).parent();jQuery(this).detach(),e.append(jQuery(this))}),this._currentContainer=t,this._currentContainer.element.show(),this._currentContainer.element.css({left:"0px",top:"0px"}),this._currentTab.element.removeClass("toolbar-tab-selected"),jQuery(e.target).addClass("toolbar-tab-selected"),this._currentTab=jQuery(e.target).data("component"))},n.prototype.onHome=function(){e.Splash.get.reset(),e.Splash.get.show()},n.prototype.onShowPrivileges=function(){e.Splash.get.reset(),e.Splash.get.show()},n.prototype.onRun=function(){e.PluginManager.getSingleton().emit(new e.Event(e.EditorEvents.EDITOR_RUN,null)),e.ImportExport.getSingleton().run()},n.prototype.onPaste=function(){if(e.CanvasTab.getSingleton().currentCanvas instanceof e.Canvas!=0&&this._copyPasteToken){var t=e.CanvasTab.getSingleton().currentCanvas;t.deTokenize(this._copyPasteToken,!1),t.emit(new e.CanvasEvent(e.CanvasEvents.MODIFIED,t))}},n.prototype.onDuplicate=function(t){if(void 0===t&&(t=!1),e.CanvasTab.getSingleton().currentCanvas instanceof e.Canvas!=0&&e.Canvas.lastSelectedItem){for(var n=e.CanvasTab.getSingleton().currentCanvas,i=[],o=0,r=n.children.length;r>o;o++)n.children[o].selected&&i.push(n.children[o]);this._copyPasteToken=n.tokenize(!1,i),t&&e.Canvas.lastSelectedItem.dispose(),n.emit(e.CanvasEvents.MODIFIED,n)}},n.prototype.newContainer=function(){var t=this;e.RenameForm.get.renameObject({name:""},null,e.ResourceType.CONTAINER).then(function(n){n.cancelled||e.User.get.project.createResource(e.ResourceType.CONTAINER,{name:n.newName}).then(function(t){var n=e.CanvasTab.getSingleton().addSpecialTab(t.entry.name,e.CanvasTabType.CANVAS,t);jQuery(".content",n.tabSelector.element).text(t.entry.name),n.name=t.entry.name})["catch"](function(i){e.RenameForm.get.$errorMsg=-1==i.message.indexOf("urred while creating the resource")?i.message:"The name '"+n.newName+"' is taken, please use another",t.newContainer()})})},n.prototype.onDelete=function(){if(e.CanvasTab.getSingleton().currentCanvas instanceof e.Canvas!=0){for(var t=e.CanvasTab.getSingleton().currentCanvas,n=t.children.length;n--;)null!=t.children[n].disposed&&t.children[n].selected&&t.children[n].onDelete();t.removeItems()}},n.prototype.createTab=function(e,t){void 0===t&&(t=!1);var n=this._topMenu.addChild("<div class='toolbar-tab "+(t?"toolbar-tab-selected":"")+"'>"+e+"</div>"),i=this._bottomMenu.addChild("<div class='tab-container'></div>");return t||i.element.hide(),n.element.data("container",i),i.element.data("tab",n),i},n.prototype.saveAll=function(){e.CanvasTab.getSingleton().saveAll(),e.User.get.project.saveAll()["catch"](function(t){e.Logger.logMessage("Error while saving a resource: "+t.message,null,e.LogType.ERROR)})},n.prototype.onKeyDown=function(e){return"Ctrl+s"==e.data?this.saveAll():"Ctrl+c"==e.data&&this.onDuplicate(!1),"Ctrl+x"==e.data&&this.onDuplicate(!0),"Ctrl+v"==e.data&&this.onPaste(),!1},n.prototype.removeTab=function(e){for(var t=this._topMenu.children,n=t.length;n--;)if(t[n].element.text()==e)return t[n].element.data("container").dispose(),void t[n].dispose()},n.prototype.createGroup=function(e){return e.addChild("<div class='tool-bar-group background-view-light'></div>")},n.prototype.createGroupNumber=function(t,n,i,o,r,s){void 0===i&&(i=Number.MAX_VALUE),void 0===o&&(o=Number.MAX_VALUE),void 0===r&&(r=.1),void 0===s&&(s=null);var a=new e.ToolbarNumber(s,t,n,i,o,r);return s.addChild(a),a},n.prototype.createGroupButton=function(t,n,i,o){void 0===n&&(n=null),void 0===i&&(i=null),void 0===o&&(o=!1);var r=new e.ToolBarButton(t,n,o,i);return i.addChild(r),r},n.prototype.createDropDownButton=function(t,n){var i=new e.ToolbarDropDown(t,n);return i},n.prototype.createColorButton=function(t,n,i){var o=new e.ToolbarColorPicker(t,n,i);return o},n.getSingleton=function(e){return void 0===n._singleton&&(n._singleton=new n(e)),n._singleton},n}(e.Component);e.Toolbar=t}(Animate||(Animate={}));var Animate;!function(e){var t=function(){function t(t){this._app=t,this._captureInitialized=!1,this._splashElm=jQuery("#splash").remove().clone(),this._loginElm=jQuery("#log-reg").remove().clone(),this._welcomeElm=jQuery("#splash-welcome").remove().clone(),this._newProject=jQuery("#splash-new-project").remove().clone(),this._loadingProject=jQuery("#splash-loading-project").remove().clone(),this.$user=e.User.get,this.$activePane="loading",this.$errorMsg="",this.$errorRed=!0,this.$loading=!1,this.$projects=[],this.$plugins=__plugins,this.$selectedPlugins=[],this.$selectedProject=null,this.$pager=new e.PageLoader(this.fetchProjects.bind(this)),Math.random()<.4?this.$theme={"welcome-blue":!0}:this.$theme={"welcome-pink":!0},jQuery("#splash-view",this._splashElm).prepend(this._loginElm),jQuery("#splash-view",this._splashElm).prepend(this._welcomeElm),jQuery("#splash-view",this._splashElm).prepend(this._newProject),jQuery("#splash-view",this._splashElm).prepend(this._loadingProject)}return t.prototype.show=function(){var t=this;t._app.element.detach(),jQuery("body").append(t._splashElm),jQuery("#en-login-username",t._loginElm).val(""),t.$loading=!0,t._captureInitialized?(e.Compiler.digest(this._splashElm,t,!0),Recaptcha.reload()):(t._captureInitialized=!0,e.Compiler.build(this._loginElm,this),e.Compiler.build(this._welcomeElm,this),e.Compiler.build(this._newProject,this),e.Compiler.build(this._loadingProject,this),e.Compiler.build(this._splashElm,this),Recaptcha.create("6LdiW-USAAAAAGxGfZnQEPP2gDW2NLZ3kSMu3EtT",document.getElementById("animate-captcha"),{theme:"white"})),t.$user.authenticated().then(function(e){t.$loading=!1,e?t.goState("welcome",!0):t.goState("login",!0)})["catch"](function(e){t.$loading=!1,t.goState("login",!0)})},t.prototype.splashDimensions=function(){return"login"==this.$activePane||"register"==this.$activePane||"loading-project"==this.$activePane?{compact:!0,wide:!1}:{compact:!1,wide:!0}},t.prototype.goState=function(t,n){void 0===n&&(n=!1);var i=this;i.$activePane=t,i.$errorMsg="","welcome"==t?this.fetchProjects(this.$pager.index,this.$pager.limit):"new-project"==t&&(this.$errorMsg="Give your project a name and select the plugins you woud like to use",this.$errorRed=!1),n&&e.Compiler.digest(i._splashElm,i,!0)},t.prototype.removeProject=function(t){if("No"!=t){var n=this;this.$user.removeProject(this.$selectedProject._id).then(function(){n.$projects.splice(n.$projects.indexOf(n.$selectedProject),1),n.$selectedProject=null,e.Compiler.digest(n._welcomeElm,n)})["catch"](function(t){e.MessageBox.show(t.message)})}},t.prototype.openProject=function(t){var n=this,i=0;n.$loading=!0,e.Application.getInstance().projectReset(),n.goState("loading-project",!0);for(var o=0,r=t.$plugins.length;r>o;o++)e.PluginManager.getSingleton().loadPlugin(t.$plugins[o]).then(function(){if(e.Compiler.digest(n._splashElm,n,!0),i++,i>=t.$plugins.length){for(var o=0,r=t.$plugins.length;r>o;o++)e.PluginManager.getSingleton().preparePlugin(t.$plugins[o]);n.loadScene()}})["catch"](function(t){n.$errorMsg=t.message,e.Compiler.digest(n._splashElm,n,!0)})},t.prototype.loadScene=function(){var t=this,n=this.$user.project;n.entry=this.$selectedProject,e.Toolbar.getSingleton().newProject(n),e.CanvasTab.getSingleton().projectReady(n),e.TreeViewScene.getSingleton().projectReady(n),e.PluginManager.getSingleton().projectReady(n),e.Logger.logMessage("Loading project '"+t.$selectedProject.name+"'...",null,e.LogType.MESSAGE),n.loadResources().then(function(t){return e.Logger.logMessage("Loaded ["+t.length+"] resources",null,e.LogType.MESSAGE),n.loadBuild()}).then(function(i){e.Logger.logMessage("Loaded project build '"+i.entry.name+" - v"+i.entry.version+"'",null,e.LogType.MESSAGE),document.title="Animate: p"+n.entry._id+" - "+n.entry.name,e.Logger.logMessage("Project '"+t.$selectedProject.name+"' has successfully been opened",null,e.LogType.MESSAGE),
t._splashElm.detach(),e.Application.bodyComponent.addChild(e.Application.getInstance())})["catch"](function(n){t.$errorMsg=n.message,e.Compiler.digest(t._splashElm,t,!0)})},t.prototype.fetchProjects=function(t,n){var i=this;i.$loading=!0,i.$errorMsg="",i.$selectedProject=null,e.Compiler.digest(i._splashElm,i),i.$user.getProjectList(i.$pager.index,i.$pager.limit).then(function(t){i.$pager.last=t.count||1,i.$projects=t.data,i.$loading=!1,e.Compiler.digest(i._splashElm,i),e.Compiler.digest(i._welcomeElm,i)})["catch"](function(t){i.$errorMsg=t.message,i.$loading=!1,e.Compiler.digest(i._splashElm,i),e.Compiler.digest(i._welcomeElm,i)})},t.prototype.selectProject=function(e){this.$selectedProject&&(this.$selectedProject.selected=!1),e.selected=!0,this.$selectedProject!=e?this.$selectedProject=e:(this.$selectedProject.selected=!1,this.$selectedProject=null)},t.prototype.selectPlugin=function(e){if(-1==this.$selectedPlugins.indexOf(e)){for(var t=0,n=this.$selectedPlugins.length;n>t;t++)if(this.$selectedPlugins[t].name==e.name){this.$selectedPlugins.splice(t,1);break}this.$selectedPlugins.push(e)}else this.$selectedPlugins.splice(this.$selectedPlugins.indexOf(e),1);this.$selectedPlugins.length>0?this.$selectedPlugin=this.$selectedPlugins[this.$selectedPlugins.length-1]:this.$selectedPlugin=null},t.prototype.showVersions=function(e){for(var t in this.$plugins)for(var n=0,i=this.$plugins[t].length;i>n;n++)this.$plugins[t][n].name==e.name&&(this.$plugins[t][n].$showVersions=!this.$plugins[t][n].$showVersions)},t.prototype.isPluginSelected=function(e){return-1!=this.$selectedPlugins.indexOf(e)?!0:!1},t.prototype.reset=function(){},t.prototype.reportError=function(e){if(e.$error){var t=e.$errorInput;switch(t=t.charAt(0).toUpperCase()+t.slice(1),e.$errorExpression){case"alpha-numeric":this.$errorMsg=t+" must only contain alphanumeric characters";break;case"email-plus":this.$errorMsg=t+" must only contain alphanumeric characters or a valid email";break;case"non-empty":this.$errorMsg=t+" cannot be empty";break;case"email":this.$errorMsg=t+" must be a valid email";break;case"alpha-numeric-plus":this.$errorMsg=t+" must only contain alphanumeric characters and '-', '!', or '_'";break;case"no-html":this.$errorMsg=t+" must not contain any html";break;default:this.$errorMsg=""}}else this.$errorMsg="";return"new-project"==this.$activePane&&0==this.$selectedPlugins.length&&(this.$errorMsg="Please choose at least 1 plugin to work with"),"register"==this.$activePane&&(this.$regCaptcha=jQuery("#recaptcha_response_field").val(),this.$regChallenge=jQuery("#recaptcha_challenge_field").val(),""==this.$regCaptcha&&(this.$errorMsg="Please enter the capture code")),""==this.$errorMsg?(this.$errorRed=!1,!1):(this.$errorRed=!0,!0)},t.prototype.newProject=function(t,n,i){var o=this;o.$loading=!0,o.$errorRed=!1,o.$errorMsg="Just a moment while we hatch your appling...",e.Compiler.digest(this._splashElm,this,!1);var r=i.map(function(e){return e._id});this.$user.newProject(t,r,n).then(function(e){o.$loading=!1,o.$errorRed=!1,o.$errorMsg="",o.$selectedProject=e.data,o.$projects.push(e.data),o.openProject(o.$selectedProject)})["catch"](function(t){o.$errorRed=!0,o.$errorMsg=t.message,o.$loading=!1,e.Compiler.digest(o._splashElm,o,!0)})},t.prototype.loginError=function(t){this.$loading=!1,this.$errorRed=!0,this.$errorMsg=t.message,e.Compiler.digest(this._loginElm,this),e.Compiler.digest(this._splashElm,this)},t.prototype.loginSuccess=function(t){t.error?this.$errorRed=!0:this.$errorRed=!1,this.$loading=!1,this.$errorMsg=t.message,e.Compiler.digest(this._splashElm,this,!0)},t.prototype.login=function(t,n,i){var o=this;o.$loading=!0,this.$user.login(t,n,i).then(function(t){t.error?o.$errorRed=!0:o.$errorRed=!1,o.$errorMsg=t.message,o.$loading=!1,o.$user.isLoggedIn?o.goState("welcome",!0):e.Compiler.digest(o._splashElm,o,!0)})["catch"](this.loginError.bind(o))},t.prototype.register=function(t,n,i,o,r){var s=this;s.$loading=!0,this.$user.register(t,n,i,o,r).then(this.loginSuccess.bind(s))["catch"](function(t){s.$errorRed=!0,s.$errorMsg=t.message,s.$loading=!1,Recaptcha.reload(),e.Compiler.digest(s._loginElm,s),e.Compiler.digest(s._splashElm,s)})},t.prototype.resendActivation=function(t){var n=this;return t?(n.$loading=!0,void this.$user.resendActivation(t).then(this.loginSuccess.bind(n))["catch"](this.loginError.bind(n))):(this.$errorMsg="Please specify a username or email to fetch",jQuery("form[name='register'] input[name='username'], form[name='register'] input[name='email']",this._loginElm).each(function(e,t){this.$error=!0}),e.Compiler.digest(n._loginElm,n),void e.Compiler.digest(n._splashElm,n))},t.prototype.resetPassword=function(t){var n=this;return t?(n.$loading=!0,void this.$user.resetPassword(t).then(this.loginSuccess.bind(n))["catch"](this.loginError.bind(n))):(this.$errorMsg="Please specify a username or email to fetch",jQuery("form[name='register'] input[name='username'], form[name='register'] input[name='email']",this._loginElm).each(function(e,t){this.$error=!0}),e.Compiler.digest(n._loginElm,n),void e.Compiler.digest(n._splashElm,n))},t.prototype.logout=function(){var t=this;t.$loading=!0,this.$user.logout().then(function(){t.$loading=!1,t.$errorMsg="",e.Application.getInstance().projectReset(),t.$loading=!1,t.goState("login",!0)})["catch"](this.loginError.bind(t))},t.init=function(e){return t._singleton=new t(e),t._singleton},Object.defineProperty(t,"get",{get:function(){return t._singleton},enumerable:!0,configurable:!0}),t}();e.Splash=t}(Animate||(Animate={}));var __plugins={},__newPlugin=null;jQuery(document).ready(function(){jQuery.ajaxSetup({crossDomain:!0,xhrFields:{withCredentials:!0}});Animate.LoaderBase.showLoader(),jQuery.getJSON(Animate.DB.API+"/plugins").done(function(e){onPluginsLoaded(e.data)}).fail(function(e){Animate.MessageBox.show("An error occurred while connecting to the server. "+e.status+": "+e.responseText,["Ok"],null,null)}).always(function(){Animate.LoaderBase.hideLoader()})});